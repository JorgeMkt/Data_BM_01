"0",""
"0","growth_plot <- function(variables, name) {"
"0","  "
"0",""
"0",""
"0","  elephant_df <- SPI %>%"
"0","    rename(spi_data=!! variables) %>%"
"0","    select(country, iso3c, date, spi_data) %>%"
"0","    group_by(country, date) %>%"
"0","    mutate(row = row_number()) %>%"
"0","    pivot_wider(names_from=date,"
"0","                names_prefix='spi_data_',"
"0","                values_from=c('spi_data')) %>%"
"0","    ungroup() %>%"
"0","    mutate(growth=(spi_data_2019-spi_data_2016)) %>%"
"0","    filter(!(is.na(spi_data_2019) | is.na(spi_data_2016))) %>%"
"0","    mutate(spi_rank=100*rank(spi_data_2016)/length(spi_data_2016),"
"0","           spi_bins=case_when( #calculate deciles"
"0","             between(spi_rank,0,10) ~ ""1st Decile"","
"0","             between(spi_rank,10,20) ~ ""2nd Decile"","
"0","             between(spi_rank,20,30) ~ ""3rd Decile"","
"0","             between(spi_rank,30,40) ~ ""4th Decile"","
"0","             between(spi_rank,40,50) ~ ""5th Decile"","
"0","             between(spi_rank,50,60) ~ ""6th Decile"","
"0","             between(spi_rank,60,70) ~ ""7th Decile"","
"0","             between(spi_rank,70,80) ~ ""8th Decile"","
"0","             between(spi_rank,80,90) ~ ""9th Decile"","
"0","             between(spi_rank,90,100) ~ ""Top Decile"""
"0","           )) %>%"
"0","    arrange(spi_rank)"
"0","  "
"0","  #summarise into decile bins"
"0","  elephant_df <- elephant_df %>%"
"0","    mutate(spi_bins=factor(spi_bins, levels=unique(elephant_df$spi_bins))) %>%"
"0","    group_by(spi_bins) %>%"
"0","    summarise(growth=mean(growth))"
"0","  "
"0","  ggplot(elephant_df, aes(x=spi_bins, y=growth, label=paste0(spi_bins,"": "",round(growth,1),""""))) +"
"0","    geom_segment(aes(xend=as.numeric(spi_bins)-0.5,x=as.numeric(spi_bins)+0.5, y=growth, yend=growth)) +"
"0","    geom_point() +"
"0","    geom_bar(aes(alpha=growth), stat = ""identity"", fill='#007f5f') +"
"0","    ggrepel::geom_text_repel(nudge_y=0.1, size=4,segment.alpha =  0 ) +"
"0","    scale_x_discrete() +"
"0","    theme_bw() +"
"0","    xlab(str_wrap('Decile in 2016',40)) +"
"0","    ylab(str_wrap('Change in Score (2016-19)',20)) +"
"0","    labs("
"0","      title=str_wrap(""2nd & 3rd deciles have improved most since 2016."",70),"
"0","      subtitle=str_wrap('Change in SPI Overall Score from 2016-19 by 2016 decile group',70),"
"0","      caption=paste0(name,' scale = 0 - 100 points.')"
"0","    ) +"
"0","    expand_limits(y=0) +"
"0","    scale_alpha_continuous("
"0","      range=c(0.3,1)"
"0","    ) +"
"0","  theme("
"0","    axis.title.y = element_text(angle=0, vjust = 0.5),"
"0","    text = element_text(size = 14),"
"0","    title= element_text(size = 20),"
"0","    legend.position = 'none'"
"0","  )"
"0",""
"0","}"
"0",""
"0",""
"0","# growth_plot('SPI.INDEX.DIM1', 'SPI Dimension 1 (Data Use) Score')"
"0","# growth_plot('SPI.INDEX.DIM2', 'SPI Dimension 2 (Data Services) Score')"
"0","# growth_plot('SPI.INDEX.DIM3', 'SPI Dimension 3 (Data Products) Score')"
"0","# growth_plot('SPI.INDEX.DIM4', 'SPI Dimension 4 (Data Sources) Score')"
"0","# growth_plot('SPI.INDEX.DIM5', 'SPI Dimension 5 (Data Infrastructure) Score')"
"0",""
"0",""

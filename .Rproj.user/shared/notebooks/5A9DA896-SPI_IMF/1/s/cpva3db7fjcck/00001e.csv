"0",""
"0",""
"0","#####"
"0","# IMF Data"
"0","#####"
"0","imf_codes <- read_csv(file=paste(raw_dir, ""metadata"",""IMF_country_codes.csv"", sep=""/"" ))"
"0",""
"0","#use alternative data source provided by the IMF"
"0",""
"0","#read in data from IMF"
"0","D5.2.9.FSI.IMF <-   read_excel(path=paste(raw_dir, ""5.2_DISM"",""Compiled Data for World Bank SPI.xlsx"", sep=""/"" ),"
"0","                               sheet =""FSI Quarterly Timeliness"","
"0","                               skip=1"
"0","                               ) %>%"
"0","  pivot_longer("
"0","    cols=c("
"0","      ""Financial Soundness Indicators, Core Set, Deposit Takers, Asset Quality, Non-performing Loans to Total Gross Loans, Percent"","
"0","      ""Financial Soundness Indicators, Core Set, Deposit Takers, Earnings and Profitability, Return on Assets, Percent"","
"0","      ""Financial Soundness Indicators, Core Set, Deposit Takers, Earnings and Profitability, Return on Equity, Percent"","
"0","      ""Financial Soundness Indicators, Encouraged Set, Deposit Takers, Capital to Assets, Percent"","
"0","      ""Financial Soundness Indicators, Encouraged Set, Deposit Takers, Foreign-Currency-Denominated Liabilities to Total Liabilities, Percent"""
"0","    ),"
"0","    names_to='FSI',"
"0","    values_to='FSI_value'"
"0","  ) %>%"
"0","  mutate("
"0","         FSI_quarter=lubridate::quarter(FSI_value, with_year = TRUE),"
"0","         FSI_year=lubridate::year(FSI_value)) %>%"
"0","  as_tibble(.name_repair='universal') %>%  "
"0","  rename("
"0","    IMF_code=Code,"
"0","    IMF_country=Country,"
"0","  ) %>%"
"0","  mutate(SPI.D5.2.9.FSI.IMF=case_when("
"0","    FSI_quarter==2020.2 ~ 1,"
"0","    FSI_year==2020 ~ 0.75,"
"0","    FSI_year==2019 ~ 0.5,"
"0","    FSI_year<2019 ~ 0.25,"
"0","    TRUE ~ 0 "
"0","  ),"
"0","  RAW.D5.2.9.FSI.IMF=FSI_value) %>%"
"0","  mutate(IMF_code=as.numeric(IMF_code)) %>%"
"0","  left_join(imf_codes) %>%"
"0","  select(iso3c, FSI, RAW.D5.2.9.FSI.IMF,SPI.D5.2.9.FSI.IMF ) %>%"
"0","  mutate(date=2020) "
"0","  "
"0","D5.2.9.FSI.IMF_annual <-   read_excel(path=paste(raw_dir, ""5.2_DISM"",""Compiled Data for World Bank SPI.xlsx"", sep=""/"" ),"
"0","                               sheet =""FSI Annual Timeliness"","
"0","                               skip=1"
"0","                               ) %>%"
"0","  pivot_longer("
"0","    cols=c("
"0","      ""Financial Soundness Indicators, Core Set, Deposit Takers, Asset Quality, Non-performing Loans to Total Gross Loans, Percent"","
"0","      ""Financial Soundness Indicators, Core Set, Deposit Takers, Earnings and Profitability, Return on Assets, Percent"","
"0","      ""Financial Soundness Indicators, Core Set, Deposit Takers, Earnings and Profitability, Return on Equity, Percent"","
"0","      ""Financial Soundness Indicators, Encouraged Set, Deposit Takers, Capital to Assets, Percent"","
"0","      ""Financial Soundness Indicators, Encouraged Set, Deposit Takers, Foreign-Currency-Denominated Liabilities to Total Liabilities, Percent"""
"0","    ),"
"0","    names_to='FSI',"
"0","    values_to='FSI_value'"
"0","  ) %>%"
"0","  as_tibble(.name_repair='universal') %>%"
"0","  rename("
"0","    IMF_code=Code,"
"0","    IMF_country=Country,"
"0","  ) %>%"
"0","  mutate(SPI.D5.2.9.FSI.IMF_annual=case_when("
"0","    FSI_value==2020 ~ 0.75,"
"0","    FSI_value==2019 ~ 0.5,"
"0","    FSI_value<2019 ~ 0.25,"
"0","    TRUE ~ 0 "
"0","  ),"
"0","  RAW.D5.2.9.FSI.IMF=FSI_value) %>%"
"0","  mutate(IMF_code=as.numeric(IMF_code)) %>%"
"0","  left_join(imf_codes) %>%"
"0","  select(iso3c,FSI ,SPI.D5.2.9.FSI.IMF_annual ) %>%"
"0","  mutate(date=2020)"
"0",""
"0","  "
"0","D5.2.9.FSI <-  D5.2.9.FSI.IMF %>%"
"0","  left_join(D5.2.9.FSI.IMF_annual) %>%"
"0","  rowwise() %>%"
"0","  mutate(SPI.D5.2.9.FSI=max(c_across(c('SPI.D5.2.9.FSI.IMF','SPI.D5.2.9.FSI.IMF_annual')) )) %>% #fill in with IMF data if missing.  This applies mostly to high income countries"
"0","  group_by(iso3c, date) %>%"
"0","  summarise(SPI.D5.2.9.FSI=mean(SPI.D5.2.9.FSI, na.rm=T)) %>%"
"0","  arrange(date, iso3c)"
"0",""
"0",""

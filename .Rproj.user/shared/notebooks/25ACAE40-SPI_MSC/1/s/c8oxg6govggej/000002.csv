"0",""
"0","#read in csv file."
"0","D5.2.4.CPIBY <- read_csv(file = paste(raw_dir, ""5.2_DISM"",""D5.2.4.CPIBY.csv"", sep=""/"" )) %>%"
"0","  mutate(SPI.D5.2.4.CPIBY=case_when("
"0","    CPIBY==""annual chained"" ~ 1, "
"0","    (date-as.numeric(CPIBY))<=10 ~ 0.5, #within 10 years of reference period"
"0","    TRUE ~ 0 "
"0","  ),"
"0","  RAW.D5.2.4.CPIBY=CPIBY)  %>%"
"0","  select(iso3c, country, date, RAW.D5.2.4.CPIBY, SPI.D5.2.4.CPIBY  ) %>%"
"0","  arrange(date, country)"
"0",""
"0","#####"
"0","# IMF Data"
"0","#####"
"0",""
"0","#use alternative data source provided by the IMF"
"0",""
"0","#read in data on when the weights were last updated to measure if annual chain linking is done"
"0","D5.2.4.COICOP.WGT <-   read_excel(path=paste(raw_dir, ""5.2_DISM"",""2020.11.04_Compiled Data for World Bank.xlsx"", sep=""/"" ),"
"0","                               sheet = ""COICOP Month_Last Change"","
"0","                               skip=2"
"0","                               ) %>%"
"0","  as_tibble(.name_repair='universal') %>%  "
"0","  rename("
"0","    IMF_code=Code,"
"0","    IMF_country=Country_revised"
"0","  ) %>%"
"0","  mutate(IMF_code=as.numeric(IMF_code)) %>%"
"0","  left_join(imf_codes)"
"0","  "
"0","  "
"0","#read in last time the CPI reference period is updated to fill in rest of info  "
"0","D5.2.4.CPI.REF <-  read_excel(path=paste(raw_dir, ""5.2_DISM"",""2020.11.04_Compiled Data for World Bank.xlsx"", sep=""/"" ),"
"0","                               sheet = ""CPI Reference Period Review"""
"0","                               ) %>%"
"0","  as_tibble(.name_repair='universal') %>%"
"0","  rename(IMF_country=country) %>%"
"0","  left_join(D5.2.4.COICOP.WGT) #merge CPI weights"
"0","  "
"0","#now calculate whether annual chain linking is used and CPI base year from scratch using this info"
"0","D5.2.4.CPIBY.IMF.RAW <- D5.2.4.CPI.REF %>%"
"0","  filter(!is.na(iso3c)) %>%"
"0","  mutate(CPI_ref_period=str_sub(CPI.reference.period.review,1,4),"
"0","         CPI_ref_period=as.numeric(CPI_ref_period),"
"0","         CPI_weight_change=str_sub(last_change,1,4),"
"0","         CPI_weight_change=as.numeric(CPI_weight_change)) %>%"
"0","  mutate(RAW.D5.2.4.CPIBY.IMF=if_else((CPI_weight_change>=2019 & CPI_ref_period<2020), ""annual chained"",as.character(CPI_ref_period))) %>%"
"0","  mutate(RAW.D5.2.4.CPIBY.IMF=if_else((iso3c=='AUS' | iso3c=='NZL'),""annual chained"",as.character(RAW.D5.2.4.CPIBY.IMF))) #replace Australia and New Zealand as annual chain linking.  They use quarterly cpi releases and do not show up in this dataset"
"0","  "
"0","#score from 2010 to 2019  "
"0","if (exists('D5.2.4.CPIBY.IMF')) {"
"0","    rm(D5.2.4.CPIBY.IMF)"
"0","} "
"0",""
"0","for (i in c(2015:2019)) {"
"0","  temp <- D5.2.4.CPIBY.IMF.RAW %>%"
"0","    mutate(date=i) %>%"
"0","    mutate(SPI.D5.2.4.CPIBY.IMF=case_when("
"0","      RAW.D5.2.4.CPIBY.IMF==""annual chained"" ~ 1, "
"0","      (date-as.numeric(RAW.D5.2.4.CPIBY.IMF))<=10 ~ 0.5, #within 10 years of reference period"
"0","      TRUE ~ 0 "
"0","    )) %>%"
"0","    select(iso3c, date, RAW.D5.2.4.CPIBY.IMF, SPI.D5.2.4.CPIBY.IMF  ) %>%"
"0","    arrange(date, iso3c)"
"0","  "
"0","  if (!exists('D5.2.4.CPIBY.IMF')) {"
"0","    D5.2.4.CPIBY.IMF <- temp"
"0","  } else {"
"0","    D5.2.4.CPIBY.IMF <- D5.2.4.CPIBY.IMF %>%"
"0","      bind_rows(temp)"
"0","  }"
"0","  "
"0","}"
"0",""
"0",""
"0",""
"0","#update based on IMF data.  Use manually collected value when other value not available"
"0","D5.2.4.CPIBY <- D5.2.4.CPIBY %>%"
"0","  full_join(D5.2.4.CPIBY.IMF) %>%"
"0","  mutate(SPI.D5.2.4.CPIBY=if_else(!is.na(RAW.D5.2.4.CPIBY.IMF),SPI.D5.2.4.CPIBY.IMF,SPI.D5.2.4.CPIBY)) %>%"
"0","  select(-country,-SPI.D5.2.4.CPIBY.IMF) "
"0",""
"0",""
"0",""
"0",""

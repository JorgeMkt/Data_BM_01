"0",""
"0","#read in TopoJSON from World Bank"
"0","countries <- geojsonio::geojson_read(paste0(dir,""/SPI_data_viz/WB_countries_Admin0_lowres.geojson""),"
"0","                                     what = ""sp"")"
"0",""
"0",""
"0",""
"0","spi_map_overall<-countries"
"0","        "
"0","        spi_map_overall@data <- spi_map_overall@data %>%"
"0","          mutate(iso3c=ISO_A3_EH,"
"0","                 iso3c=if_else(ISO_A3_EH==-99,WB_A3,ISO_A3_EH)) %>%"
"0","            left_join(SPI_2019) "
"0","        "
"0","        palette_df <- SPI_2019 %>%"
"0","          select(SPI.INDEX)"
"0",""
"0","        brks <- quantile(palette_df[,1], probs=c(0,1,2,3,4,5)/5,na.rm=T)"
"0","        #create pallete"
"0","        pal <- colorBin(c(""#1A9850"",  ""#BFCF28"", ""#E7BB25"", ""#DE7B2B"",  ""#D73027""), "
"0","                          bins=brks,"
"0","                          na.color='grey')"
"0","        "
"0","        "
"0","        "
"0","        ##############"
"0","        #create labels"
"0","        ##############"
"0","        "
"0","        "
"0","        labels <- sprintf("
"0","            ""<strong>%s</strong><br/> <hr size=2>"
"0","            <strong> %s: %g </strong><br/> <hr size=2>"
"0","            "","
"0","            spi_map_overall@data$NAME_EN,"
"0","            'Indicator Value', round(select(spi_map_overall@data, SPI.INDEX)[,1], digits = 1)"
"0",""
"0","        ) %>%"
"0","            lapply(htmltools::HTML)"
"0",""
"0","        "
"0","        "
"0","        "
"0","        leaflet(spi_map_overall) %>%"
"0","            addProviderTiles(providers$Esri.WorldStreetMap) %>%"
"0","            addPolygons(stroke = FALSE, smoothFactor = 0.3, fillOpacity = 0.7,"
"0","                        fillColor = ~pal(select(spi_map_overall@data, SPI.INDEX)[,1]),"
"0","                        label=labels) %>%"
"0","            addLegend(pal=pal, "
"0","                      values=~select(spi_map_overall@data, SPI.INDEX)[,1], opacity=0.7, "
"0","                      labFormat = function(type, cuts, p) {  # Here's the trick"
"0","                        paste0( c(""Bottom 20%"",""2nd Quintile"",""3rd Quintile"",""4th Quintile"",""Top 20%"" ))"
"0","                      },"
"0","                      title='Indicator value', position=""bottomleft"") "

"0","        #add function to produce weighted summary stats"
"0","        "
"0","        "
"0","        #produce by region"
"0","        sumstats<- SPI_2019 %>%"
"0","            group_by(region) %>%"
"0","            filter(!is.na(region)) %>%"
"0","            select(region, c('SPI.INDEX', 'SPI.INDEX.DIM2', 'SPI.INDEX.DIM3', 'SPI.INDEX.DIM4', 'SPI.INDEX.DIM5'), weights) %>%"
"0","            summarise_at(c('SPI.INDEX', 'SPI.INDEX.DIM2', 'SPI.INDEX.DIM3', 'SPI.INDEX.DIM4', 'SPI.INDEX.DIM5'),~round(wtd.mean(as.numeric(.),as.numeric(weights), na.rm=T),1)) "
"0","        "
"0","        #produce global number"
"0","        sumstats_gl<- SPI_2019 %>%"
"0","            mutate(region='Global') %>%"
"0","            group_by(region) %>%"
"0","            select(region, c('SPI.INDEX', 'SPI.INDEX.DIM2', 'SPI.INDEX.DIM3', 'SPI.INDEX.DIM4', 'SPI.INDEX.DIM5'), weights) %>%"
"0","            summarise_at(c('SPI.INDEX', 'SPI.INDEX.DIM2', 'SPI.INDEX.DIM3', 'SPI.INDEX.DIM4', 'SPI.INDEX.DIM5'),~round(wtd.mean(as.numeric(.),as.numeric(weights), na.rm=T),1)) "
"0","        "
"0","        "
"0","        #transpose data"
"0","        sumstats_df_long <-sumstats_gl %>%"
"0","            bind_rows(sumstats) "
"0","        "
"0","        sumstats_df <- as.data.frame(t(sumstats_df_long %>% select(-region)))"
"0","        colnames(sumstats_df) = sumstats_df_long$region "
"0","        "
"0","        "
"0","        sumstats_df <- sumstats_df %>%"
"0","            rownames_to_column() %>%"
"0","            rename(series=rowname)"
"0","        "
"0","        "
"0","        #create labels df"
"0","        metadata_tab2_overall <- metadata %>% "
"0","            janitor::clean_names() %>%"
"0","            filter(series %in% c('SPI.INDEX', 'SPI.INDEX.DIM2', 'SPI.INDEX.DIM3', 'SPI.INDEX.DIM4', 'SPI.INDEX.DIM5')) %>%"
"0","            select(series, indicator_name)"
"0","        "
"0","        "
"0","        #add variable label"
"0","        sumstats_df <- sumstats_df %>%"
"0","            left_join(metadata_tab2_overall) %>%"
"0","            rename(Series=series,"
"0","                   Label=indicator_name) %>%"
"0","          select(Label, everything()) %>%"
"0","          select(-Series)"
"0","        "
"0",""
"0","  "

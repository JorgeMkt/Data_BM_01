"0",""
"0",""
"0","spi_index_df %>%"
"0","  write_excel_csv(path=paste(output_dir, 'SPI_index.csv', sep=""/""))"
"0",""
"0","#add stata labels and save a stata version"
"0","#read in the data labels"
"0","metadata_info <- read_csv(paste(raw_dir, '/metadata/SPI_dimensions_sources.csv', sep="""")) %>%"
"0","    mutate(descript=paste(SPI_indicator_id,"": "", spi_indicator_name,"" - "",source_name , sep="""")) %>%"
"0","    select(source_id,  descript, spi_indicator_description)"
"0",""
"0","metadata_info <- read_csv(paste(raw_dir, '/metadata/SPI_index_sources.csv', sep="""")) %>%"
"0","  bind_rows(metadata_info)"
"0",""
"0","#create a copy of the data to save to stata"
"0","spi_index_dta <- spi_index_df"
"0",""
"0","#get a list of the labels and apply them"
"0","labels <- metadata_info[match(colnames(spi_index_dta),metadata_info$source_id),2]"
"0","labels <- labels$descript"
"0","names(labels) <-colnames(spi_index_dta)"
"0","  "
"0","label(spi_index_dta) <- as.list(labels)"
"0",""
"0","#save stata compatible version with labels"
"0","spi_index_dta %>%"
"0","  janitor::clean_names() %>%"
"0","  haven::write_dta(path=paste(output_dir, 'SPI_index.dta', sep=""/""))"
"0",""
"0","#save a copy with column labels as well to csv"
"0","l <- lapply(spi_index_dta, attr, ""label"") # Gives you list of the labeled variables"
"0","l <- as.data.frame(l, stringsAsFactors = F) # Convert list to dataframe"
"0","spi_index_dta_lab <- rbind(l, spi_index_dta) %>%"
"0","  write_excel_csv(path=paste(output_dir, 'SPI_index_labelled.csv', sep=""/""),"
"0","                  na="""") # Bind the two"

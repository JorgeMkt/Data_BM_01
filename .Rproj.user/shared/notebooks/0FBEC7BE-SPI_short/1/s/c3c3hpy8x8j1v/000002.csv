"0","        #add function to produce weighted summary stats"
"0","        "
"0","indicators<-c(#"
"0","              ""SPI.D2.1.GDDS"","
"0","              ""SPI.D5.2.1.SNAU"","
"0","              ""SPI.D5.2.2.NABY"","
"0","              ""SPI.D5.2.3.CNIN"","
"0","              ""SPI.D5.2.4.CPIBY"","
"0","              ""SPI.D5.2.5.HOUS"","
"0","              ""SPI.D5.2.6.EMPL"","
"0","              ""SPI.D5.2.7.CGOV"","
"0","              ""SPI.D5.2.8.FINA"","
"0","              ""SPI.D5.2.9.MONY"","
"0","              ""SPI.D5.2.10.GSBP"")"
"0",""
"0","        #produce by region"
"0","        sumstats<- SPI_2019 %>%"
"0","            group_by(region) %>%"
"0","            filter(!is.na(region)) %>%"
"0","            select(region,  all_of(indicators), weights) %>%"
"0","            summarise_at( all_of(indicators),~round(wtd.mean(as.numeric(.),as.numeric(weights), na.rm=T),2)) "
"0","        "
"0","        #produce global number"
"0","        sumstats_gl<- SPI_2019 %>%"
"0","            mutate(region='Global') %>%"
"0","            group_by(region) %>%"
"0","            select(region,  all_of(indicators), weights) %>%"
"0","            summarise_at( all_of(indicators),~round(wtd.mean(as.numeric(.),as.numeric(weights), na.rm=T),2)) "
"0","        "
"0","        "
"0","        #transpose data"
"0","        sumstats_df_long <-sumstats_gl %>%"
"0","            bind_rows(sumstats) "
"0","        "
"0","        sumstats_df <- as.data.frame(t(sumstats_df_long %>% select(-region)))"
"0","        colnames(sumstats_df) = sumstats_df_long$region "
"0","        "
"0","        "
"0","        sumstats_df <- sumstats_df %>%"
"0","            rownames_to_column() %>%"
"0","            rename(series=rowname)"
"0","        "
"0","        "
"0","        #create labels df"
"0","        metadata_tab2_overall <- metadata %>% "
"0","            janitor::clean_names() %>%"
"0","            filter(series %in%  all_of(indicators)) %>%"
"0","            select(series, indicator_name)"
"0","        "
"0","        "
"0","        #add variable label"
"0","        sumstats_df <- sumstats_df %>%"
"0","            left_join(metadata_tab2_overall) %>%"
"0","            rename(Series=series,"
"0","                   Label=indicator_name) %>%"
"0","          select(Label, everything()) %>%"
"0","          select(-Series)"
"0","        "
"0",""
"0","  "

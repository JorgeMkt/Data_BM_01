"0",""
"0","# #read data from UNESCO API"
"0","# #get list of indicators to download"
"0","# indicators <- 'ADMI_GRADE2OR3PRIM_READ+ADMI_ENDOFPRIM_READ+ADMI_ENDOFLOWERSEC_READ+ADMI_GRADE2OR3PRIM_MAT+ADMI_ENDOFPRIM_MAT+ADMI_ENDOFLOWERSEC_MAT+ROFST_1_CP+ROFST_1_F_CP+ROFST_1_M_CP+ROFST_2_CP+ROFST_2_F_CP+ROFST_2_M_CP+ROFST_3_CP+ROFST_3_F_CP+ROFST_3_M_CP+ROFST_1T2_CP+ROFST_1T2_F_CP+ROFST_1T2_M_CP+ROFST_2T3_CP+ROFST_2T3_F_CP+ROFST_2T3_M_CP+ROFST_1T3_CP+ROFST_1T3_F_CP+ROFST_1T3_M_CP+NERA_AGM1_CP+NERA_AGM1_F_CP+NERA_AGM1_M_CP.'"
"0","# "
"0","# #get list of countries"
"0","# countries <- 'AFG+ALB+DZA+ASM+AND+AGO+AIA+ATG+ARG+ARM+ABW+AUS+AUT+AZE+BHS+BHR+BGD+BRB+BLR+BEL+BLZ+BEN+BMU+BTN+BOL+BIH+BWA+BRA+VGB+BRN+BGR+BFA+BDI+KHM+CMR+CAN+CPV+CYM+CAF+TCD+CHL+CHN+HKG+MAC+COL+COM+COG+COK+CRI+CIV+HRV+CUB+CUW+CYP+CZE+PRK+COD+DNK+DJI+DMA+DOM+ECU+EGY+SLV+GNQ+ERI+EST+SWZ+ETH+FJI+FIN+FRA+GUF+PYF+GAB+GMB+GEO+DEU+GHA+GIB+GRC+GRL+GRD+GLP+GUM+GTM+GIN+GNB+GUY+HTI+VAT+HND+HUN+ISL+IND+IDN+IRN+IRQ+IRL+ISR+ITA+JAM+JPN+JOR+KAZ+KEN+KIR+KWT+KGZ+LAO+LVA+LBN+LSO+LBR+LBY+LIE+LTU+LUX+MDG+MWI+MYS+MDV+MLI+MLT+MHL+MTQ+MRT+MUS+MEX+FSM+MCO+MNG+MNE+MSR+MAR+MOZ+MMR+NAM+NRU+NPL+NLD+ANT+NCL+NZL+NIC+NER+NGA+NIU+MKD+NOR+OMN+PAK+PLW+PSE+PAN+PNG+PRY+PER+PHL+POL+PRT+PRI+QAT+KOR+MDA+REU+ROU+RUS+RWA+SHN+KNA+LCA+SPM+VCT+WSM+SMR+STP+SAU+SEN+SRB+SYC+SLE+SGP+SXM+SVK+SVN+SLB+SOM+ZAF+SSD+ESP+LKA+SDN+XDN+SUR+SWE+CHE+SYR+TJK+THA+TLS+TGO+TKL+TON+TTO+TUN+TUR+TKM+TCA+TUV+UGA+UKR+ARE+GBR+TZA+USA+URY+UZB+VUT+VEN+VNM+WLF+YEM+ZMB+ZWE+SDG+40675+40330+40334+40344+40606+40617+40603+40614+40618+40612+40616+40619+40611+40613+40630+40650+40651+40656+40642+40620+40640+UIS+40510+40525+40530+40505+40515+40520+40500+40535+40540+40550+WB+40044+40042+40030+40043+40041/all'"
"0","# "
"0","# start <- '2000'"
"0","# end <- '2019'"
"0","# "
"0","# #build the API query"
"0","# url <- paste('http://api.uis.unesco.org/sdmx.ashx/GetData/SDG4_DS/',indicators, countries,'?startTime=',start,'&endTime=',end,sep="""")"
"0","# "
"0","# #read the data"
"0","# url <- 'https://api.uis.unesco.org/sdmx/data/UNESCO,SDG4,2.0/ADMIN.NB.._T._T._T.G2_3+GLAST............?startPeriod=2013&endPeriod=2019&format=csv-sdmx&locale=en&subscription-key=fd406abcbf3d4e318741b8537c92fe43'"
"0",""
"0","unesco_df_raw <- read_csv(file=paste(raw_dir, '4.2_SOAD','UIS_SDG_MONITOR', 'SDG_DATA_NATIONAL.csv', sep=""/""))"
"0",""
"0","#cleaning of unesco data"
"0","unesco_df <- unesco_df_raw %>%"
"0","    rename(iso3c=COUNTRY_ID) %>%"
"0","    mutate(date=as.numeric(YEAR)) %>%"
"0","    mutate(type = case_when( #categorize based on whether they are assessment, out of school, or participation data"
"0","      grepl('admi', INDICATOR_ID) ~ ""NAS"", #Administration of a nationally-representative learning assessment (a) in Grade 2 or 3; (b) at the end of primary education; and (c) at the end of lower secondary education "
"0","      # grepl('ROFST', SDG_IND) ~ ""OOS"", # Out-of-school rate by school age and sex"
"0","      # grepl('NERA', SDG_IND) ~ ""ORGL"" # Participation rate in organized learning (one year before the official primary entry age), by sex"
"0","    )) %>%"
"0","   filter(type==""NAS"") %>%"
"0","    mutate(edu_admin_available=(VALUE==1)) %>% #get a variable for wehther admin based value exists for indicator"
"0","    group_by( iso3c, date, type) %>%"
"0","    summarise(edu_admin_available=mean(as.numeric(edu_admin_available))) %>% "
"0","    ungroup() %>%"
"0","    pivot_wider("
"0","      names_from='type',"
"0","      names_glue=""RAW.D4.2.2.EDU.{type}"","
"0","      values_from='edu_admin_available',"
"0","      values_fill=NA"
"0","    ) %>%"
"0","    right_join(spi_df_empty) %>%"
"0","    mutate(across(starts_with('RAW.D4.2.2.EDU'),~if_else(is.na(.),0,.))) %>%"
"0","    group_by(iso3c) %>%"
"0","    arrange(-date, iso3c) %>%"
"0","    mutate(across(starts_with('RAW.D4.2.2.EDU'),~zoo::rollmean(.,k=window,fill=NA,align='left'),.names=""{col}.MA5"")) %>% #X year rolling average"
"0","    ungroup() %>%"
"0","    mutate(SPI.D4.2.2.EDU=(RAW.D4.2.2.EDU.NAS)) %>%"
"0","  select(c('iso3c', 'country', 'date', 'RAW.D4.2.2.EDU.NAS', 'SPI.D4.2.2.EDU')  )"
"0",""
"0","#add to spi databases"
"0","spi_df <- spi_df %>%"
"0","  left_join(unesco_df)"
"0",""
"0","unesco_map <- unesco_df "
"0",""
"0","spi_mapper('unesco_map', 'SPI.D4.2.2.EDU', 'Education Administrative Data Available According to UIS' )"

"0",""
"0",""
"0","#read in data from UNSD database on SDGs"
"0","df_birth <- read_csv(file=paste(raw_dir, '4.2_SOAD', 'SG_REG_BRTH90N.csv', sep=""/"")) %>% #Countries with birth registration data that are at least 90 percent complete (1 = YES; 0 = NO)"
"0","  filter(date>=2015 & date<=2019) %>%"
"0","  left_join(spi_df_empty) %>%"
"0","  transmute("
"0","    iso3c=iso3c,"
"0","    country=country,"
"0","    date=date,"
"0","    RAW.D4.2.3.BRTH90=ind_value,"
"0","    SPI.D4.2.3.BRTH90=if_else(ind_value==1,0.5,0)"
"0","  )"
"0",""
"0","df_death <- read_csv(file=paste(raw_dir, '4.2_SOAD', 'SG_REG_DETH75N.csv', sep=""/"")) %>% #Countries with death registration data that are at least 75 percent complete (1 = YES; 0 = NO)"
"0","  filter(date>=2015& date<=2019) %>%"
"0","  left_join(spi_df_empty) %>%"
"0","    transmute("
"0","    iso3c=iso3c,"
"0","    country=country,"
"0","    date=date,"
"0","    RAW.D4.2.3.DETH75=ind_value,"
"0","    SPI.D4.2.3.DETH75=if_else(ind_value==1,0.5,0)"
"0","  )"
"0",""
"0","#supplement with wdi data"
"0","crvs_wdi <- WDI_metadata %>%"
"0","  select(Country.Code, date, Vital.registration.complete) %>%"
"0","  mutate(iso3c=Country.Code,"
"0","         SPI.D4.2.3.WDI=if_else(grepl('Yes', Vital.registration.complete),1,0),"
"0","         RAW.D4.2.3.CRVS.WDI=Vital.registration.complete) %>%"
"0","  select(-Country.Code, -Vital.registration.complete)"
"0",""
"0","crvs_df <- df_birth %>%"
"0","  left_join(df_death) %>%"
"0","  left_join(crvs_wdi) %>%"
"0","  mutate("
"0","         SPI.D4.2.3.CRVS=SPI.D4.2.3.DETH75+SPI.D4.2.3.BRTH90,"
"0","         SPI.D4.2.3.CRVS=if_else(is.na(SPI.D4.2.3.CRVS),SPI.D4.2.3.WDI,SPI.D4.2.3.CRVS)) %>%"
"0","  select(-SPI.D4.2.3.WDI) %>%"
"0","  group_by(country) %>%"
"0","  mutate(across(starts_with(""SPI""), na.locf, na.rm=FALSE)) %>% #use carry forward to most recent value"
"0","  mutate(across(starts_with(""SPI""), ~if_else(is.na(.),0,.))) %>%"
"0","  ungroup() %>%"
"0","  select(c( 'country', 'date','RAW.D4.2.3.BRTH90', 'RAW.D4.2.3.DETH75', 'RAW.D4.2.3.CRVS.WDI', 'SPI.D4.2.3.CRVS')  ) "
"0",""
"0",""
"0",""
"0",""
"0","#add to spi databases"
"0","spi_df <- spi_df %>%"
"0","  left_join(crvs_df)"
"0",""
"0",""
"0","crvs_map <- crvs_df "
"0",""
"0","spi_mapper('crvs_map', 'SPI.D4.2.3.CRVS', 'Complete Civil Registration & Vital Statistics Data Available According to WDI' )"
"0","View(cs_df)"

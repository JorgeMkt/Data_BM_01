"0",""
"0",""
"0","#Read in data from UN Inter-agency Group for Child Mortality Estimation"
"0",""
"0","D3.2.AKI.FIES <- read_csv(file=paste(raw_dir, '3.1_DPSS/D3.2.FIES.csv', sep=""/"")) %>%"
"0","  rename(year_code=""Year Code"","
"0","         iso3c=""ISO3 Code"") %>%"
"0","  mutate(date=as.numeric(str_extract(year_code, ""^.{4}"")),"
"0","         SPI.D1.5.FIES=Value)"
"0",""
"0","#Now loop from 2016 and 2019, keeping just data inside last 5 years."
"0","for (reference_year in 2016:2019) {"
"0","  temp <-D3.2.AKI.FIES %>%"
"0","          filter(((reference_year-as.numeric(date))<=5) & (reference_year>=as.numeric(date))) %>% #filter out years outside reference window of 5 years     "
"0","          mutate(SPI.D1.5.FIES=if_else(is.na(SPI.D1.5.FIES),0,1)) %>% #create 0,1 variable for whether data point exists for country"
"0","          group_by(iso3c) %>%"
"0","          summarise_all((~(if(is.numeric(.)) sum(., na.rm = TRUE) else first(.)))) %>% #group by country to create one observation per country                 containing whether or not data point existed"
"0","          mutate(SPI.D1.5.FIES=case_when("
"0","            SPI.D1.5.FIES>=3 ~ 1,"
"0","            SPI.D1.5.FIES==2 ~ 0.6,"
"0","            SPI.D1.5.FIES==1 ~ 0.3,"
"0","            SPI.D1.5.FIES==0 ~ 0, "
"0","            TRUE ~ 0"
"0","          )) %>% # 1 point for at least 3 values, 0.6 for 2 values, 0.3 for 1 values, 0 otherwise"
"0","          mutate(date=reference_year) %>%"
"0","          select( iso3c, date, starts_with('SPI.')) "
"0",""
"0",""
"0","  assign(paste(""D3.2.AKI"",reference_year,sep=""_""), temp)"
"0","}"
"0",""
"0","D3.2.AKI <- bind_rows(D3.2.AKI_2016, D3.2.AKI_2017, D3.2.AKI_2018, D3.2.AKI_2019)"

"0",""
"0","  #read in ODIN data"
"0","  for (i in 2015:2018) {"
"0","   temp <- read_csv(paste(raw_dir, '/2.2_DSOA/','ODIN_',i,'.csv', sep=""""))  %>%"
"0","        as_tibble(.name_repair = 'universal') %>%"
"0","        mutate(date=i) %>%"
"0","        filter(Data.categories=='All Categories')"
"0",""
"0",""
"0","    assign(paste('geo_df',i,sep=""_""), temp)"
"0","  }"
"0",""
"0","#bind different years together"
"0","geo_df <- bind_rows(geo_df_2015, geo_df_2016, geo_df_2017, geo_df_2018)"
"0",""
"0",""
"0","#create geo scores"
"0","geo_df <- geo_df %>%"
"0","    select(Country.Code, date, First.administrative.level, Second.administrative.level) %>%"
"0","    rename(iso3c=Country.Code) %>%"
"0","    group_by( iso3c) %>%"
"0","    right_join(country_metadata) %>%"
"0","    mutate(D4.3.GEO.first.admin.level=if_else(is.na(First.administrative.level), 0, First.administrative.level),"
"0","           D4.3.GEO.second.admin.level=if_else(is.na(Second.administrative.level), 0, Second.administrative.level))    "
"0","  "
"0",""
"0","#do some quick renaming and formatting"
"0","geo_df_temp1 <- geo_df %>% "
"0","  rename_with(~paste('RAW',., sep="".""), .cols=c('D4.3.GEO.first.admin.level', 'D4.3.GEO.second.admin.level') ) "
"0",""
"0",""
"0","geo_df_temp2 <- geo_df %>% "
"0","  mutate(across(c('D4.3.GEO.first.admin.level', 'D4.3.GEO.second.admin.level'), ~./100)) %>%"
"0","  rename_with(~paste('SPI',., sep="".""), .cols=c('D4.3.GEO.first.admin.level', 'D4.3.GEO.second.admin.level') ) "
"0",""
"0","geo_df <- geo_df_temp1 %>%"
"0","  left_join(geo_df_temp2)"
"0",""
"0","#add to spi df"
"0","spi_df <- spi_df %>%"
"0","  left_join(geo_df)"
"0",""
"0"," "
"0","   "

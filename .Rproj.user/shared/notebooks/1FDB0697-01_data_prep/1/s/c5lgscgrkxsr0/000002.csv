"0",""
"0","#Read in data from UN Inter-agency Group for Child Mortality Estimation"
"0",""
"0","D3.3.AKI.MORT <- read_csv(file=paste(raw_dir, '3.1_DPSS/D3.3_child_mort_RAW_v01.csv', sep=""/"")) %>%"
"0","  filter(INDICATOR=='Under-five mortality rate' & SEX=='Total') %>% #keep just observations for under 5 child mortality and for both sexes "
"0","  filter(OBS_STATUS=='Included in IGME') %>% # Also keep only surveys that met IGME criteria for inclusion as a nationally representative statistic"
"0","  mutate(date=as.numeric(str_extract(TIME_PERIOD, ""^.{4}"")),"
"0","         country=REF_AREA,"
"0","         D3.CHLD.MORT=OBS_VALUE)"
"0",""
"0","#Now loop from 2016 and 2019, keeping just data inside last 5 years."
"0","for (reference_year in 2016:2019) {"
"0","  temp <-D3.3.AKI.MORT %>%"
"0","          mutate(frequency=((reference_year-as.numeric(date))<=5) & (reference_year>=as.numeric(date))) %>% "
"0","          mutate(SPI.FREQ.D1.5.CHLD.MORT=if_else(frequency==TRUE,1,0)) %>% #create 0,1 variable for whether data point exists for country"
"0","          mutate(SPI.QUAL.D1.5.CHLD.MORT=case_when("
"0","                   reference_year-as.numeric(date)>=5 ~ 0, #outside 5 year window"
"0","                   SERIES_METHOD=='Vital Registration' ~ 0.5,"
"0","                   SERIES_METHOD!='Vital Registration' ~ 0.25,"
"0","                   TRUE ~ as.numeric(NA)"
"0","                 )) %>%"
"0","          group_by(country) %>%"
"0","          summarise(SPI.FREQ.D1.5.CHLD.MORT=sum(SPI.FREQ.D1.5.CHLD.MORT, na.rm=T),"
"0","                    SPI.QUAL.D1.5.CHLD.MORT=max(SPI.QUAL.D1.5.CHLD.MORT, na.rm=T)) %>% "
"0","          mutate(SPI.FREQ.D1.5.CHLD.MORT=case_when("
"0","            SPI.FREQ.D1.5.CHLD.MORT>=3 ~ 0.5,"
"0","            SPI.FREQ.D1.5.CHLD.MORT==2 ~ 0.3,"
"0","            SPI.FREQ.D1.5.CHLD.MORT==1 ~ 0.15,"
"0","            SPI.FREQ.D1.5.CHLD.MORT==0 ~ 0, "
"0","            TRUE ~ 0"
"0","          )) %>%"
"0","          mutate(SPI.D1.5.CHLD.MORT=SPI.FREQ.D1.5.CHLD.MORT+SPI.QUAL.D1.5.CHLD.MORT) %>% "
"0","          mutate(date=reference_year) %>%"
"0","          select( country, date, starts_with('SPI.')) "
"0",""
"0",""
"0","  assign(paste(""D3.3.AKI"",reference_year,sep=""_""), temp)"
"0","}"
"0",""
"0","D3.3.AKI <- bind_rows(D3.3.AKI_2016, D3.3.AKI_2017, D3.3.AKI_2018, D3.3.AKI_2019)"
"0",""
"0",""

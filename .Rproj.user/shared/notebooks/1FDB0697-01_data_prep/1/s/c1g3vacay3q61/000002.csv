"0",""
"0","#read data"
"0","ilo_df_raw <- read_csv(paste(raw_dir, '4.2_SOAD','ILOSTAT_sources.csv', sep=""/""))"
"0",""
"0","#cleaning of aspire data"
"0","ilo_df <- ilo_df_raw %>%"
"0","  filter(!grepl('legislation',Source)) %>% # filter out labor legislation, which is included but not reflective of needs."
"0","  mutate(type = case_when( #categorize based on whether they are assessment, out of school, or participation data"
"0","      (Source.type==""Insurance records"" ) ~ ""INSUR"", #Insurance records "
"0","      (Source.type==""Labour inspectorate records"" ) ~ ""INSP"", # Labour inspectorate records  "
"0","      (Source.type==""Records of employers' organizations"" ) ~ ""EMPORG"", # Records of employers' organizations"
"0","      (Source.type==""Employment office records"" ) ~ ""EMPOFF"", # Employment office records"
"0","      (Source.type==""Records of workers' organizations""  ) ~ ""WRKORG"", # Records of workers' organizations"
"0","      (Source.type==""Other administrative records and related sources"" ) ~ ""OTHER"" # Other administrative records and related sources"
"0","                        ),"
"0","      admin_available=1) %>%"
"0","  select(iso3c, date, type,Source ) %>%"
"0","      pivot_wider("
"0","      names_from='type',"
"0","      names_glue=""RAW.D4.2.4.LBR.{type}"","
"0","      values_from='Source',"
"0","      values_fill=NULL"
"0","    ) "
"0",""
"0",""
"0","#apply carryforward to fill in missing values"
"0","ilo_df <- ilo_df %>%"
"0","  right_join(spi_df_empty) %>%"
"0","  arrange(iso3c, date) %>%"
"0","  group_by(iso3c) %>%"
"0","  mutate(across(starts_with('RAW.D4.2.4.LBR'),"
"0","                ~if_else(.!='NULL',1, 0),"
"0","                .names=""{col}_available"")) %>%"
"0","  mutate(ILO.Source.type.filled=(RAW.D4.2.4.LBR.OTHER_available +"
"0","                                RAW.D4.2.4.LBR.INSUR_available +"
"0","                                RAW.D4.2.4.LBR.EMPOFF_available+"
"0","                                RAW.D4.2.4.LBR.WRKORG_available+"
"0","                                RAW.D4.2.4.LBR.INSP_available  +"
"0","                                RAW.D4.2.4.LBR.EMPORG_available)/6) %>%"
"0","  group_by(iso3c) %>%"
"0","  arrange(-date, iso3c) %>%"
"0","  mutate(across(starts_with('ILO.Source.type.filled'),~zoo::rollmean(.,k=5,fill=NA,align='left'),.names=""{col}.MA5"")) %>% #five year rolling average"
"0","  ungroup() %>%"
"0","  mutate(SPI.D4.2.4.LBR=if_else(is.na(ILO.Source.type.filled.MA5),0, ILO.Source.type.filled.MA5)) %>%"
"0","  select(c('iso3c', 'country', 'date', 'SPI.D4.2.4.LBR'), starts_with('RAW.D4.2.4.LBR')  ) %>%"
"0","  select(-ends_with('available'))"
"0",""
"0","#add to spi databases"
"0","spi_df <- spi_df %>%"
"0","  left_join(ilo_df)  "
"0",""
"0",""
"0","ilo_map <- ilo_df "
"0",""
"0","spi_mapper('ilo_map', 'SPI.D4.2.4.LBR', 'Labor Administrative Data Available According to ILO' )"

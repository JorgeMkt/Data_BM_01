"0",""
"0","#add in population"
"0","pop_df <- wbstats::wb(country=""all"","
"0","             indicator='SP.POP.TOTL',"
"0","             startdate=2004,"
"0","             enddate=2019) %>%"
"0","  mutate(date=as.numeric(date)) %>%"
"0","  mutate(population=value) %>%"
"0","  select(country, date, population)"
"0",""
"0","# create final dataset"
"0","spi_df_final <- spi_df %>%"
"0","  select(country, iso3c, date, starts_with(""SPI""), starts_with(""RAW"")) %>%"
"0","  right_join(spi_df_empty) %>%"
"0","  left_join(pop_df) %>%"
"0","  arrange(-date,country)"
"0",""
"0",""
"0","####"
"0","#lining up data to 2019 and filling in some values for OECD countries.  "
"0","####"
"0","#get a list of oecd countries"
"0","oecd_country_query <-  GET(url = ""https://api.worldbank.org/v2/country?region=OED&format=json"") %>%"
"0","  content( as = ""text"", encoding = ""UTF-8"") %>%"
"0","  jsonlite::fromJSON( flatten = TRUE) "
"0",""
"0","#do some conversion to produce a dataframe"
"0","oecd_country_df <- oecd_country_query[[2]] %>%"
"0","  as_tibble() "
"0","  "
"0","country_mod_list <- oecd_country_df$name  #fill in the missing values for OECDs with 1s because by participating in OECD these countries have this"
"0","country_mod_list <- c(country_mod_list, 'Singapore')"
"0","spi_df_final <- spi_df_final %>%"
"0","  arrange(country, date) %>%"
"0","  group_by(country) %>%"
"0","  mutate(across(starts_with(""SPI""), na.locf, na.rm=FALSE)) %>%"
"0","  mutate(across(c(""SPI.D1.5.POV"","
"0","                  ""SPI.D2.1.GDDS"","
"0","                  ""SPI.D5.1.DILG"","
"0","                  ""SPI.D5.2.3.CNIN"", ""SPI.D5.2.5.HOUS"", ""SPI.D5.2.6.EMPL"", ""SPI.D5.2.8.FINA"","
"0","                  ""SPI.D5.2.9.MONY"", ""SPI.D5.2.10.GSBP"","
"0","                  ""SPI.D5.5.DIFI""),"
"0","                ~if_else(( (income=='High income')  & (country %in% country_mod_list)),1,.)                )) "
"0",""

"0",""
"0","#pull data for NABY from WDI metadata"
"0",""
"0","df <- WDI_metadata"
"0",""
"0","# Manipulate and clean final data"
"0","df <- df %>%"
"0","  filter(!is.na(Income.Group))  #keep just countries (drop aggregations)"
"0","  "
"0",""
"0","naby_df <- df %>%"
"0","  mutate(iso3c=if_else(is.na(Country.Code), Code, Country.Code),"
"0","         country=Table.Name) %>%"
"0","  select(c('iso3c', 'country', 'date',  'National.accounts.base.year')  ) %>%"
"0","  mutate(NABY=National.accounts.base.year) %>%"
"0","  mutate(NABY_dates=gsub(""\\d{2}/"","""",NABY) ) %>%"
"0","  mutate(NABY_dates=str_extract(NABY_dates, ""\\d{4}"") ) %>%"
"0","  mutate(NABY_dates=if_else(NABY==""20015/2016"",""2016"",NABY_dates)) %>% #fix an issue in WDI metadata"
"0","  mutate(SPI.D5.2.2.NABY=case_when("
"0","    NABY==""Original chained constant price data are rescaled."" ~ 1, "
"0","    (date-as.numeric(NABY_dates))<=10 ~ 0.5, #within 10 years of reference period"
"0","    TRUE ~ 0 "
"0","  ),"
"0","  RAW.D5.2.2.NABY=NABY)  %>%"
"0","  select(iso3c, country, date, RAW.D5.2.2.NABY, SPI.D5.2.2.NABY  ) %>%"
"0","  arrange(date, country)"
"0",""
"0",""
"0",""
"0",""

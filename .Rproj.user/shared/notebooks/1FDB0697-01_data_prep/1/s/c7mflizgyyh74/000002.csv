"0",""
"0",""
"0","#write to csv"
"0","spi_df_final %>%"
"0","  mutate(across(is.list, as.character)) %>%"
"0","  write_excel_csv( path = paste(output_dir, 'SPI_data.csv', sep=""/""))"
"0",""
"0","#label data"
"0","#read in metadata"
"0","names_df <- data.frame('source_id'=colnames(spi_df_final))"
"0",""
"0","spi_meta <- read_csv(paste(raw_dir, '/metadata/SPI_dimensions_sources.csv', sep="""")) %>%"
"0","  right_join(names_df) %>%"
"0","  mutate(source_name=if_else(is.na(source_name), paste(source_id), source_name)) %>%"
"0","  arrange(factor(source_id, levels=colnames(spi_df_final)))"
"0",""
"0","#label data"
"0",""
"0","label(spi_df_final) = as.list(spi_meta$source_name)"
"0",""
"0",""
"0","#write to stata"
"0","spi_df_final %>%"
"0","  mutate(across(is.list, as.character)) %>%"
"0","  rename_with(~gsub(""."",""_"",.x, fixed=TRUE)) %>%"
"0","  select(-lat,-long) %>%"
"0","  write_dta( path = paste(output_dir, 'SPI_data.dta', sep=""/""))"
"0",""

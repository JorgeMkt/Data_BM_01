"0",""
"0",""
"0","#Read in data from UN Inter-agency Group "
"0",""
"0","D3.5.AKI.MMR <- read_csv(file=paste(raw_dir, '3.1_DPSS/D3.5.BMat2019_datainputs.csv', sep=""/"")) %>%"
"0","  filter(modelinclude=='TRUE') %>% #keep just observations that the UN inter-agency group deemed credible for use in modelling "
"0","  mutate(date=end,"
"0","         iso3c=iso,"
"0","         D3.MMRT=pm_obs)"
"0",""
"0","#Now loop from 2016 and 2019, keeping just data inside last 5 years."
"0","for (reference_year in 2016:2019) {"
"0","  temp <-D3.5.AKI.MMR %>%"
"0","          mutate(frequency=((reference_year-as.numeric(date))<=5) & (reference_year>=as.numeric(date))) %>% "
"0","          mutate(SPI.FREQ.D1.5.MMRT=if_else(frequency==TRUE,1,0)) %>% #create 0,1 variable for whether data point exists for country"
"0","          mutate(SPI.QUAL.D1.5.MMRT=case_when("
"0","                   reference_year-as.numeric(date)>=5 ~ 0, #outside 5 year window"
"0","                   type=='vr' ~ 0.5,"
"0","                   type!='vr' ~ 0.25,"
"0","                   TRUE ~ as.numeric(NA)"
"0","                 )) %>%"
"0","          group_by(iso3c) %>%"
"0","          summarise(SPI.FREQ.D1.5.MMRT=sum(SPI.FREQ.D1.5.MMRT, na.rm=T),"
"0","                    SPI.QUAL.D1.5.MMRT=max(SPI.QUAL.D1.5.MMRT, na.rm=T)) %>% "
"0","          mutate(SPI.FREQ.D1.5.MMRT=case_when("
"0","            SPI.FREQ.D1.5.MMRT>=3 ~ 0.5,"
"0","            SPI.FREQ.D1.5.MMRT==2 ~ 0.3,"
"0","            SPI.FREQ.D1.5.MMRT==1 ~ 0.15,"
"0","            SPI.FREQ.D1.5.MMRT==0 ~ 0, "
"0","            TRUE ~ 0"
"0","          )) %>%"
"0","          mutate(SPI.D1.5.MMRT=SPI.FREQ.D1.5.MMRT+SPI.QUAL.D1.5.MMRT) %>% "
"0","          mutate(date=reference_year) %>%"
"0","          select( iso3c, date, starts_with('SPI.')) "
"0",""
"0",""
"0","  assign(paste(""D3.5.AKI"",reference_year,sep=""_""), temp)"
"0","}"
"0",""
"0","D3.5.AKI <- bind_rows(D3.5.AKI_2016, D3.5.AKI_2017, D3.5.AKI_2018, D3.5.AKI_2019)"
"0",""

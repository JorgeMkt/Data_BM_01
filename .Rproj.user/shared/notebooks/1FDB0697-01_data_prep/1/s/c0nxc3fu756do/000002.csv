"0",""
"0",""
"0","#load(paste(dir,""/Data/documentInfoNew Agri.Rdata"", sep=""""))"
"0","documentInfoNew <- readxl::read_excel(paste(dir,""/01_raw_data/1.2_DUNE/Faolex_inventory.xlsx"", sep=""""),"
"0","                                      col_types = c('text','text','text','text','text','text','text','text','date','date','text')) %>%"
"0","  as_tibble(.name_repair = 'universal') %>%"
"0","    mutate(Language.of.document=detect_language(Title, lang_code=FALSE), #check language      "
"0","           Language.of.document=str_to_lower(Language.of.document),"
"0","         Type.of.text=str_to_lower(Type.of.text),"
"0","         Main.area=str_to_lower(Primary.subject),"
"0","         Type.of.text=str_replace_all(Type.of.text,'[[:punct:]]',''),"
"0","         Main.area=str_replace_all(Main.area,'[[:punct:]]',''),"
"0","         url=Rel.file) "
"0",""
"0","#Now fix up the languages"
"0","documentInfoNew <- documentInfoNew %>%"
"0","  group_by(Country) %>%"
"0","  mutate(Language.of.document.typ=first(Language.of.document),"
"0","         Language.of.document=if_else(is.na(Language.of.document),Language.of.document.typ,Language.of.document), #replace language with language of another document in same country if missing"
"0","         Language.of.document=if_else(Language.of.document=='galican','spanish',Language.of.document), # correct one issue where galican was a recommended language"
"0","         Language.of.document=if_else(is.na(Language.of.document),'english',Language.of.document)) #as last resort, assume english document"
"0","  "
"0",""
"0",""
"0","#rename dataframe with document info"
"0","documentInfo <- documentInfoNew"
"0",""
"0","#merge with WB compatible country codes"
"0","ccodes <- read_csv(file=paste(dir, ""/01_raw_data/1.2_DUNE/FAOSTAT_data_5-1-2020_country_codes.csv"", sep="""")) %>%"
"0","  as_tibble(.name_repair='universal') %>%"
"0","  mutate(iso3c=ISO3.Code) %>%"
"0","  select(Country, iso3c) %>%"
"0","  group_by(Country, iso3c) %>%"
"0","  summarise_all(~first(.))"
"0",""
"0","documentInfo <- documentInfo %>%"
"0","  mutate(Country = case_when("
"0","    Country==""Venezuela, Boliv. Rep. of"" ~ ""Venezuela (Bolivarian Republic of)"","
"0","    Country==""Lao, People's Dem. Rep."" ~ ""Lao People's Democratic Republic"","
"0","    Country==""China"" ~ ""China, mainland"","
"0","    Country==""Moldova, Republic of"" ~ ""Republic of Moldova"","
"0","    Country==""Tanzania, Un. Rep. of"" ~ ""United Republic of Tanzania"","
"0","    Country==""Czech Republic"" ~ ""Czechia"","
"0","    Country==""CÃ´te d'Ivoire"" ~ ""Côte d'Ivoire"","
"0","    Country==""Iran, Islamic Republic of"" ~ ""Iran (Islamic Republic of)"","
"0","    Country==""Micronesia, Fed. States"" ~ ""Micronesia (Federated States of)"","
"0","    Country==""Palestinian Authority""  ~ ""Palestine"","
"0","    Country==""Congo, Dem. Rep. of""  ~ ""Democratic Republic of the Congo"","
"0","    Country==""Korea, Dem. People's Rep."" ~ ""Democratic People's Republic of Korea"","
"0","    Country==""Korea, Republic of""  ~ ""Republic of Korea"","
"0","    TRUE ~ Country"
"0","  )) %>% # fix some broken country names"
"0","  left_join(ccodes) %>%"
"0","  select(-Country)"
"0","  "
"0","#merge with official world bank metadata"
"0","country_metadata <- wbstats::wbcountries()"
"0",""
"0","documentInfo <- documentInfo %>%"
"0","  left_join(country_metadata) %>%"
"0","  select(colnames(country_metadata), everything())"
"0",""
"0","#do some basic cleaning"
"0","documentInfo <- documentInfo %>%"
"0","  mutate(Language.of.document=str_to_lower(Language.of.document),"
"0","         Type.of.text=str_to_lower(Type.of.text),"
"0","         Main.area=str_to_lower(Main.area),"
"0","         Language.of.document=str_replace_all(Language.of.document,'[[:punct:]]',''),"
"0","         Type.of.text=str_replace_all(Type.of.text,'[[:punct:]]',''),"
"0","         Main.area=str_replace_all(Main.area,'[[:punct:]]',''),"
"0","         date=year(Date.of.original.text))"
"0",""
"0","#keep just national policy and poverty reduction documents after year 2000"
"0","documentInfo <- documentInfo %>%"
"0","  filter(grepl(""national development"", Main.area)) %>%"
"0","  filter(Type.of.text=='policy') %>%"
"0","  filter(date>=2010)"
"0",""
"0",""
"0",""

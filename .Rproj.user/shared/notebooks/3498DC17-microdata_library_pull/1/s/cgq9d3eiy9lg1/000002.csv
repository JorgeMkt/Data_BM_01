"0",""
"0",""
"0","#Now map the result"
"0","quality = ""high"""
"0","maps <- wbgmaps::wbgmaps[[quality]]"
"0",""
"0","country_list <- wbstats::wbcountries()"
"0",""
"0",""
"0",""
"0",""
"0","ihsn_mapper <- function(indicator,title_text) {"
"0","  "
"0","  indicator<-indicator"
"0",""
"0","  "
"0","  ihsn_map <- study_df_internal %>%"
"0","    rename(country=nation) %>% "
"0","    filter(year_end>=2000) %>% #surveys after 2010"
"0","    filter(grepl(indicator, series_info)) %>%"
"0","    group_by(country) %>%"
"0","    summarise(freq=n()) %>%"
"0","    mutate(ihsn_groups=case_when( #create groupings"
"0","      freq == 0 ~ ""0"","
"0","      freq == 1 ~ ""1"","
"0","      freq == 2 ~ ""2"",      "
"0","      freq == 3 ~ ""3"", "
"0","      freq == 4 ~ ""4"", "
"0","      freq >= 5 ~ ""5+"""
"0","           )) %>%"
"0","    mutate(ihsn_groups=factor(ihsn_groups, levels=c(""0"", ""1"",""2"",""3"",""4"",""5+"" ))) %>%"
"0","    right_join(country_list)"
"0","  "
"0","  "
"0","  "
"0","   ggplot() +"
"0","    geom_map(data = ihsn_map, aes(map_id = iso3c, fill = ihsn_groups), map = maps$countries) + "
"0","    geom_polygon(data = maps$disputed, aes(long, lat, group = group, map_id = id), fill = ""grey80"") + "
"0","    geom_polygon(data = maps$lakes, aes(long, lat, group = group), fill = ""white"")  +"
"0","     geom_path(data = maps$boundaries,"
"0","               aes(long, lat, group = group),"
"0","               color = ""white"","
"0","               size = 0.1,"
"0","               lineend = maps$boundaries$lineend,"
"0","              linetype = maps$boundaries$linetype) +"
"0","    scale_x_continuous(expand = c(0, 0), limits = standard_crop_wintri()$xlim) +"
"0","    scale_y_continuous(expand = c(0, 0), limits = standard_crop_wintri()$ylim) +"
"0","    scale_fill_brewer("
"0","      name='Number of Surveys or Censuses',"
"0","      palette='Greens',"
"0","      na.value='grey'"
"0","    ) +"
"0","    coord_equal() +"
"0","    theme_map(base_size=12) +"
"0","    labs("
"0","      title=str_wrap(title_text,100),"
"0","      caption = 'Source: IHSN Microdata Library'"
"0","    )"
"0",""
"0",""
"0","}"
"0",""
"0",""
"0",""
"0","ihsn_mapper('[hh/ies]|Income/Expenditure/Household Survey' , 'Income/Expenditure/Household Survey')"
"2","`summarise()` ungrouping output (override with `.groups` argument)
"
"2","Joining, by = ""country""
"
"2","Ignoring unknown aesthetics: map_id"

% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Technical Documentation on Data Sources and Methods for Statistical Performance Indicators},
  pdfauthor={Brian Stacy},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi

\title{Technical Documentation on Data Sources and Methods for
Statistical Performance Indicators}
\author{Brian Stacy}
\date{2020-09-04}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{2}
\tableofcontents
}
\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# This block of code will create a blank SPI dataset (only containing country info) that will be appended to when each indicator is added.}
\CommentTok{\# There will be two indicators added for each dimension}
\CommentTok{\# 1. An indicator with a score between 0{-}1 for each dimension}
\CommentTok{\# 2. An indicator with the raw (unscored) values of the indicators}
\CommentTok{\# The unit for this database will be country*year}

\NormalTok{span \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2004}\OperatorTok{:}\DecValTok{2019}\NormalTok{)}

\NormalTok{spi\_df\_empty \textless{}{-}}\StringTok{ }\KeywordTok{bind\_rows}\NormalTok{(}\KeywordTok{replicate}\NormalTok{(}\KeywordTok{length}\NormalTok{(span), wbstats}\OperatorTok{::}\KeywordTok{wbcountries}\NormalTok{(), }\DataTypeTok{simplify =} \OtherTok{FALSE}\NormalTok{), }\DataTypeTok{.id=}\StringTok{\textquotesingle{}date\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date=}\KeywordTok{as.numeric}\NormalTok{(date)}\OperatorTok{+}\NormalTok{span[}\DecValTok{1}\NormalTok{]}\OperatorTok{{-}}\DecValTok{1}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(region}\OperatorTok{!=}\StringTok{"Aggregates"}\NormalTok{) }\CommentTok{\# take out the aggregates (LAC, SAR, etc)}

\NormalTok{spi\_df \textless{}{-}}\StringTok{ }\NormalTok{spi\_df\_empty}

\CommentTok{\#read list of iso3c codes for matching from UN (https://unstats.un.org/unsd/methodology/m49/)}
\NormalTok{iso3c \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\KeywordTok{paste}\NormalTok{(raw\_dir,}\StringTok{\textquotesingle{}metadata/iso\_codes.csv\textquotesingle{}}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{),}
                  \DataTypeTok{col\_types=}\KeywordTok{list}\NormalTok{(}\KeywordTok{col\_character}\NormalTok{(), }\KeywordTok{col\_character}\NormalTok{(), }\KeywordTok{col\_character}\NormalTok{()))}
\end{Highlighting}
\end{Shaded}

\hypertarget{introduction}{%
\section{Introduction}\label{introduction}}

In this program, I will clean and reshape the raw data files in the
01\_rawdata folder in order to produce the Statistical Performance
Indicators.

Below is an overview of the SPI framework.

\includegraphics{SPI_dashboard.png} \# Handling missing data

It is likely that for the initial launch of the Dashboard there will be
several types of missing data.

In the absence of any new data, the existing material collected for the
Statistical Performance Index could be used to populate an initial
dashboard as follows:

• Data use dimension: leave blank

• Data services dimension: use scores for SPI ``dissemination practices
and openness'' dimension

• Data products dimension: use scores for SPI ``availability of key
indicators'' dimension

• Data sources dimension: use scores for SPI ``censuses and surveys''
dimension

• Data infrastructure dimension: use scores for SPI ``methodology,
standard and classifications'' dimension

Indeed, a first iteration Dashboard and toolkit can be demonstrated
using this existing data. As new methods are developed and data are
collected, the Dashboard can progressively be populated. Where it has
not been possible to develop and implement a methodology for the
dashboard tile concerned, this should be left blank to signify that this
is an important issue that has not yet been quantified in a way that
meets the criteria for the Dashboard. This will provide an incentive for
a research agenda and possibly surveys and other mechanisms to fill the
gap for a particular purpose eg a country assessment.

Where it has been possible to develop and implement a methodology but it
has not been possible to find data for a specific country, even though
it is known to exist, the Dashboard tile for that country should also be
left blank and weighting between tiles conducted on the basis of the
tiles that are present.

In some situations, missing data represents a zero score, for example if
there is no evidence that geospatial data is used by the country's
statistical system. In such cases a score of zero should be recorded and
used in the generation of indicators, weightings and rankings.

\hypertarget{key-discussion-points}{%
\section{Key Discussion Points}\label{key-discussion-points}}

Here are a few concerns that I have at the moment, but this is by no
means an exhaustive list. Overall, there are some indicators with issues
in terms of coverage across countries. There are also differences in the
length of the time series for each indicator. Here is a detailed
breakdown by indicator.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Dimension 1 needs more work adding source documents, NSO social media
  accounts. It also needs work refining scoring methodology. This should
  be discussed as a team.\\
\item
  Dimension 2 has no information for the Advisory/Analytical Services
  dimension.
\item
  Dimension 3 is based on the 15 AKI indicators we defined for the
  original SPI. This needs to be discussed, as John had proposed going
  to NSO sites and collecting SDG indicator information. I abandoned
  this approach, because there is no straightforward way of scraping
  this info. To discuss as a team.\\
\item
  Dimension 4 needs more work and refinement particularly on the
  Private/Citizen generated data section.\\
\item
  Dimension 5 also needs work with having a complete set of data for all
  countries. There are major coverage gaps for all indicators, except
  for the Standards dimension which comes from the SPI team.
\end{enumerate}

\hypertarget{data-use}{%
\section{Data Use}\label{data-use}}

Cleaning for Data Use Indicators. Data Use (5 Indicators):\\
- 1.1\_DUNL - Indicator 1.1: Data use by national legislature\\
- 1.2\_DUNE - Indicator 1.2: Data use by national executive branch\\
- 1.3\_DUCS - Indicator 1.3: Data use by civil society\\
- 1.4\_DUAC - Indicator 1.4: Data use by academia\\
- 1.5\_DUIO - Indicator 1.5: Data use by international organizations

\hypertarget{indicator-1.1-data-use-by-national-legislature}{%
\subsection{Indicator 1.1: Data use by national
legislature}\label{indicator-1.1-data-use-by-national-legislature}}

Based on PARIS21 data use indicator (Chapter 4 of Statistical Capacity
Development Outlook) using national legislature website as source.

\hypertarget{indicator-1.2-data-use-by-national-executive-branch}{%
\subsection{Indicator 1.2: Data use by national executive
branch}\label{indicator-1.2-data-use-by-national-executive-branch}}

Based on PARIS21 data use indicator (Chapter 4 of Statistical Capacity
Development Outlook) using national development plans and poverty
reduction plans as a source.

Our main source for this is the FAOLEX database of legislation and
policy documents maintained by the FAO.

\includegraphics{01_data_prep_files/figure-latex/faolex_map-1.pdf}

\hypertarget{indicator-1.3-data-use-by-civil-society}{%
\subsection{Indicator 1.3: Data use by civil
society}\label{indicator-1.3-data-use-by-civil-society}}

Based on PARIS21 data use indicator (Chapter 4 of Statistical Capacity
Development Outlook) using main social media platform in use in country
as source.

We are pulling data from Twitter at this point. We have only accessed a
handful of accounts from NSOs, but this could be quickly scaled up.

\includegraphics{01_data_prep_files/figure-latex/api_plots-1.pdf}

\includegraphics{01_data_prep_files/figure-latex/twitter_map-1.pdf}

\hypertarget{indicator-1.4-data-use-by-academia}{%
\subsection{Indicator 1.4: Data use by
academia}\label{indicator-1.4-data-use-by-academia}}

The idea for this indicator is that countries should be producing
statistical products that are utilized, in this case by academia. As a
measure of this, we use the IHSN database on censuses and surveys
conducted by counties and calculate a ranking of countries based on the
total number of downloads of the censuses and surveys produced by that
country on a per capita basis. In other words, we calculate the total
number of downloads of censuses and surveys for a country, divided by
the population of that country, to produce a ranking. Countries with low
scores on this metric, may either be producing censuses and surveys that
are not in high demand or are not producing or adding a sufficient
number of censuses and surveys to IHSN to register highly on this
measure.

The source for this indicator is the IHSN.

\begin{quote}
The mission of the IHSN is to improve the availability, accessibility,
and quality of survey data within developing countries, and to encourage
the analysis and use of this data by national and international
development decision makers, the research community, and other
stakeholders.
\end{quote}

\begin{quote}
To support this mission, the key objectives of the IHSN are:
\end{quote}

\begin{quote}
Improved coordination of internationally sponsored survey programs, with
emphasis on timing, sequencing, frequency, and cost-effectiveness
Availability of coordinated and practical technical and methodological
guidelines for all stages of the survey life cycle Availability of a
central survey data catalog which would inform data users of the
availability of survey and census data from multiple sources
Availability of standards, tools, and guidelines that would allow data
producers to document, disseminate, and preserve microdata according to
international standards and best practices Improved collaboration
between data producers and users
\end{quote}

IHSN has a database of more than 7,483 surveys as of August 5, 2020.

\includegraphics{01_data_prep_files/figure-latex/ihsn_plots-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/ihsn_plots-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/ihsn_plots-3.pdf}
\includegraphics{01_data_prep_files/figure-latex/ihsn_plots-4.pdf}
\includegraphics{01_data_prep_files/figure-latex/ihsn_plots-5.pdf}

\hypertarget{indicator-1.5-data-use-by-international-organizations}{%
\subsection{Indicator 1.5: Data use by international
organizations}\label{indicator-1.5-data-use-by-international-organizations}}

The following indicator will measure how useful data sources produced in
national statistics systems are for international organizations. We
gather three measures of how useful or reliable country produced
measures are for international organizations. The first on comparability
of poverty estimates for the World Bank reporting on international
poverty. A second on statistics on child mortality for the UN
Inter-agency Group for Child Mortality Estimation. A third on accuracy
of debt reporting as classified by the World Bank. Each of these will be
described in greater detail below.

While these three indicators are not comprehensive of all statistics
produced by countries, they do provide some indication of whether
countries are producing estimates that are useful to international
organizations for their reporting and monitoring efforts.

\hypertarget{poverty-comparability}{%
\subsubsection{Poverty Comparability}\label{poverty-comparability}}

The first measure examines whether comparable poverty estimates are
produced by countries over time. The World Bank's Povcalnet has
introduced a comparability indicator for whether the country produces
comparable poverty estimates over time.
\url{https://blogs.worldbank.org/opendata/apples-apples-povcalnet-introduces-new-comparability-indicator}.
This metadata has been compiled by the Country Poverty Economists in the
World Bank's Poverty and Equity Global Practice. From the Povcalnet
team:

\begin{verbatim}
As countries frequently improve household surveys and measurement methodologies, strict comparability of poverty estimates over time is often limited. Strictly comparable poverty estimates within a country require a consistent production process, including the sampling frame, questionnaires, the methodological construction of the welfare aggregates and poverty lines, a consistent deflation of prices in time and space, among many  other considerations. Thus, the assessment of comparability is country-dependent and relies on the knowledge of the Country Poverty Economist and Regional Poverty Teams of the Poverty Global Practice, as well as close  dialogue with national data producers with intimate knowledge of the survey design and methodology. Within a country, we assume comparability of poverty estimates over time unless there is a known change to survey     methodology, measurement or data structure. More details on the comparability metadata database can be found in Atamanov et al. (2019) (section 4). The database can be downloaded in csv.
\end{verbatim}

The data will be pulled from the WDI and combined with metadata from the
Povcalnet

Scoring is as follows: Quality (1 points total): 1 Point. Comparable
data lasting at least two years within past 5 years 0 Points. No
comparable data within past 5 years

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(povcalnetR) }

\CommentTok{\#the code below is based on public released code by povcalnet team:}
\CommentTok{\#https://github.com/worldbank/Global\_Poverty\_Blogs/blob/master/bg\_povcalnet\_comparability/R/comparability\_breaks.R}

\CommentTok{\# some contants}
\NormalTok{year\_range \textless{}{-}}\StringTok{ }\DecValTok{1990}\OperatorTok{:}\DecValTok{2020}
\NormalTok{metadata\_path \textless{}{-}}\StringTok{ "https://development{-}data{-}hub{-}s3{-}public.s3.amazonaws.com/ddhfiles/506801/povcalnet\_comparability.csv"}

\CommentTok{\# Load data {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}

\NormalTok{metadata \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(metadata\_path)}
\NormalTok{cov\_lkup \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\KeywordTok{names}\NormalTok{(cov\_lkup) \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"N"}\NormalTok{, }\StringTok{"U"}\NormalTok{, }\StringTok{"R"}\NormalTok{, }\StringTok{"A"}\NormalTok{)}

\NormalTok{dat\_lkup \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\KeywordTok{names}\NormalTok{(dat\_lkup) \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"income"}\NormalTok{,}\StringTok{"consumption"}\NormalTok{)}


\NormalTok{pcn \textless{}{-}}\StringTok{ }\KeywordTok{povcalnet}\NormalTok{()}
\NormalTok{pcn}\OperatorTok{$}\NormalTok{coveragetype \textless{}{-}}\StringTok{ }\NormalTok{cov\_lkup[pcn}\OperatorTok{$}\NormalTok{coveragetype]}
\NormalTok{pcn}\OperatorTok{$}\NormalTok{datatype \textless{}{-}}\StringTok{ }\NormalTok{dat\_lkup[pcn}\OperatorTok{$}\NormalTok{datatype]}

\NormalTok{df \textless{}{-}}\StringTok{ }\NormalTok{pcn }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{inner\_join}\NormalTok{(metadata, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"countrycode"}\NormalTok{, }\StringTok{"year"}\NormalTok{, }\StringTok{"coveragetype"}\NormalTok{, }\StringTok{"datatype"}\NormalTok{))}


\CommentTok{\#Now loop from 2016 and 2019, keeping just data inside last 5 years.}
\ControlFlowTok{for}\NormalTok{ (reference\_year }\ControlFlowTok{in} \DecValTok{2004}\OperatorTok{:}\DecValTok{2019}\NormalTok{) \{}
  
\NormalTok{  temp\textless{}{-}df }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{filter}\NormalTok{(coveragetype }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\#keep just nationally representative samples}
\StringTok{        }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{frequency=}\NormalTok{((reference\_year}\OperatorTok{{-}}\KeywordTok{as.numeric}\NormalTok{(year))}\OperatorTok{\textless{}=}\DecValTok{5}\NormalTok{) }\OperatorTok{\&}\StringTok{ }\NormalTok{(reference\_year}\OperatorTok{\textgreater{}=}\KeywordTok{as.numeric}\NormalTok{(year))) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{        }\KeywordTok{filter}\NormalTok{(frequency}\OperatorTok{==}\OtherTok{TRUE}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{group\_by}\NormalTok{(countrycode, comparability) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\#for each country and comparability type, get number of comparable estimates}
\StringTok{        }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{SPI.D1.5.POV=}\KeywordTok{n}\NormalTok{())  }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{ungroup}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{group\_by}\NormalTok{(countrycode) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\#now get a total by country with the max number of comparable estimates}
\StringTok{        }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{SPI.D1.5.POV=}\KeywordTok{max}\NormalTok{(SPI.D1.}\FloatTok{5.}\NormalTok{POV, }\DataTypeTok{na.rm=}\NormalTok{T)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D1.5.POV=}\KeywordTok{if\_else}\NormalTok{(SPI.D1.}\FloatTok{5.}\NormalTok{POV}\OperatorTok{\textgreater{}=}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\#only give point if there is at least two observations that are comparable}
\StringTok{        }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date=}\NormalTok{reference\_year,}
                 \DataTypeTok{iso3c=}\NormalTok{countrycode) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{left\_join}\NormalTok{(country\_metadata) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{select}\NormalTok{( country,iso3c, date, }\KeywordTok{starts\_with}\NormalTok{(}\StringTok{\textquotesingle{}SPI.D1.5.POV\textquotesingle{}}\NormalTok{)) }



  \KeywordTok{assign}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"D3.1.AKI"}\NormalTok{,reference\_year,}\DataTypeTok{sep=}\StringTok{"\_"}\NormalTok{), temp)}
\NormalTok{\}}

\CommentTok{\#now append together and save}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \KeywordTok{c}\NormalTok{(}\DecValTok{2004}\OperatorTok{:}\DecValTok{2019}\NormalTok{)) \{}
  
\NormalTok{  temp\textless{}{-}}\KeywordTok{get}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}D3.1.AKI\_\textquotesingle{}}\NormalTok{,i, }\DataTypeTok{sep=}\StringTok{""}\NormalTok{))}
  
  \ControlFlowTok{if}\NormalTok{ (}\OperatorTok{!}\KeywordTok{exists}\NormalTok{(}\StringTok{\textquotesingle{}D3.1.AKI\textquotesingle{}}\NormalTok{)) \{}
\NormalTok{    D3.}\FloatTok{1.}\NormalTok{AKI\textless{}{-}temp}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    D3.}\FloatTok{1.}\NormalTok{AKI\textless{}{-}D3.}\FloatTok{1.}\NormalTok{AKI }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{bind\_rows}\NormalTok{(temp) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{arrange}\NormalTok{(}\OperatorTok{{-}}\NormalTok{date, iso3c)}
\NormalTok{  \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{mortality-rate-under-5-per-1000-live-births}{%
\subsubsection{Mortality rate, under-5 (per 1,000 live
births)}\label{mortality-rate-under-5-per-1000-live-births}}

UN IGME makes all available source data on child mortality rates
available with metadata on quality.

\url{https://childmortality.org/data/}

Source data can bedivided into data included in the estimation model and
data excluded from the estimation model (note: data may be excluded for
any one of several reasons including data quality or by rule---for
example, indirect estimates from summary birth histories are not
included when direct estimates from the full birth history from the same
survey or census are available).

Countries are assessed for whether they can produce indicators over a
five year period that meet the thresholds set by UN IGME.

Quality (1 points total): 1 Point. At least three indicators that met UN
IGME standards within past 5 years\\
0.67 Points. Two indicators that met UN IGME standards within past 5
years 0.33 Points. One indicators that met UN IGME standards within past
5 years 0 Points. None within past 5 years

Data was pulled on April 13, 2020.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Read in data from UN Inter{-}agency Group for Child Mortality Estimation}



\NormalTok{D3.}\FloatTok{3.}\NormalTok{AKI.MORT \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\DataTypeTok{file=}\KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{\textquotesingle{}3.1\_DPSS/D3.3\_child\_mort\_RAW\_v01.csv\textquotesingle{}}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(INDICATOR}\OperatorTok{==}\StringTok{\textquotesingle{}Under{-}five mortality rate\textquotesingle{}} \OperatorTok{\&}\StringTok{ }\NormalTok{SEX}\OperatorTok{==}\StringTok{\textquotesingle{}Total\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\#keep just observations for under 5 child mortality and for both sexes}
\StringTok{  }\KeywordTok{filter}\NormalTok{(OBS\_STATUS}\OperatorTok{==}\StringTok{\textquotesingle{}Included in IGME\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\# Also keep only surveys that met IGME criteria for inclusion as a nationally representative statistic}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date=}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{str\_extract}\NormalTok{(TIME\_PERIOD, }\StringTok{"\^{}.\{4\}"}\NormalTok{)),}
         \DataTypeTok{country=}\NormalTok{REF\_AREA,}
         \DataTypeTok{D3.CHLD.MORT=}\NormalTok{OBS\_VALUE)}

\CommentTok{\#Now loop from 2016 and 2019, keeping just data inside last 5 years.}
\ControlFlowTok{for}\NormalTok{ (reference\_year }\ControlFlowTok{in} \DecValTok{2004}\OperatorTok{:}\DecValTok{2019}\NormalTok{) \{}
\NormalTok{  temp \textless{}{-}D3.}\FloatTok{3.}\NormalTok{AKI.MORT }\OperatorTok{\%\textgreater{}\%}
\StringTok{          }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{frequency=}\NormalTok{((reference\_year}\OperatorTok{{-}}\KeywordTok{as.numeric}\NormalTok{(date))}\OperatorTok{\textless{}=}\DecValTok{5}\NormalTok{) }\OperatorTok{\&}\StringTok{ }\NormalTok{(reference\_year}\OperatorTok{\textgreater{}=}\KeywordTok{as.numeric}\NormalTok{(date))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{          }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.FREQ.D1.5.CHLD.MORT=}\KeywordTok{if\_else}\NormalTok{(frequency}\OperatorTok{==}\OtherTok{TRUE}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\#create 0,1 variable for whether data point exists for country}
\StringTok{          }\KeywordTok{group\_by}\NormalTok{(country) }\OperatorTok{\%\textgreater{}\%}
\StringTok{          }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{SPI.FREQ.D1.5.CHLD.MORT=}\KeywordTok{sum}\NormalTok{(SPI.FREQ.D1.}\FloatTok{5.}\NormalTok{CHLD.MORT, }\DataTypeTok{na.rm=}\NormalTok{T)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{          }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.FREQ.D1.5.CHLD.MORT=}\KeywordTok{case\_when}\NormalTok{(}
\NormalTok{            SPI.FREQ.D1.}\FloatTok{5.}\NormalTok{CHLD.MORT}\OperatorTok{\textgreater{}=}\DecValTok{3} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{,}
\NormalTok{            SPI.FREQ.D1.}\FloatTok{5.}\NormalTok{CHLD.MORT}\OperatorTok{==}\DecValTok{2} \OperatorTok{\textasciitilde{}}\StringTok{ }\FloatTok{0.67}\NormalTok{,}
\NormalTok{            SPI.FREQ.D1.}\FloatTok{5.}\NormalTok{CHLD.MORT}\OperatorTok{==}\DecValTok{1} \OperatorTok{\textasciitilde{}}\StringTok{ }\FloatTok{0.33}\NormalTok{,}
\NormalTok{            SPI.FREQ.D1.}\FloatTok{5.}\NormalTok{CHLD.MORT}\OperatorTok{==}\DecValTok{0} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0}\NormalTok{,}
            \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0}
\NormalTok{          )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{          }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D1.5.CHLD.MORT=}\NormalTok{SPI.FREQ.D1.}\FloatTok{5.}\NormalTok{CHLD.MORT) }\OperatorTok{\%\textgreater{}\%}
\StringTok{          }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date=}\NormalTok{reference\_year) }\OperatorTok{\%\textgreater{}\%}
\StringTok{          }\KeywordTok{select}\NormalTok{( country, date, }\KeywordTok{starts\_with}\NormalTok{(}\StringTok{\textquotesingle{}SPI.\textquotesingle{}}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{          }\KeywordTok{select}\NormalTok{(}\OperatorTok{{-}}\NormalTok{SPI.FREQ.D1.}\FloatTok{5.}\NormalTok{CHLD.MORT)}


  \KeywordTok{assign}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"D3.3.AKI"}\NormalTok{,reference\_year,}\DataTypeTok{sep=}\StringTok{"\_"}\NormalTok{), temp)}
\NormalTok{\}}

\CommentTok{\#now append together and save}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \KeywordTok{c}\NormalTok{(}\DecValTok{2004}\OperatorTok{:}\DecValTok{2019}\NormalTok{)) \{}
  
\NormalTok{  temp\textless{}{-}}\KeywordTok{get}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}D3.3.AKI\_\textquotesingle{}}\NormalTok{,i, }\DataTypeTok{sep=}\StringTok{""}\NormalTok{))}
  
  \ControlFlowTok{if}\NormalTok{ (}\OperatorTok{!}\KeywordTok{exists}\NormalTok{(}\StringTok{\textquotesingle{}D3.3.AKI\textquotesingle{}}\NormalTok{)) \{}
\NormalTok{    D3.}\FloatTok{3.}\NormalTok{AKI\textless{}{-}temp}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    D3.}\FloatTok{3.}\NormalTok{AKI\textless{}{-}D3.}\FloatTok{3.}\NormalTok{AKI }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{bind\_rows}\NormalTok{(temp) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{arrange}\NormalTok{(}\OperatorTok{{-}}\NormalTok{date, country)}
\NormalTok{  \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{debt-service-ppg-and-imf-only-of-exports-of-goods-services-and-primary-income}{%
\subsubsection{Debt service (PPG and IMF only, \% of exports of goods,
services and primary
income)}\label{debt-service-ppg-and-imf-only-of-exports-of-goods-services-and-primary-income}}

For this indicator, Debt service (PPG and IMF only, \% of exports of
goods, services and primary income), we will pull data from the WDI but
modify the scoring using the WDI metadata on whether the external debt
data is actual, estimated, or preliminary. The status ``as reported
(actual)'' indicates that the country was fully current in its reporting
under the DRS and that World Bank staff are satisfied that the reported
data give an adequate and fair representation of the country's total
public debt. ``Preliminary'' data are based on reported or collected
information, but because of incompleteness or other reasons, an element
of staff estimation is included. ``Estimated'' data indicate that
countries are not current in their reporting and that a significant
element of staff estimation has been necessary for producing the data
tables.

Scoring is as follows:

Quality:

1 Points. Actual value 0.67 Points. Preliminary value 0.33 Points.
Estimated value 0 Points. No value

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# pull in some WDI metadata which will be used for constructing AKI indicators.}
\CommentTok{\# WDI metadata was gathered using previous vintages of WDI from 2016{-}19}
\CommentTok{\# Metadata was gathered and saved as csv files in the 011\_data folder}

\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2016}\OperatorTok{:}\DecValTok{2019}\NormalTok{) \{}
\NormalTok{  temp \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{"/metadata/WDI\_metadata\_"}\NormalTok{,i,}\StringTok{".csv"}\NormalTok{, }\DataTypeTok{sep=}\StringTok{""}\NormalTok{ )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{as\_tibble}\NormalTok{(}\DataTypeTok{.name\_repair=}\StringTok{\textquotesingle{}universal\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{National.accounts.reference.year=}\KeywordTok{as.numeric}\NormalTok{(National.accounts.reference.year),}
           \DataTypeTok{date=}\NormalTok{i)}
  
    \KeywordTok{assign}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"WDI\_metadata"}\NormalTok{,i,}\DataTypeTok{sep=}\StringTok{"\_"}\NormalTok{), temp)}
\NormalTok{\}}

\NormalTok{WDI\_metadata \textless{}{-}}\StringTok{ }\KeywordTok{bind\_rows}\NormalTok{(WDI\_metadata\_}\DecValTok{2016}\NormalTok{, WDI\_metadata\_}\DecValTok{2017}\NormalTok{, WDI\_metadata\_}\DecValTok{2018}\NormalTok{, WDI\_metadata\_}\DecValTok{2019}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#reshape metaadata file}
\NormalTok{D3.}\FloatTok{15.}\NormalTok{AKI \textless{}{-}}\StringTok{ }\NormalTok{WDI\_metadata }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{transmute}\NormalTok{(}\DataTypeTok{iso3c=}\KeywordTok{if\_else}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(Country.Code), Code, Country.Code),}
            \DataTypeTok{date=}\NormalTok{date,}
            \DataTypeTok{External\_debt\_Reporting=}\NormalTok{External.debt.Reporting.status) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D1.5.DT.TDS.DPPF.XP.ZS=} \KeywordTok{case\_when}\NormalTok{(}
\NormalTok{            External\_debt\_Reporting}\OperatorTok{==}\StringTok{\textquotesingle{}Actual\textquotesingle{}} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{,}
\NormalTok{            External\_debt\_Reporting}\OperatorTok{==}\StringTok{\textquotesingle{}Preliminary\textquotesingle{}} \OperatorTok{\textasciitilde{}}\StringTok{ }\FloatTok{0.67}\NormalTok{,}
\NormalTok{            External\_debt\_Reporting}\OperatorTok{==}\StringTok{\textquotesingle{}Estimate\textquotesingle{}} \OperatorTok{\textasciitilde{}}\StringTok{ }\FloatTok{0.33}\NormalTok{,}
            \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0}
\NormalTok{          )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{ungroup}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, date,  }\KeywordTok{contains}\NormalTok{(}\StringTok{\textquotesingle{}SPI.D1.5.DT.TDS.DPPF.XP.ZS\textquotesingle{}}\NormalTok{)) }
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#now combine AKI databases and write to csv}
\NormalTok{D3.AKI \textless{}{-}}\StringTok{ }\NormalTok{D3.}\FloatTok{1.}\NormalTok{AKI }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D3.}\FloatTok{3.}\NormalTok{AKI) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D3.}\FloatTok{15.}\NormalTok{AKI) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{right\_join}\NormalTok{(spi\_df\_empty) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate\_at}\NormalTok{(}\KeywordTok{vars}\NormalTok{(}\KeywordTok{starts\_with}\NormalTok{(}\StringTok{\textquotesingle{}SPI.D1.5.\textquotesingle{}}\NormalTok{)), }\OperatorTok{\textasciitilde{}}\KeywordTok{if\_else}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(.),}\DecValTok{0}\NormalTok{,}\KeywordTok{as.numeric}\NormalTok{(.))) }


\NormalTok{spi\_df \textless{}{-}}\StringTok{ }\NormalTok{spi\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D3.AKI)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{aki \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}
             \DataTypeTok{SPI.D1.5.POV=}\StringTok{\textquotesingle{}Poverty headcount ratio at $1.90 a day (2011 PPP) (\% of population)\textquotesingle{}}\NormalTok{,}
             \DataTypeTok{SPI.D1.5.CHLD.MORT=}\StringTok{\textquotesingle{}Mortality rate, under{-}5 (per 1,000 live births)\textquotesingle{}}\NormalTok{, }
             \DataTypeTok{SPI.D1.5.DT.TDS.DPPF.XP.ZS=}\StringTok{\textquotesingle{}Debt service (PPG and IMF only, \% of exports of goods, services and primary income)\textquotesingle{}}
\NormalTok{)}


\ControlFlowTok{for}\NormalTok{ (ind }\ControlFlowTok{in} \KeywordTok{names}\NormalTok{(aki)) \{}
\NormalTok{  ind \textless{}{-}}\StringTok{ }\NormalTok{ind}
  \KeywordTok{names}\NormalTok{(aki)}
  \KeywordTok{print}\NormalTok{(ind)}
\NormalTok{  temp\_map \textless{}{-}}\StringTok{ }\NormalTok{D3.AKI }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(.data[[ind]] }\OperatorTok{\textgreater{}}\StringTok{ }\DecValTok{0}\NormalTok{)}
  
  \KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}temp\_map\textquotesingle{}}\NormalTok{, ind, aki[[ind]])}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "SPI.D1.5.POV"
\end{verbatim}

\includegraphics{01_data_prep_files/figure-latex/aki_plots-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/aki_plots-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/aki_plots-3.pdf}
\includegraphics{01_data_prep_files/figure-latex/aki_plots-4.pdf}

\begin{verbatim}
## [1] "SPI.D1.5.CHLD.MORT"
\end{verbatim}

\includegraphics{01_data_prep_files/figure-latex/aki_plots-5.pdf}
\includegraphics{01_data_prep_files/figure-latex/aki_plots-6.pdf}
\includegraphics{01_data_prep_files/figure-latex/aki_plots-7.pdf}
\includegraphics{01_data_prep_files/figure-latex/aki_plots-8.pdf}

\begin{verbatim}
## [1] "SPI.D1.5.DT.TDS.DPPF.XP.ZS"
\end{verbatim}

\includegraphics{01_data_prep_files/figure-latex/aki_plots-9.pdf}
\includegraphics{01_data_prep_files/figure-latex/aki_plots-10.pdf}
\includegraphics{01_data_prep_files/figure-latex/aki_plots-11.pdf}
\includegraphics{01_data_prep_files/figure-latex/aki_plots-12.pdf}

\hypertarget{data-services}{%
\section{Data Services}\label{data-services}}

Cleaning for Data Services Indicators. Data Services (4 Indicators):\\
- 2.1\_DSDR - Indicator 2.1: Data releases\\
- 2.2\_DSOA - Indicator 2.2: Online access\\
- 2.3\_DSAS - Indicator 2.3: Advisory/ Analytical Services\\
- 2.4\_DSDS - Indicator 2.4: Data services

\hypertarget{indicator-2.1-data-releases}{%
\subsection{Indicator 2.1: Data
Releases}\label{indicator-2.1-data-releases}}

Data Dissemination Standard (SDDS) and electronic General Data
Dissemination Standard (e-GDDS) were established by the International
Monetary Fund (IMF) for member countries that have or that might seek
access to international capital markets, to guide them in providing
their economic and financial data to the public. Although subscription
is voluntary, the subscribing member needs to be committed to observing
the standard and provide information about its data and data
dissemination practices (metadata). The metadata are posted on the IMF's
SDDS and e-GDDS websites.

1 Point. Subscribing to IMF SDDS+ or SDDS standards 0.5 Points.
Subscribing to IMF e-GDDS standards 0 Points. Otherwise

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Request\_metadata \textless{}{-}}\StringTok{ }\KeywordTok{GET}\NormalTok{(}\DataTypeTok{url =} \StringTok{"http://api.worldbank.org/v2/country/all/indicator/5.21.01.01.sdds?format=json\&date=2004:2015\&per\_page=5000"}\NormalTok{)}
\NormalTok{Response\_metadata \textless{}{-}}\StringTok{ }\KeywordTok{content}\NormalTok{(Request\_metadata, }\DataTypeTok{as =} \StringTok{"text"}\NormalTok{, }\DataTypeTok{encoding =} \StringTok{"UTF{-}8"}\NormalTok{)}

\CommentTok{\# Parse the JSON content and convert it to a data frame.}
\NormalTok{D2}\FloatTok{.1}\NormalTok{\_DSDR\_sci \textless{}{-}}\StringTok{ }\NormalTok{jsonlite}\OperatorTok{::}\KeywordTok{fromJSON}\NormalTok{(Response\_metadata, }\DataTypeTok{flatten =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{data.frame}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{transmute}\NormalTok{(}
    \DataTypeTok{iso3c=}\NormalTok{countryiso3code,}
    \DataTypeTok{country=}\NormalTok{country.value,}
    \DataTypeTok{date=}\KeywordTok{as.numeric}\NormalTok{(date),}
    \DataTypeTok{SDDS=}\NormalTok{value}
\NormalTok{  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(spi\_df\_empty) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\#add on country metadata}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(income)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, country, date, SDDS  ) }



\CommentTok{\#read in csv file.}
\NormalTok{D2}\FloatTok{.1}\NormalTok{\_DSDR \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{\textquotesingle{}/2.1\_DSDR/\textquotesingle{}}\NormalTok{, }\StringTok{"D2.1.GDDS.csv"}\NormalTok{, }\DataTypeTok{sep=}\StringTok{""}\NormalTok{ )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D2.1.GDDS=}\KeywordTok{case\_when}\NormalTok{(}
\NormalTok{    IDDS}\OperatorTok{==}\StringTok{"SDDS Plus"} \OperatorTok{|}\StringTok{ }\NormalTok{IDDS}\OperatorTok{==}\StringTok{"SDDS"}\OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }
\NormalTok{    IDDS}\OperatorTok{==}\StringTok{"e{-}GDDS"}\OperatorTok{\textasciitilde{}}\StringTok{ }\FloatTok{0.5}\NormalTok{,}
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0}\NormalTok{ ),}
    \DataTypeTok{SDDS=}\KeywordTok{case\_when}\NormalTok{(}
\NormalTok{     IDDS}\OperatorTok{==}\StringTok{"SDDS"}\OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0}\NormalTok{ ))  }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{bind\_rows}\NormalTok{(D2}\FloatTok{.1}\NormalTok{\_DSDR\_sci) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{RAW.D2.1.IDDS=}\NormalTok{IDDS) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, country, date, RAW.D2.}\FloatTok{1.}\NormalTok{IDDS, SPI.D2.}\FloatTok{1.}\NormalTok{GDDS  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(date, country)}


\NormalTok{D2}\FloatTok{.1}\NormalTok{\_DSDR\_map \textless{}{-}}\StringTok{ }\NormalTok{D2}\FloatTok{.1}\NormalTok{\_DSDR }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(RAW.D2.}\FloatTok{1.}\NormalTok{IDDS}\OperatorTok{\textgreater{}}\DecValTok{0}\NormalTok{)}

\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}D2.1\_DSDR\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D2.1.GDDS\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SDDS Data Standards in Place\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/idds-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/idds-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/idds-3.pdf}
\includegraphics{01_data_prep_files/figure-latex/idds-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#add to spi databases}
\NormalTok{spi\_df \textless{}{-}}\StringTok{ }\NormalTok{spi\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D2}\FloatTok{.1}\NormalTok{\_DSDR)}
\end{Highlighting}
\end{Shaded}

\hypertarget{indicator-2.2-online-access}{%
\subsection{Indicator 2.2: Online
access}\label{indicator-2.2-online-access}}

This indicator measures the richness and openness of online access.

\hypertarget{source}{%
\subsubsection{Source}\label{source}}

Our source for this indicator is Open Data Watch. From Open Data watch:

\begin{quote}
The Open Data Inventory (ODIN) assesses the coverage and openness of
official statistics to help identify gaps, promote open data policies,
improve access, and encourage dialogue between national statistical
offices (NSOs) and data users. ODIN 2018/19 includes 178 countries,
including most all OECD countries. Two-year comparisons are for all
countries with two years of data between 2015-2017. Scores can be
compared across topics and countries.
\end{quote}

We use the Openness score from ODIN for this measure. The score ranges
from 0-100. It contains scores along five dimensions:\\
- Machine Readability\\
- Non-Proprietary format\\
- Download Options\\
- Metadata Available\\
- Terms of Use

A description for each of these five dimensions is below:

\hypertarget{machine-readability}{%
\paragraph{Machine Readability}\label{machine-readability}}

\begin{quote}
Openness element 1 measures whether data are available in a machine
readable format such as XLS, XLSX, CSV, and JSON. Machine-readable file
formats allow users to easily process data using a computer. When data
are made available in formats that are not machine readable, users
cannot easily access and modify the data, which severely restricts the
scope of the data's use. In many cases PDF versions of datasets within
reports can be useful to users, as the text in conjunction with the
tables gives context and explanation to the figures which helps less
technical users understand the data. Because of this, ODIN assessments
do not penalize countries for making datasets available in PDF or other
non-machine readable formats, unless these formats are the only option
for exporting data. Scores are not penalized for having identical
datasets in both machine readable and non-readable formats. Compression
formats do not affect machine readability scores, only non-proprietary
scores (see next page). Scores are given by data category, not
indicator.
\end{quote}

\hypertarget{non-proprietary-format}{%
\paragraph{Non-Proprietary format}\label{non-proprietary-format}}

\begin{quote}
For the elements of data openness, scoring is calculated independent of
the data coverage. If data files are compressed in RAR format (which is
proprietary), data for that indicator should be considered proprietary
even if the enclosing files are in a non-proprietary format. Files
compressed in ZIP format are not affected.
\end{quote}

\hypertarget{download-options}{%
\paragraph{Download Options}\label{download-options}}

\begin{quote}
Openness element 3 measures whether data are available with three
different download options: bulk download, API, and user-select options.
A bulk download is defined at the indicator level as: The ability to
download all data recorded in ODIN for a particular indicator (all
years, disaggregations, and subnational data) in one file, or multiple
files that can be downloaded simultaneously. Bulk downloads are a key
component of the Open Definition, which requires data to be ``provided
as a whole . . . and downloadable via the internet.'' User-selectable
download options are defined as: Users must be able to select an
indicator and at least one other dimension to create a download or
table. These dimensions could include time periods, geographic
disaggregations, or other recommended disaggregations. An option to
choose the file export format is not enough. API stands for Application
Programming Interface. Ideally, APIs should be clearly displayed on the
website. ODIN assumes APIs are available for the NSOs entire data
collection used in ODIN, unless clearly stated. ODIN assessors do not
register for use or test API functionality. For more information on
APIs, see this guide. Scores are given by data category, not indicator.
\end{quote}

\hypertarget{metadata-available}{%
\paragraph{Metadata Available}\label{metadata-available}}

\begin{quote}
Openness element 4 measures whether metadata are made available. Scores
are given by data category, not indicator. Metadata are defined at the
indicator level as information about how the data are defined/calculated
and collected. ODIN classifies metadata into three categories: (1) Not
Available, (2) Incomplete, and (3) Complete. The following must be
available to classify metadata as complete: • Definition of the
indicator, or definition of key terms used in the indicator description
(as applicable), or how the indicator was calculated. • Publication
(date of upload), compilation date (date on front of report is not
sufficient), or date dataset was last updated. • Name of data source
(what agency collected the data). If the metadata only have one or two
of the above elements, they are scored as incomplete
\end{quote}

\hypertarget{terms-of-use}{%
\paragraph{Terms of Use}\label{terms-of-use}}

\begin{quote}
Openness element 5 measures whether data are available with an open
terms of use. Generally, terms of use (TOU) will apply to an entire
website or data portal (unless otherwise specified). In these cases, all
data found on the same website and/or portal will receive the same
score. If a portal is located on the same domain as the NSO website, the
terms of use on the NSO site will apply. If the data are located on a
portal or website on a different domain, another terms of use will need
to be present. For a policy/ license to be accepted as a terms of use,
it must clearly refer to the data found on the website. Terms of use
that refer to nondata content (such as pictures, logos, etc.) of the
website are not considered. A copyright symbol at the bottom of the page
is not sufficient. A sentence indicating a recommended citation format
is not sufficient. Terms of use are classified the following ways: (1)
Not Available, (2) Restrictive, (3) Semi-Restrictive, and (4) Open. If
the TOU contains one or more restrictive clauses, it receives 0 points
and is classified as ``restrictive.'' Restrictive clauses include:
\end{quote}

For more details, consult the ODIN technical documentation:
\url{https://docs.google.com/document/d/1ubPL1l_3im9bjlCVZ6W2ICAy6UAiXl1hGeA1aXImkxI/edit\#}

\begin{Shaded}
\begin{Highlighting}[]
  \CommentTok{\#read in ODIN data}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2015}\OperatorTok{:}\DecValTok{2018}\NormalTok{) \{}
\NormalTok{   temp \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{\textquotesingle{}/2.2\_DSOA/\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}ODIN\_\textquotesingle{}}\NormalTok{,i,}\StringTok{\textquotesingle{}.csv\textquotesingle{}}\NormalTok{, }\DataTypeTok{sep=}\StringTok{""}\NormalTok{))  }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{as\_tibble}\NormalTok{(}\DataTypeTok{.name\_repair =} \StringTok{\textquotesingle{}universal\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date=}\NormalTok{i) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{filter}\NormalTok{(Data.categories}\OperatorTok{==}\StringTok{\textquotesingle{}All Categories\textquotesingle{}}\NormalTok{)}

    \KeywordTok{assign}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}openness\_df\textquotesingle{}}\NormalTok{,i,}\DataTypeTok{sep=}\StringTok{"\_"}\NormalTok{), temp)}
\NormalTok{  \}}

\CommentTok{\#bind different years together}
\NormalTok{openness\_df \textless{}{-}}\StringTok{ }\KeywordTok{bind\_rows}\NormalTok{(openness\_df\_}\DecValTok{2015}\NormalTok{, openness\_df\_}\DecValTok{2016}\NormalTok{, openness\_df\_}\DecValTok{2017}\NormalTok{, openness\_df\_}\DecValTok{2018}\NormalTok{)}


\NormalTok{openness\_df \textless{}{-}}\StringTok{ }\NormalTok{openness\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{select}\NormalTok{(Country.Code, date, Machine.readable, Non.proprietary, Download.options, Metadata.available, Terms.of.use, Openness.subscore) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{iso3c=}\NormalTok{Country.Code) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{group\_by}\NormalTok{( iso3c) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{right\_join}\NormalTok{(country\_metadata) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}
      \KeywordTok{across}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Machine.readable\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Non.proprietary\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Download.options\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Metadata.available\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Terms.of.use\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Openness.subscore\textquotesingle{}}\NormalTok{),}\OperatorTok{\textasciitilde{}}\KeywordTok{if\_else}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(.), }\DecValTok{0}\NormalTok{, .)           )}
      
\NormalTok{           )  }

\CommentTok{\#do some quick renaming and formatting}
\NormalTok{openness\_df\_temp1 \textless{}{-}}\StringTok{ }\NormalTok{openness\_df }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{rename\_with}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}RAW.D2.2\textquotesingle{}}\NormalTok{,., }\DataTypeTok{sep=}\StringTok{"."}\NormalTok{), }\DataTypeTok{.cols=}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Machine.readable\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Non.proprietary\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Download.options\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Metadata.available\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Terms.of.use\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Openness.subscore\textquotesingle{}}\NormalTok{) ) }


\NormalTok{openness\_df\_temp2 \textless{}{-}}\StringTok{ }\NormalTok{openness\_df }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\KeywordTok{across}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Machine.readable\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Non.proprietary\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Download.options\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Metadata.available\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Terms.of.use\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Openness.subscore\textquotesingle{}}\NormalTok{), }\OperatorTok{\textasciitilde{}}\NormalTok{.}\OperatorTok{/}\DecValTok{100}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename\_with}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}SPI.D2.2\textquotesingle{}}\NormalTok{,., }\DataTypeTok{sep=}\StringTok{"."}\NormalTok{), }\DataTypeTok{.cols=}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Machine.readable\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Non.proprietary\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Download.options\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Metadata.available\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Terms.of.use\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Openness.subscore\textquotesingle{}}\NormalTok{) ) }

\NormalTok{openness\_df \textless{}{-}}\StringTok{ }\NormalTok{openness\_df\_temp1 }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(openness\_df\_temp2)}

\CommentTok{\#add to spi dataframe}
\NormalTok{spi\_df \textless{}{-}}\StringTok{ }\NormalTok{spi\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(openness\_df)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/open_plots-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/open_plots-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/open_plots-3.pdf}

\hypertarget{indicator-2.3-advisory-analytical-services}{%
\subsection{Indicator 2.3: Advisory/ Analytical
Services}\label{indicator-2.3-advisory-analytical-services}}

No established source exists for this indicator. This is experimental.

\hypertarget{indicator-2.4-data-services}{%
\subsection{Indicator 2.4: Data
services}\label{indicator-2.4-data-services}}

NSO has a listing of surveys and microdata sets that can provide the
necessary data and reference for follow-up. Upon well-defined request
and procedure per the national law and practice, users and practitioners
can obtain the data collected from the households and businesses when
needed.

NADA is an open source microdata cataloging system, compliant with the
Data Documentation Initiative (DDI) and Dublin Core's RDF metadata
standards. It serves as a portal for researchers to browse, search,
compare, apply for access, and download relevant census or survey
datasets, questionnaires, reports and other information.

1 Point. Yes 0 Points. No

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#read in csv file.}
\NormalTok{D2}\FloatTok{.4}\NormalTok{\_NADA \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{\textquotesingle{}/2.4\_DSDS/\textquotesingle{}}\NormalTok{, }\StringTok{"D2.4.NADA.csv"}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{ )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D2.4.NADA=}\KeywordTok{case\_when}\NormalTok{(}
\NormalTok{    NADA}\OperatorTok{==}\DecValTok{1} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }
\NormalTok{    NADA}\OperatorTok{==}\DecValTok{0} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0}\NormalTok{, }
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0} 
\NormalTok{  ))  }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{RAW.D2.4.NADA=}\NormalTok{NADA,}
         \DataTypeTok{RAW.D2.4.NADA\_text=}\NormalTok{NADA\_text) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, country, date, RAW.D2.}\FloatTok{4.}\NormalTok{NADA,RAW.D2.}\FloatTok{4.}\NormalTok{NADA\_text, SPI.D2.}\FloatTok{4.}\NormalTok{NADA  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(date, country)}

\NormalTok{D2}\FloatTok{.4}\NormalTok{\_NADA\_map \textless{}{-}}\StringTok{ }\NormalTok{D2}\FloatTok{.4}\NormalTok{\_NADA }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(SPI.D2.}\FloatTok{4.}\NormalTok{NADA}\OperatorTok{\textgreater{}}\DecValTok{0}\NormalTok{)}

\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}D2.4\_NADA\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}RAW.D2.4.NADA\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}NADA in Place\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/nada-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/nada-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/nada-3.pdf}
\includegraphics{01_data_prep_files/figure-latex/nada-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#add to spi databases}
\NormalTok{spi\_df \textless{}{-}}\StringTok{ }\NormalTok{spi\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D2}\FloatTok{.4}\NormalTok{\_NADA)}
\end{Highlighting}
\end{Shaded}

\hypertarget{data-products}{%
\section{Data Products}\label{data-products}}

Cleaning for Data Products Indicators. Data Products (17 Indicators):

\begin{itemize}
\tightlist
\item
  GOAL 1: No Poverty\\
\item
  GOAL 2: Zero Hunger\\
\item
  GOAL 3: Good Health and Well-beingq\\
\item
  GOAL 4: Quality Education\\
\item
  GOAL 5: Gender Equality\\
\item
  GOAL 6: Clean Water and Sanitation\\
\item
  GOAL 7: Affordable and Clean Energy\\
\item
  GOAL 8: Decent Work and Economic Growth\\
\item
  GOAL 9: Industry, Innovation and Infrastructure\\
\item
  GOAL 10: Reduced Inequality\\
\item
  GOAL 11: Sustainable Cities and Communities\\
\item
  GOAL 12: Responsible Consumption and Production\\
\item
  GOAL 13: Climate Action\\
\item
  GOAL 14: Life Below Water\\
\item
  GOAL 15: Life on Land\\
\item
  GOAL 16: Peace and Justice Strong Institutions\\
\item
  GOAL 17: Partnerships to achieve the Goal
\end{itemize}

\hypertarget{scoring-approach}{%
\subsection{Scoring Approach}\label{scoring-approach}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Download the latest SDG indicator data from UN Stats
  (\url{https://unstats.un.org/sdgs/indicators/en/\#}) using their API
\item
  Transform the data so that for each indicator we can create a score
  documenting whether a value exists for the country in a year, whether
  the value is based on country data, country data adjusted, estimated,
  or modelled data according the UN Stats metadata. \textbf{This will
  only include tier 1 indicators}.
\item
  Combine the resulting data into a single set of indicators for use in
  the Statistical Performance Indicators dashboard and index by
  calculating the average across SDGs. This results in 17 total
  indicators. One for each SDG, which is the share of indicators with a
  value meeting quality criteria defined below.
\end{enumerate}

Below is a paraphrased description from the UN stats webpage
(\url{https://unstats.un.org/sdgs/indicators/indicators-list/}):

The global indicator framework for Sustainable Development Goals was
developed by the Inter-Agency and Expert Group on SDG Indicators
(IAEG-SDGs) and agreed upon at the 48th session of the United Nations
Statistical Commission held in March 2017.

The global indicator framework includes 231 unique indicators. Please
note that the total number of indicators listed in the global indicator
framework of SDG indicators is 247. However, twelve indicators repeat
under two or three different targets.

For each value of the indicator, the responsible international agency
has been requested to indicate whether the national data were adjusted,
estimated, modelled or are the result of global monitoring. The
``nature'' of the data in the SDG database is determined as follows:

\begin{itemize}
\item
  Country data (C): Produced and disseminated by the country (including
  data adjusted by the country to meet international standards);
\item
  Country data adjusted (CA): Produced and provided by the country, but
  adjusted by the international agency for international comparability
  to comply with internationally agreed standards, definitions and
  classifications;
\item
  Estimated (E): Estimated based on national data, such as surveys or
  administrative records, or other sources but on the same variable
  being estimated, produced by the international agency when country
  data for some year(s) is not available, when multiple sources exist,
  or when there are data quality issues;
\item
  Modelled (M): Modelled by the agency on the basis of other covariates
  when there is a complete lack of data on the variable being estimated;
\item
  Global monitoring data (G): Produced on a regular basis by the
  designated agency for global monitoring, based on country data. There
  is no corresponding figure at the country level.
\end{itemize}

\hypertarget{scoring}{%
\section{Scoring}\label{scoring}}

For each indicator, we will produce a value for each country with the
following coding scheme:

\begin{itemize}
\tightlist
\item
  \textbf{1 Point}: Indicator exists and the value is based on the
  \textbf{country}, \textbf{country data adjusted}, or \textbf{estimated
  or Global Monitoring} data\\
\item
  \textbf{0 Points}: Indicator \textbf{based on modeled data or does not
  exists}
\end{itemize}

We give countries no credit for modeled data, because the country did
not produce indicators in a form that was directly usable for reporting
on an SDG indicator.

When we average over all indicators in a goal to get a score, we compute
a 5 year moving average to avoid year to year variability in reporting
for SDGs. The overall score for an SDG is then the 5 year average of the
percentage of indicator values based on \textbf{country},
\textbf{country data adjusted}, or \textbf{estimated or Global
Monitoring} data that were available for the SDG.

Because of the large data files and runtime of the program to calculate
these indicators, the code to produce these indicators is in a separate
file.
\url{https://github.com/stacybri/UN_Stats_SDG_Indicators_SPI/blob/master/02_programs/un_stats_cleaning.Rmd}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{un\_sdg\_df \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\KeywordTok{paste}\NormalTok{(raw\_dir,}\StringTok{\textquotesingle{}/3\_DP/SPI\_D3\_UNSD\_data\_5yr.csv\textquotesingle{}}\NormalTok{,}\DataTypeTok{sep=}\StringTok{""}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{SPI.D3.1.POV   =}\NormalTok{ SPI.D3}\FloatTok{.1}\NormalTok{,}
         \DataTypeTok{SPI.D3.2.HNGR  =}\NormalTok{ SPI.D3}\FloatTok{.2}\NormalTok{,}
         \DataTypeTok{SPI.D3.3.HLTH  =}\NormalTok{ SPI.D3}\FloatTok{.3}\NormalTok{,}
         \DataTypeTok{SPI.D3.4.EDUC  =}\NormalTok{ SPI.D3}\FloatTok{.4}\NormalTok{,}
         \DataTypeTok{SPI.D3.5.GEND  =}\NormalTok{ SPI.D3}\FloatTok{.5}\NormalTok{,}
         \DataTypeTok{SPI.D3.6.WTRS  =}\NormalTok{ SPI.D3}\FloatTok{.6}\NormalTok{,}
         \DataTypeTok{SPI.D3.7.ENRG  =}\NormalTok{ SPI.D3}\FloatTok{.7}\NormalTok{,}
         \DataTypeTok{SPI.D3.8.WORK  =}\NormalTok{ SPI.D3}\FloatTok{.8}\NormalTok{,}
         \DataTypeTok{SPI.D3.9.INDY  =}\NormalTok{ SPI.D3}\FloatTok{.9}\NormalTok{,}
         \DataTypeTok{SPI.D3.10.NEQL =}\NormalTok{ SPI.D3}\FloatTok{.10}\NormalTok{,}
         \DataTypeTok{SPI.D3.11.CITY =}\NormalTok{ SPI.D3}\FloatTok{.11}\NormalTok{,}
         \DataTypeTok{SPI.D3.12.CNSP =}\NormalTok{ SPI.D3}\FloatTok{.12}\NormalTok{,}
         \DataTypeTok{SPI.D3.13.CLMT =}\NormalTok{ SPI.D3}\FloatTok{.13}\NormalTok{,}
         \DataTypeTok{SPI.D3.14.LFWT =}\NormalTok{ SPI.D3}\FloatTok{.14}\NormalTok{,}
         \DataTypeTok{SPI.D3.15.LAND =}\NormalTok{ SPI.D3}\FloatTok{.15}\NormalTok{,}
         \DataTypeTok{SPI.D3.16.INST =}\NormalTok{ SPI.D3}\FloatTok{.16}\NormalTok{,}
         \DataTypeTok{SPI.D3.17.PTNS =}\NormalTok{ SPI.D3}\FloatTok{.17}
\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(country, date, }\KeywordTok{starts\_with}\NormalTok{(}\StringTok{"SPI"}\NormalTok{)) }

\CommentTok{\#add to spi databases}
\NormalTok{spi\_df \textless{}{-}}\StringTok{ }\NormalTok{spi\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(un\_sdg\_df)}

\CommentTok{\#map the values}
\NormalTok{un\_sdg\_map \textless{}{-}}\StringTok{ }\NormalTok{un\_sdg\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(country, date, }\KeywordTok{starts\_with}\NormalTok{(}\StringTok{"SPI"}\NormalTok{)) }

\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.1.POV\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 1: No Poverty\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-3.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.2.HNGR\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 2: No Hunger\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-5.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-6.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-7.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-8.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.3.HLTH\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 3: Good Health and Well{-}being\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-9.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-10.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-11.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-12.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.4.EDUC\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 4: Quality Education  \textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-13.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-14.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-15.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-16.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.5.GEND\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 5: Gender Equality \textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-17.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-18.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-19.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-20.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.6.WTRS\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 6: Clean Water and Sanitation \textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-21.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-22.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-23.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-24.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.7.ENRG\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 7: Affordable and Clean Energy\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-25.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-26.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-27.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-28.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.8.WORK\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 8: Decent Work and Economic Growth  \textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-29.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-30.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-31.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-32.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.9.INDY\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 9: Industry, Innovation and Infrastructure \textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-33.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-34.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-35.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-36.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.10.NEQL\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 10: Reduced Inequality   \textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-37.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-38.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-39.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-40.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.11.CITY\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 11: Sustainable Cities and Communities\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-41.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-42.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-43.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-44.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.12.CNSP\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 12: Responsible Consumption and Production   \textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-45.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-46.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-47.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-48.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.13.CLMT\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 13: Climate Action\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-49.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-50.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-51.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-52.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.14.LFWT\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 14: Life Below Water\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-53.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-54.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-55.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-56.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.15.LAND\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 15: Life on Land\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-57.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-58.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-59.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-60.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.16.INST\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 16: Peace and Justice Strong Institutions\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-61.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-62.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-63.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-64.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}un\_sdg\_map\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}SPI.D3.17.PTNS\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Goal 17: Partnerships to achieve the Goal  \textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/unstats-65.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-66.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-67.pdf}
\includegraphics{01_data_prep_files/figure-latex/unstats-68.pdf}

\hypertarget{data-sources}{%
\section{Data Sources}\label{data-sources}}

Cleaning for the Data Sources Indicators. Data Sources (4 Indicators):\\
- 4.1\_SOCS - Indicator 4.1: censuses and surveys\\
- 4.2\_SOAD - Indicator 4.2: administrative data\\
- 4.3\_SOGS - Indicator 4.3: geospatial data\\
- 4.4\_SOPC - Indicator 4.4: private/citizen generated data

\hypertarget{indicator-4.1-censuses-and-surveys}{%
\subsection{Indicator 4.1: censuses and
surveys}\label{indicator-4.1-censuses-and-surveys}}

This indicator draws from data collected by the Statistical Performance
Indicators team. The following censuses and surveys are considered:

\begin{itemize}
\tightlist
\item
  Population \& Housing census\\
\item
  Agriculture census\\
\item
  Business/establishment census\\
\item
  Household Survey on income/ consumption/ expenditure/ budget/
  Integrated Survey\\
\item
  Agriculture survey\\
\item
  Labor Force Survey\\
\item
  Health/Demographic survey\\
\item
  Business/establishment survey
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Request\_metadata \textless{}{-}}\StringTok{ }\KeywordTok{GET}\NormalTok{(}\DataTypeTok{url =} \StringTok{"https://api.worldbank.org/v2/sources/2/country/all/metadata?per\_page=30000\&format=json"}\NormalTok{)}
\NormalTok{Response\_metadata \textless{}{-}}\StringTok{ }\KeywordTok{content}\NormalTok{(Request\_metadata, }\DataTypeTok{as =} \StringTok{"text"}\NormalTok{, }\DataTypeTok{encoding =} \StringTok{"UTF{-}8"}\NormalTok{)}

\CommentTok{\# Parse the JSON content and convert it to a data frame.}
\NormalTok{JSON\_metadata \textless{}{-}}\StringTok{ }\NormalTok{jsonlite}\OperatorTok{::}\KeywordTok{fromJSON}\NormalTok{(Response\_metadata, }\DataTypeTok{flatten =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{data.frame}\NormalTok{()}

\CommentTok{\#do some conversion to produce a dataframe}
\NormalTok{df \textless{}{-}}\StringTok{ }\NormalTok{JSON\_metadata}\OperatorTok{$}\NormalTok{source.concept }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{data.frame}\NormalTok{() }

\CommentTok{\#do some more cleaning and conversion}
\NormalTok{df \textless{}{-}}\StringTok{ }\NormalTok{df}\OperatorTok{$}\NormalTok{variable }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{data.frame}\NormalTok{()   }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{iso3c=}\NormalTok{id) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{unnest}\NormalTok{(metatype) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{pivot\_wider}\NormalTok{(}
    \DataTypeTok{id\_cols=}\NormalTok{iso3c,}
    \DataTypeTok{names\_from=}\NormalTok{id,}
    \DataTypeTok{values\_from=}\NormalTok{value}
\NormalTok{  ) }

\NormalTok{census\_df \textless{}{-}}\StringTok{ }\NormalTok{df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{country=}\NormalTok{ShortName) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(IncomeGroup)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{indicator\_date=}\KeywordTok{as.numeric}\NormalTok{(Latestpopulationcensus))}

\CommentTok{\#Now calculate our SPI score for this indicator}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2016}\OperatorTok{:}\DecValTok{2019}\NormalTok{) \{}
\NormalTok{  temp \textless{}{-}}\StringTok{ }\NormalTok{census\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date=}\NormalTok{i) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{last\_val=}\KeywordTok{str\_extract}\NormalTok{(Latestpopulationcensus, }\StringTok{"}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{d\{4\}"}\NormalTok{) )}\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{last\_val=}\KeywordTok{as.numeric}\NormalTok{(last\_val)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{indicator=}\KeywordTok{case\_when}\NormalTok{(}
\NormalTok{      (date}\OperatorTok{{-}}\NormalTok{last\_val}\OperatorTok{\textless{}=}\DecValTok{10}\NormalTok{) }\OperatorTok{\&}\StringTok{ }\NormalTok{(date}\OperatorTok{{-}}\NormalTok{last\_val}\OperatorTok{\textgreater{}}\DecValTok{0}\NormalTok{) }\OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{,}
\NormalTok{      (date}\OperatorTok{{-}}\NormalTok{last\_val}\OperatorTok{\textless{}=}\DecValTok{20}\NormalTok{) }\OperatorTok{\&}\StringTok{ }\NormalTok{(date}\OperatorTok{{-}}\NormalTok{last\_val}\OperatorTok{\textgreater{}}\DecValTok{0}\NormalTok{) }\OperatorTok{\textasciitilde{}}\StringTok{ }\FloatTok{0.5}\NormalTok{,}
      \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0}\NormalTok{ )}
\NormalTok{    )  }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{ungroup}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{select}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}iso3c\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}country\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}date\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}last\_val\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}indicator\textquotesingle{}}\NormalTok{)  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{arrange}\NormalTok{(date, country)}
  
  
  \KeywordTok{assign}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}temp\textquotesingle{}}\NormalTok{,i,}\DataTypeTok{sep=}\StringTok{"\_"}\NormalTok{), temp)}
\NormalTok{\}}

\NormalTok{temp \textless{}{-}}\StringTok{ }\NormalTok{temp\_}\DecValTok{2019}

\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2016}\OperatorTok{:}\DecValTok{2018}\NormalTok{) \{}
\NormalTok{  temp \textless{}{-}}\StringTok{ }\KeywordTok{bind\_rows}\NormalTok{(temp, }\KeywordTok{get}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}temp\textquotesingle{}}\NormalTok{,i,}\DataTypeTok{sep=}\StringTok{"\_"}\NormalTok{)))}
\NormalTok{\}}
\NormalTok{temp}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 872 x 5
##    iso3c country              date last_val indicator
##    <chr> <chr>               <int>    <dbl>     <dbl>
##  1 AFG   Afghanistan          2019     1979       0  
##  2 ALB   Albania              2019     2011       1  
##  3 DZA   Algeria              2019     2008       0.5
##  4 ASM   American Samoa       2019     2010       1  
##  5 AND   Andorra              2019     2011       1  
##  6 AGO   Angola               2019     2014       1  
##  7 ATG   Antigua and Barbuda  2019     2011       1  
##  8 ARG   Argentina            2019     2010       1  
##  9 ARM   Armenia              2019     2011       1  
## 10 ABW   Aruba                2019     2010       1  
## # ... with 862 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cs\_fun  \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data, input\_var) \{}
  
\NormalTok{  data \textless{}{-}}\StringTok{ }\NormalTok{data}
\NormalTok{  input\_var \textless{}{-}}\StringTok{ }\NormalTok{input\_var}

  \CommentTok{\#read in csv file.}
\NormalTok{  cs\_df \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{\textquotesingle{}/4.1\_SOCS/\textquotesingle{}}\NormalTok{, data, }\StringTok{".csv"}\NormalTok{, }\DataTypeTok{sep=}\StringTok{""}\NormalTok{ )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{group\_by}\NormalTok{(iso3c, country) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{    }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{input\_var =} \OperatorTok{!!}\StringTok{ }\NormalTok{input\_var) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{nest}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\# The next chunk of code will split our string with the years of the census (i.e. "2000, 2010") in to separate rows.  We will then aggregate up.}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}
      \DataTypeTok{temp\_col =} \KeywordTok{map}\NormalTok{(}
\NormalTok{        data, }
        \OperatorTok{\textasciitilde{}}\StringTok{ }\KeywordTok{str\_extract\_all}\NormalTok{(.x}\OperatorTok{$}\NormalTok{input\_var, }\StringTok{"}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{d\{4\}"}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{          }\KeywordTok{flatten}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{          }\KeywordTok{map\_chr}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{return}\NormalTok{(.x)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{          }\KeywordTok{as\_tibble}\NormalTok{()}
\NormalTok{      )}
\NormalTok{    ) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{    }\KeywordTok{unnest}\NormalTok{(}\DataTypeTok{keep\_empty =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\# Now we have a database with the observations equal to Country*Census observations.  From here we can calculate latest census, etc.}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{indicator\_date=}\KeywordTok{as.numeric}\NormalTok{(value)) }
  
  
  
  \CommentTok{\#Now calculate our SPI score for this indicator}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2004}\OperatorTok{:}\DecValTok{2019}\NormalTok{) \{}
\NormalTok{   temp \textless{}{-}}\StringTok{ }\NormalTok{cs\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date=}\NormalTok{i) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{recency\_indicator=}\NormalTok{((date}\OperatorTok{\textgreater{}}\NormalTok{indicator\_date)) ) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\#restrict to censuses that do not occur after reference date}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{indicator\_date=}\KeywordTok{if\_else}\NormalTok{(recency\_indicator}\OperatorTok{==}\OtherTok{TRUE}\NormalTok{, indicator\_date, }\KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{group\_by}\NormalTok{(iso3c, country, date, database\_last\_updated, input\_var ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{last\_val=}\KeywordTok{max}\NormalTok{(indicator\_date, }\DataTypeTok{na.rm=}\NormalTok{T)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{indicator=}\KeywordTok{case\_when}\NormalTok{(}
\NormalTok{      (date}\OperatorTok{{-}}\NormalTok{last\_val}\OperatorTok{\textless{}=}\DecValTok{10}\NormalTok{) }\OperatorTok{\&}\StringTok{ }\NormalTok{(date}\OperatorTok{{-}}\NormalTok{last\_val}\OperatorTok{\textgreater{}}\DecValTok{0}\NormalTok{) }\OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{,}
\NormalTok{      (date}\OperatorTok{{-}}\NormalTok{last\_val}\OperatorTok{\textless{}=}\DecValTok{20}\NormalTok{) }\OperatorTok{\&}\StringTok{ }\NormalTok{(date}\OperatorTok{{-}}\NormalTok{last\_val}\OperatorTok{\textgreater{}}\DecValTok{0}\NormalTok{) }\OperatorTok{\textasciitilde{}}\StringTok{ }\FloatTok{0.5}\NormalTok{,}
      \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0}\NormalTok{ )}
\NormalTok{    )  }\OperatorTok{\%\textgreater{}\%}
\StringTok{     }\KeywordTok{ungroup}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{select}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}iso3c\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}country\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}date\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}input\_var\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}indicator\textquotesingle{}}\NormalTok{)  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{arrange}\NormalTok{(date, country)}

    \KeywordTok{assign}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}temp\textquotesingle{}}\NormalTok{,i,}\DataTypeTok{sep=}\StringTok{"\_"}\NormalTok{), temp)}
\NormalTok{  \}}

\NormalTok{  temp \textless{}{-}}\StringTok{ }\NormalTok{temp\_}\DecValTok{2019}
  
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2004}\OperatorTok{:}\DecValTok{2018}\NormalTok{) \{}
\NormalTok{    temp \textless{}{-}}\StringTok{ }\KeywordTok{bind\_rows}\NormalTok{(temp, }\KeywordTok{get}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}temp\textquotesingle{}}\NormalTok{,i,}\DataTypeTok{sep=}\StringTok{"\_"}\NormalTok{)))}
\NormalTok{  \}}
\NormalTok{  temp}
\NormalTok{\}}

\CommentTok{\#Population Censuses}
\NormalTok{cs1\_df \textless{}{-}}\KeywordTok{cs\_fun}\NormalTok{(}\StringTok{\textquotesingle{}D4.1.1.CEN.POPU\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}POPU.CENSUS\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{RAW.D4.1.1.POPU.CENSUS=}\NormalTok{input\_var,}
         \DataTypeTok{SPI.D4.1.1.POPU=}\NormalTok{indicator)}

\CommentTok{\#Agriculture census  }
\NormalTok{cs2\_df \textless{}{-}}\KeywordTok{cs\_fun}\NormalTok{(}\StringTok{\textquotesingle{}D4.1.2.CEN.AGRI\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}AGRI.CENSUS\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{RAW.D4.1.2.AGRI.CENSUS=}\NormalTok{input\_var,}
         \DataTypeTok{SPI.D4.1.2.AGRI=}\NormalTok{indicator)}

\CommentTok{\#Business/establishment census }
\NormalTok{cs3\_df \textless{}{-}}\KeywordTok{cs\_fun}\NormalTok{(}\StringTok{\textquotesingle{}D4.1.3.CEN.BIZZ\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}BIZZ.CENSUS\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{RAW.D4.1.3.BIZZ.CENSUS=}\NormalTok{input\_var,}
         \DataTypeTok{SPI.D4.1.3.BIZZ=}\NormalTok{indicator)}

\CommentTok{\#Household Survey on income/ consumption/ expenditure/ budget/ Integrated Survey}
\NormalTok{cs4\_df \textless{}{-}}\KeywordTok{cs\_fun}\NormalTok{(}\StringTok{\textquotesingle{}D4.1.4.SVY.HOUS\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}HOUS.SURVEYS\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{RAW.D4.1.4.HOUS.SURVEYS=}\NormalTok{input\_var,}
         \DataTypeTok{SPI.D4.1.4.HOUS=}\NormalTok{indicator)}

\CommentTok{\#Agriculture survey }
\NormalTok{cs5\_df \textless{}{-}}\KeywordTok{cs\_fun}\NormalTok{(}\StringTok{\textquotesingle{}D4.1.5.SVY.AGRI\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}AGRI.SURVEYS\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{RAW.D4.1.5.AGRI.SURVEYS=}\NormalTok{input\_var,}
         \DataTypeTok{SPI.D4.1.5.AGSVY=}\NormalTok{indicator)}

\CommentTok{\#Labor Force Survey }
\NormalTok{cs6\_df \textless{}{-}}\KeywordTok{cs\_fun}\NormalTok{(}\StringTok{\textquotesingle{}D4.1.6.SVY.LABR\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}LABR.SURVEYS\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{RAW.D4.1.6.LABR.SURVEYS=}\NormalTok{input\_var,}
         \DataTypeTok{SPI.D4.1.6.LABR=}\NormalTok{indicator)}

\CommentTok{\#Health/Demographic survey}
\NormalTok{cs7\_df \textless{}{-}}\KeywordTok{cs\_fun}\NormalTok{(}\StringTok{\textquotesingle{}D4.1.7.SVY.HLTH\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}HLTH.SURVEYS\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{RAW.D4.1.7.HLTH.SURVEYS=}\NormalTok{input\_var,}
         \DataTypeTok{SPI.D4.1.7.HLTH=}\NormalTok{indicator)}

\CommentTok{\#Business/establishment survey  }
\NormalTok{cs8\_df \textless{}{-}}\KeywordTok{cs\_fun}\NormalTok{(}\StringTok{\textquotesingle{}D4.1.8.SVY.BIZZ\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}BIZZ.SURVEYS\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{RAW.D4.1.8.BIZZ.SURVEYS=}\NormalTok{input\_var,}
         \DataTypeTok{SPI.D4.1.8.BZSVY=}\NormalTok{indicator)}


\CommentTok{\#brind all censuses and surveys together}
\NormalTok{cs\_df \textless{}{-}}\StringTok{ }\NormalTok{cs1\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(cs2\_df) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(cs3\_df) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(cs4\_df) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(cs5\_df) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(cs6\_df) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(cs7\_df) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(cs8\_df) }

\CommentTok{\#add to spi databases}
\NormalTok{spi\_df \textless{}{-}}\StringTok{ }\NormalTok{spi\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(cs\_df)}

\CommentTok{\#now do the figures }
\NormalTok{cs\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{cs\_df }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(SPI.D4.}\DecValTok{1}\NormalTok{.}\FloatTok{1.}\NormalTok{POPU))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}cs\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.1.1.POPU\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Population Census Available in Past 20 Years in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/cs-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-3.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cs\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{cs\_df }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(SPI.D4.}\DecValTok{1}\NormalTok{.}\FloatTok{2.}\NormalTok{AGRI))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}cs\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.1.2.AGRI\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Agriculture Census Available in Past 20 Years in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/cs-5.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-6.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-7.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-8.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cs\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{cs\_df }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(SPI.D4.}\DecValTok{1}\NormalTok{.}\FloatTok{3.}\NormalTok{BIZZ))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}cs\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.1.3.BIZZ\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Business/Establishment Census Available in Past 20 Years in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/cs-9.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-10.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-11.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-12.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cs\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{cs\_df }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(SPI.D4.}\DecValTok{1}\NormalTok{.}\FloatTok{4.}\NormalTok{HOUS))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}cs\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.1.4.HOUS\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Household Survey Available in Past 20 Years in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/cs-13.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-14.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-15.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-16.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cs\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{cs\_df }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(SPI.D4.}\DecValTok{1}\NormalTok{.}\FloatTok{5.}\NormalTok{AGSVY))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}cs\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.1.5.AGSVY\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Agriculture Survey Available in Past 20 Years in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/cs-17.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-18.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-19.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-20.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cs\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{cs\_df }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(SPI.D4.}\DecValTok{1}\NormalTok{.}\FloatTok{6.}\NormalTok{LABR))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}cs\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.1.6.LABR\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Labor Force Survey Available in Past 20 Years in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/cs-21.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-22.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-23.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-24.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cs\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{cs\_df }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(SPI.D4.}\DecValTok{1}\NormalTok{.}\FloatTok{7.}\NormalTok{HLTH))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}cs\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.1.7.HLTH\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Health Survey Available in Past 20 Years in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/cs-25.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-26.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-27.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-28.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cs\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{cs\_df }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(SPI.D4.}\DecValTok{1}\NormalTok{.}\FloatTok{8.}\NormalTok{BZSVY))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}cs\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.1.8.BZSVY\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Business Survey Available in Past 20 Years in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/cs-29.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-30.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-31.pdf}
\includegraphics{01_data_prep_files/figure-latex/cs-32.pdf}

\hypertarget{indicator-4.2-administrative-data}{%
\subsection{Indicator 4.2: administrative
data}\label{indicator-4.2-administrative-data}}

The following indicator checks whether administrative data is available
for the following topic areas: Social Protection, Education, Population
\& Health, and Labor

\hypertarget{social-protection-admin-data}{%
\subsubsection{Social Protection Admin
Data}\label{social-protection-admin-data}}

\begin{itemize}
\tightlist
\item
  Atlas of Social Protection Indicators of Resilience and Equity
  (ASPIRE) is compilation of Social Protection and Labor (SPL)
  indicators to analyze scope and performance of SPL programs.\\
\item
  ASPIRE has indicators for 136 countries on:

  \begin{itemize}
  \tightlist
  \item
    Social assistance\\
  \item
    Social insurance\\
  \item
    Labor market programs
  \end{itemize}
\item
  Based on both program-level administrative data and national household
  survey data\\
\item
  Data extends from 2001 to 2018
\end{itemize}

Scoring is 1 if administrative data is available to produce beneficiary
counts or expenditures for any social protection and labor program, 0
otherwise. In order to smooth out gaps in reporting, we take a moving 5
year average of the score.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#read data}
\NormalTok{aspire\_df\_raw \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{\textquotesingle{}4.2\_SOAD\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}ASPIRE\_sources.csv\textquotesingle{}}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{))}

\CommentTok{\#cleaning of aspire data}
\NormalTok{aspire\_df \textless{}{-}}\StringTok{ }\NormalTok{aspire\_df\_raw }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date=}\KeywordTok{as.numeric}\NormalTok{(year)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{group\_by}\NormalTok{( ccode, date) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{ben\_count=}\KeywordTok{mean}\NormalTok{(ben, }\DataTypeTok{na.rm=}\NormalTok{T),}
              \DataTypeTok{ben\_exp=}\KeywordTok{mean}\NormalTok{(exp\_b, }\DataTypeTok{na.rm=}\NormalTok{T)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{iso3c=}\NormalTok{ccode) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{left\_join}\NormalTok{(country\_metadata) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{ben\_info=}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(ben\_count) }\OperatorTok{|}\StringTok{ }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(ben\_exp))}
\NormalTok{           )}

\CommentTok{\#create 5 year moving average}
\NormalTok{aspire\_fun \textless{}{-}}\StringTok{ }\ControlFlowTok{function}\NormalTok{(date\_start, date\_end) \{}
\NormalTok{  temp \textless{}{-}}\StringTok{ }\NormalTok{aspire\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{filter}\NormalTok{(}\KeywordTok{between}\NormalTok{(date,date\_start,date\_end) ) }\OperatorTok{\%\textgreater{}\%}\StringTok{  }
\StringTok{      }\KeywordTok{group\_by}\NormalTok{(iso3c, country) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{ben\_info=}\KeywordTok{if\_else}\NormalTok{(ben\_info}\OperatorTok{==}\OtherTok{TRUE}\NormalTok{,}\KeywordTok{as.numeric}\NormalTok{(ben\_info), }\DecValTok{0}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{ben\_info=}\KeywordTok{round}\NormalTok{(}\KeywordTok{mean}\NormalTok{(ben\_info),}\DecValTok{1}\NormalTok{) }\CommentTok{\#get an average of this across countries}
\NormalTok{              ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D4.2.1.SPL=}\KeywordTok{if\_else}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(ben\_info),}\DecValTok{0}\NormalTok{, ben\_info),}
            \DataTypeTok{RAW.D4.2.1.SPL=}\NormalTok{ben\_info) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date=}\NormalTok{date\_end) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{select}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}iso3c\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}country\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}date\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}RAW.D4.2.1.SPL\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.2.1.SPL\textquotesingle{}}\NormalTok{)  )}
      
  

\NormalTok{\}}



\CommentTok{\#\#\#\#}
\CommentTok{\# 5 Year moving average}
\CommentTok{\#\#\#\#}
\CommentTok{\#create this database for each year from 2004 to 2019 using a 5 year average}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \KeywordTok{c}\NormalTok{(}\DecValTok{2004}\OperatorTok{:}\DecValTok{2019}\NormalTok{)) \{}
  
\NormalTok{  start=i}\DecValTok{{-}4}
\NormalTok{  end=i}
  
\NormalTok{  temp\_df \textless{}{-}}\StringTok{ }\KeywordTok{aspire\_fun}\NormalTok{(start,end)}
  \KeywordTok{assign}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}aspire\_\textquotesingle{}}\NormalTok{,end, }\DataTypeTok{sep=}\StringTok{""}\NormalTok{), temp\_df)}
\NormalTok{\}}

\ControlFlowTok{if}\NormalTok{ (}\KeywordTok{exists}\NormalTok{(}\StringTok{\textquotesingle{}aspire\_df\textquotesingle{}}\NormalTok{)) \{}
  \KeywordTok{rm}\NormalTok{(}\StringTok{\textquotesingle{}aspire\_df\textquotesingle{}}\NormalTok{)}
\NormalTok{\}}
\CommentTok{\#now append together and save}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \KeywordTok{c}\NormalTok{(}\DecValTok{2004}\OperatorTok{:}\DecValTok{2019}\NormalTok{)) \{}
  
\NormalTok{  temp\textless{}{-}}\KeywordTok{get}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}aspire\_\textquotesingle{}}\NormalTok{,i, }\DataTypeTok{sep=}\StringTok{""}\NormalTok{))}
  
  \ControlFlowTok{if}\NormalTok{ (}\OperatorTok{!}\KeywordTok{exists}\NormalTok{(}\StringTok{\textquotesingle{}aspire\_df\textquotesingle{}}\NormalTok{)) \{}
\NormalTok{    aspire\_df\textless{}{-}temp}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    aspire\_df\textless{}{-}aspire\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{bind\_rows}\NormalTok{(temp) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{arrange}\NormalTok{(}\OperatorTok{{-}}\NormalTok{date, iso3c)}
\NormalTok{  \}}
\NormalTok{\}}


\CommentTok{\#add to spi databases}
\NormalTok{spi\_df \textless{}{-}}\StringTok{ }\NormalTok{spi\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(aspire\_df)}

\NormalTok{aspire\_map \textless{}{-}}\StringTok{ }\NormalTok{aspire\_df}

\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}aspire\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.2.1.SPL\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Administrative Data Available on Beneficiary Counts or Expenditures using ASPIRE\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/aspire-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/aspire-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/aspire-3.pdf}
\includegraphics{01_data_prep_files/figure-latex/aspire-4.pdf}

\hypertarget{education-admin-data}{%
\subsubsection{Education Admin Data}\label{education-admin-data}}

\begin{itemize}
\item
  UNESCO UIS has shared a database containing data we can use on
  administrative data systems\\
\item
  We score countries based on whether there is:

  \begin{itemize}
  \item
    Data tracking SDG 4.1.2 Administration of a
    nationally-representative learning assessment (a) in Grade 2 or 3;
    (b) at the end of primary education; and (c) at the end of lower
    secondary education
  \item
    Data tracking whether countries produce the following from
    administrative data sources:

    \begin{itemize}
    \tightlist
    \item
      Out-of-school rate by school age and sex
    \item
      4.2.2 Participation rate in organized learning (one year before
      the official primary entry age), by sex
    \end{itemize}
  \end{itemize}
\end{itemize}

In order to score this indicator, we calculate the fraction of the three
types of indicators that were produced in a country in a year. In order
to smooth out variation from year to year in reporting or conducting
national assessments, we take a moving 5 year average.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#read data from UNESCO API}
\CommentTok{\#get list of indicators to download}
\NormalTok{indicators \textless{}{-}}\StringTok{ \textquotesingle{}ADMI\_GRADE2OR3PRIM\_READ+ADMI\_ENDOFPRIM\_READ+ADMI\_ENDOFLOWERSEC\_READ+ADMI\_GRADE2OR3PRIM\_MAT+ADMI\_ENDOFPRIM\_MAT+ADMI\_ENDOFLOWERSEC\_MAT+ROFST\_1\_CP+ROFST\_1\_F\_CP+ROFST\_1\_M\_CP+ROFST\_2\_CP+ROFST\_2\_F\_CP+ROFST\_2\_M\_CP+ROFST\_3\_CP+ROFST\_3\_F\_CP+ROFST\_3\_M\_CP+ROFST\_1T2\_CP+ROFST\_1T2\_F\_CP+ROFST\_1T2\_M\_CP+ROFST\_2T3\_CP+ROFST\_2T3\_F\_CP+ROFST\_2T3\_M\_CP+ROFST\_1T3\_CP+ROFST\_1T3\_F\_CP+ROFST\_1T3\_M\_CP+NERA\_AGM1\_CP+NERA\_AGM1\_F\_CP+NERA\_AGM1\_M\_CP.\textquotesingle{}}

\CommentTok{\#get list of countries}
\NormalTok{countries \textless{}{-}}\StringTok{ \textquotesingle{}AFG+ALB+DZA+ASM+AND+AGO+AIA+ATG+ARG+ARM+ABW+AUS+AUT+AZE+BHS+BHR+BGD+BRB+BLR+BEL+BLZ+BEN+BMU+BTN+BOL+BIH+BWA+BRA+VGB+BRN+BGR+BFA+BDI+KHM+CMR+CAN+CPV+CYM+CAF+TCD+CHL+CHN+HKG+MAC+COL+COM+COG+COK+CRI+CIV+HRV+CUB+CUW+CYP+CZE+PRK+COD+DNK+DJI+DMA+DOM+ECU+EGY+SLV+GNQ+ERI+EST+SWZ+ETH+FJI+FIN+FRA+GUF+PYF+GAB+GMB+GEO+DEU+GHA+GIB+GRC+GRL+GRD+GLP+GUM+GTM+GIN+GNB+GUY+HTI+VAT+HND+HUN+ISL+IND+IDN+IRN+IRQ+IRL+ISR+ITA+JAM+JPN+JOR+KAZ+KEN+KIR+KWT+KGZ+LAO+LVA+LBN+LSO+LBR+LBY+LIE+LTU+LUX+MDG+MWI+MYS+MDV+MLI+MLT+MHL+MTQ+MRT+MUS+MEX+FSM+MCO+MNG+MNE+MSR+MAR+MOZ+MMR+NAM+NRU+NPL+NLD+ANT+NCL+NZL+NIC+NER+NGA+NIU+MKD+NOR+OMN+PAK+PLW+PSE+PAN+PNG+PRY+PER+PHL+POL+PRT+PRI+QAT+KOR+MDA+REU+ROU+RUS+RWA+SHN+KNA+LCA+SPM+VCT+WSM+SMR+STP+SAU+SEN+SRB+SYC+SLE+SGP+SXM+SVK+SVN+SLB+SOM+ZAF+SSD+ESP+LKA+SDN+XDN+SUR+SWE+CHE+SYR+TJK+THA+TLS+TGO+TKL+TON+TTO+TUN+TUR+TKM+TCA+TUV+UGA+UKR+ARE+GBR+TZA+USA+URY+UZB+VUT+VEN+VNM+WLF+YEM+ZMB+ZWE+SDG+40675+40330+40334+40344+40606+40617+40603+40614+40618+40612+40616+40619+40611+40613+40630+40650+40651+40656+40642+40620+40640+UIS+40510+40525+40530+40505+40515+40520+40500+40535+40540+40550+WB+40044+40042+40030+40043+40041/all\textquotesingle{}}

\NormalTok{start \textless{}{-}}\StringTok{ \textquotesingle{}2000\textquotesingle{}}
\NormalTok{end \textless{}{-}}\StringTok{ \textquotesingle{}2019\textquotesingle{}}

\CommentTok{\#build the API query}
\NormalTok{url \textless{}{-}}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}http://data.uis.unesco.org/RestSDMX/sdmx.ashx/GetData/SDG4\_DS/\textquotesingle{}}\NormalTok{,indicators, countries,}\StringTok{\textquotesingle{}?startTime=\textquotesingle{}}\NormalTok{,start,}\StringTok{\textquotesingle{}\&endTime=\textquotesingle{}}\NormalTok{,end,}\DataTypeTok{sep=}\StringTok{""}\NormalTok{)}

\CommentTok{\#read the data}
\NormalTok{unesco\_df\_raw \textless{}{-}}\StringTok{ }\NormalTok{readsdmx}\OperatorTok{::}\KeywordTok{read\_sdmx}\NormalTok{(url)}

\CommentTok{\#cleaning of unesco data}
\NormalTok{unesco\_df \textless{}{-}}\StringTok{ }\NormalTok{unesco\_df\_raw }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date=}\KeywordTok{as.numeric}\NormalTok{(Time)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{type =} \KeywordTok{case\_when}\NormalTok{( }\CommentTok{\#categorize based on whether they are assessment, out of school, or participation data}
      \KeywordTok{grepl}\NormalTok{(}\StringTok{\textquotesingle{}ADMI\textquotesingle{}}\NormalTok{, SDG\_IND) }\OperatorTok{\textasciitilde{}}\StringTok{ "NAS"}\NormalTok{, }\CommentTok{\#Administration of a nationally{-}representative learning assessment (a) in Grade 2 or 3; (b) at the end of primary education; and (c) at the end of lower secondary education }
      \KeywordTok{grepl}\NormalTok{(}\StringTok{\textquotesingle{}ROFST\textquotesingle{}}\NormalTok{, SDG\_IND) }\OperatorTok{\textasciitilde{}}\StringTok{ "OOS"}\NormalTok{, }\CommentTok{\# Out{-}of{-}school rate by school age and sex}
      \KeywordTok{grepl}\NormalTok{(}\StringTok{\textquotesingle{}NERA\textquotesingle{}}\NormalTok{, SDG\_IND) }\OperatorTok{\textasciitilde{}}\StringTok{ "ORGL"} \CommentTok{\# Participation rate in organized learning (one year before the official primary entry age), by sex}
\NormalTok{    )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{edu\_admin\_available=}\NormalTok{(ObsValue}\OperatorTok{!=}\OtherTok{NaN} \OperatorTok{\&}\StringTok{ }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(ObsValue))) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\#get a variable for wehther admin based value exists for indicator}
\StringTok{    }\KeywordTok{group\_by}\NormalTok{( LOCATION2017,type, date) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{edu\_admin\_available=}\KeywordTok{mean}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(edu\_admin\_available))) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\#five year rolling average}
\StringTok{    }\KeywordTok{ungroup}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{pivot\_wider}\NormalTok{(}
      \DataTypeTok{names\_from=}\StringTok{\textquotesingle{}type\textquotesingle{}}\NormalTok{,}
      \DataTypeTok{names\_glue=}\StringTok{"RAW.D4.2.2.EDU.\{type\}"}\NormalTok{,}
      \DataTypeTok{values\_from=}\StringTok{\textquotesingle{}edu\_admin\_available\textquotesingle{}}\NormalTok{,}
      \DataTypeTok{values\_fill=}\DecValTok{0}
\NormalTok{    ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{iso3c=}\NormalTok{LOCATION2017) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{right\_join}\NormalTok{(spi\_df\_empty) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\KeywordTok{across}\NormalTok{(}\KeywordTok{starts\_with}\NormalTok{(}\StringTok{\textquotesingle{}RAW.D4.2.2.EDU\textquotesingle{}}\NormalTok{),}\OperatorTok{\textasciitilde{}}\KeywordTok{if\_else}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(.),}\DecValTok{0}\NormalTok{,.))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{group\_by}\NormalTok{(iso3c) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{arrange}\NormalTok{(}\OperatorTok{{-}}\NormalTok{date, iso3c) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\KeywordTok{across}\NormalTok{(}\KeywordTok{starts\_with}\NormalTok{(}\StringTok{\textquotesingle{}RAW.D4.2.2.EDU\textquotesingle{}}\NormalTok{),}\OperatorTok{\textasciitilde{}}\NormalTok{zoo}\OperatorTok{::}\KeywordTok{rollmean}\NormalTok{(.,}\DataTypeTok{k=}\DecValTok{5}\NormalTok{,}\DataTypeTok{fill=}\OtherTok{NA}\NormalTok{,}\DataTypeTok{align=}\StringTok{\textquotesingle{}left\textquotesingle{}}\NormalTok{),}\DataTypeTok{.names=}\StringTok{"\{col\}.MA5"}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\#five year rolling average}
\StringTok{    }\KeywordTok{ungroup}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D4.2.2.EDU=}\NormalTok{(RAW.D4.}\DecValTok{2}\NormalTok{.}\FloatTok{2.}\NormalTok{EDU.NAS.MA5}\OperatorTok{+}\NormalTok{RAW.D4.}\DecValTok{2}\NormalTok{.}\FloatTok{2.}\NormalTok{EDU.OOS.MA5}\OperatorTok{+}\NormalTok{RAW.D4.}\DecValTok{2}\NormalTok{.}\FloatTok{2.}\NormalTok{EDU.ORGL.MA5)}\OperatorTok{/}\DecValTok{3}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}iso3c\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}country\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}date\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}RAW.D4.2.2.EDU.NAS\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}RAW.D4.2.2.EDU.OOS\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}RAW.D4.2.2.EDU.ORGL\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.2.2.EDU\textquotesingle{}}\NormalTok{)  )}

\CommentTok{\#add to spi databases}
\NormalTok{spi\_df \textless{}{-}}\StringTok{ }\NormalTok{spi\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(unesco\_df)}

\NormalTok{unesco\_map \textless{}{-}}\StringTok{ }\NormalTok{unesco\_df }

\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}unesco\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.2.2.EDU\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Education Administrative Data Available According to UIS\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/uis-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/uis-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/uis-3.pdf}
\includegraphics{01_data_prep_files/figure-latex/uis-4.pdf}

\hypertarget{population-health-admin-data}{%
\subsubsection{Population \& Health Admin
Data}\label{population-health-admin-data}}

\begin{itemize}
\tightlist
\item
  This indicator is formed using World Bank metadata on whether the
  Civil Registration and Vital Statistics (CRVS) system is complete in
  the country.
\end{itemize}

Civil registration is the act of recording and documenting of vital
events in a person's life (including birth, marriage, divorce, adoption,
and death and cause of death) and is a fundamental function of national
governments. Birth registration establishes an individual's legal
identity at birth. A legal identity, name, nationality, and proof of
age, are important human rights. They enable individuals to be included
in various government, social and private services, and include the
right to vote, etc. Vital statistics are compiled using civil
registration information on these vital events. The availability of
reliable and up-to-date vital statistics depends on the level of
development of civil registration programs. An effective civil
registration and vital statistics (CRVS) system is critical for planning
and monitoring programs across several sectors.

By complete, that is representing 90 per cent or more of the events
occurring in the specified year.

Source: World Bank WDI Metadata.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#get data directly from WDI metadata}
\NormalTok{Request\_metadata \textless{}{-}}\StringTok{ }\KeywordTok{GET}\NormalTok{(}\DataTypeTok{url =} \StringTok{"https://api.worldbank.org/v2/sources/2/country/all/metadata?per\_page=30000\&format=json"}\NormalTok{)}
\NormalTok{Response\_metadata \textless{}{-}}\StringTok{ }\KeywordTok{content}\NormalTok{(Request\_metadata, }\DataTypeTok{as =} \StringTok{"text"}\NormalTok{, }\DataTypeTok{encoding =} \StringTok{"UTF{-}8"}\NormalTok{)}

\CommentTok{\# Parse the JSON content and convert it to a data frame.}
\NormalTok{JSON\_metadata \textless{}{-}}\StringTok{ }\NormalTok{jsonlite}\OperatorTok{::}\KeywordTok{fromJSON}\NormalTok{(Response\_metadata, }\DataTypeTok{flatten =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{data.frame}\NormalTok{()}

\CommentTok{\#do some conversion to produce a dataframe}
\NormalTok{df \textless{}{-}}\StringTok{ }\NormalTok{JSON\_metadata}\OperatorTok{$}\NormalTok{source.concept }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{data.frame}\NormalTok{() }

\CommentTok{\#do some more cleaning and conversion}
\NormalTok{df \textless{}{-}}\StringTok{ }\NormalTok{df}\OperatorTok{$}\NormalTok{variable }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{data.frame}\NormalTok{()   }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{iso3c=}\NormalTok{id) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{unnest}\NormalTok{(metatype) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{pivot\_wider}\NormalTok{(}
    \DataTypeTok{id\_cols=}\NormalTok{iso3c,}
    \DataTypeTok{names\_from=}\NormalTok{id,}
    \DataTypeTok{values\_from=}\NormalTok{value}
\NormalTok{  ) }

\CommentTok{\# Manipulate and clean final data}
\NormalTok{df \textless{}{-}}\StringTok{ }\NormalTok{df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(IncomeGroup))  }\CommentTok{\#keep just countries (drop aggregations)}
  
\NormalTok{df}\OperatorTok{$}\NormalTok{SPI.D4.}\DecValTok{2}\NormalTok{.}\FloatTok{3.}\NormalTok{CRVS\textless{}{-}}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{grepl}\NormalTok{(}\StringTok{"Yes"}\NormalTok{, df}\OperatorTok{$}\NormalTok{Vitalregistrationcomplete)) }\CommentTok{\#create 0,1 variable for vital registration}

\NormalTok{crvs\_df \textless{}{-}}\StringTok{ }\NormalTok{df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date=}\DecValTok{2019}\NormalTok{,}
         \DataTypeTok{country=}\NormalTok{TableName,}
         \DataTypeTok{RAW.D4.2.3.CRVS=}\NormalTok{Vitalregistrationcomplete) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}iso3c\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}country\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}date\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}RAW.D4.2.3.CRVS\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.2.3.CRVS\textquotesingle{}}\NormalTok{)  )}


\CommentTok{\#pull old data from SCI}
\NormalTok{Request\_metadata \textless{}{-}}\StringTok{ }\KeywordTok{GET}\NormalTok{(}\DataTypeTok{url =} \StringTok{"http://api.worldbank.org/v2/country/all/indicator/3.11.01.03.popreg?format=json\&date=2004:2018\&per\_page=5000"}\NormalTok{)}
\NormalTok{Response\_metadata \textless{}{-}}\StringTok{ }\KeywordTok{content}\NormalTok{(Request\_metadata, }\DataTypeTok{as =} \StringTok{"text"}\NormalTok{, }\DataTypeTok{encoding =} \StringTok{"UTF{-}8"}\NormalTok{)}

\CommentTok{\# Parse the JSON content and convert it to a data frame.}
\NormalTok{crvs\_df2 \textless{}{-}}\StringTok{ }\NormalTok{jsonlite}\OperatorTok{::}\KeywordTok{fromJSON}\NormalTok{(Response\_metadata, }\DataTypeTok{flatten =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{data.frame}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{transmute}\NormalTok{(}
    \DataTypeTok{iso3c=}\NormalTok{countryiso3code,}
    \DataTypeTok{country=}\NormalTok{country.value,}
    \DataTypeTok{date=}\KeywordTok{as.numeric}\NormalTok{(date),}
    \DataTypeTok{crvs=}\NormalTok{value}
\NormalTok{  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D4.2.3.CRVS=}\KeywordTok{as.numeric}\NormalTok{(crvs),}
         \DataTypeTok{RAW.D4.2.3.CRVS=}\KeywordTok{as.character}\NormalTok{(crvs)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(spi\_df\_empty) }\CommentTok{\#add on country metadata}


\CommentTok{\# Manipulate and clean final data}
\NormalTok{crvs\_df2 \textless{}{-}}\StringTok{ }\NormalTok{crvs\_df2 }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(income)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\#keep just countries (drop aggregations)}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}iso3c\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}country\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}date\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}RAW.D4.2.3.CRVS\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.2.3.CRVS\textquotesingle{}}\NormalTok{)  )}

\CommentTok{\#join updated data with SCI data}
\NormalTok{crvs\_df \textless{}{-}}\StringTok{ }\NormalTok{crvs\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{bind\_rows}\NormalTok{(crvs\_df2)}

\CommentTok{\#add to spi databases}
\NormalTok{spi\_df \textless{}{-}}\StringTok{ }\NormalTok{spi\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(crvs\_df)}


\NormalTok{crvs\_map \textless{}{-}}\StringTok{ }\NormalTok{crvs\_df }

\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}crvs\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.2.3.CRVS\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Complete Civil Registration \& Vital Statistics Data Available According to WDI\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/crvs-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/crvs-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/crvs-3.pdf}
\includegraphics{01_data_prep_files/figure-latex/crvs-4.pdf}

\hypertarget{labor-admin-data}{%
\subsubsection{Labor Admin Data}\label{labor-admin-data}}

\begin{itemize}
\item
  ILO shared database containing all administrative data sources used to
  produce ILO statistics (ILOSTAT)

  \begin{itemize}
  \tightlist
  \item
    May not be comprehensive of all administrative datasets available in
    a country\\
  \item
    But gives some indication of whether labor statistics produced using
    Admin data
  \end{itemize}
\item
  Database contains the following admin sources:

  \begin{itemize}
  \tightlist
  \item
    Insurance records\\
  \item
    Labour inspectorate records\\
  \item
    Records of employers' organizations\\
  \item
    Employment office records
  \item
    Records of workers' organizations
  \item
    Other administrative records and related sources
  \end{itemize}
\item
  Database extends from 2010 to 2019 and covers 177 countries.
\end{itemize}

To produce a score, we calculate the percentage of these six admin
sources above that are available for a country in a given year. In order
to smooth out gaps in reporting, we take a moving 5 year average of the
score.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#read data}
\NormalTok{ilo\_df\_raw \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{\textquotesingle{}4.2\_SOAD\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}ILOSTAT\_sources.csv\textquotesingle{}}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{))}

\CommentTok{\#cleaning of aspire data}
\NormalTok{ilo\_df \textless{}{-}}\StringTok{ }\NormalTok{ilo\_df\_raw }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{grepl}\NormalTok{(}\StringTok{\textquotesingle{}legislation\textquotesingle{}}\NormalTok{,Source)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\# filter out labor legislation, which is included but not reflective of needs.}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{type =} \KeywordTok{case\_when}\NormalTok{( }\CommentTok{\#categorize based on whether they are assessment, out of school, or participation data}
\NormalTok{      (Source.type}\OperatorTok{==}\StringTok{"Insurance records"}\NormalTok{ ) }\OperatorTok{\textasciitilde{}}\StringTok{ "INSUR"}\NormalTok{, }\CommentTok{\#Insurance records }
\NormalTok{      (Source.type}\OperatorTok{==}\StringTok{"Labour inspectorate records"}\NormalTok{ ) }\OperatorTok{\textasciitilde{}}\StringTok{ "INSP"}\NormalTok{, }\CommentTok{\# Labour inspectorate records  }
\NormalTok{      (Source.type}\OperatorTok{==}\StringTok{"Records of employers\textquotesingle{} organizations"}\NormalTok{ ) }\OperatorTok{\textasciitilde{}}\StringTok{ "EMPORG"}\NormalTok{, }\CommentTok{\# Records of employers\textquotesingle{} organizations}
\NormalTok{      (Source.type}\OperatorTok{==}\StringTok{"Employment office records"}\NormalTok{ ) }\OperatorTok{\textasciitilde{}}\StringTok{ "EMPOFF"}\NormalTok{, }\CommentTok{\# Employment office records}
\NormalTok{      (Source.type}\OperatorTok{==}\StringTok{"Records of workers\textquotesingle{} organizations"}\NormalTok{  ) }\OperatorTok{\textasciitilde{}}\StringTok{ "WRKORG"}\NormalTok{, }\CommentTok{\# Records of workers\textquotesingle{} organizations}
\NormalTok{      (Source.type}\OperatorTok{==}\StringTok{"Other administrative records and related sources"}\NormalTok{ ) }\OperatorTok{\textasciitilde{}}\StringTok{ "OTHER"} \CommentTok{\# Other administrative records and related sources}
\NormalTok{                        ),}
      \DataTypeTok{admin\_available=}\DecValTok{1}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, date, type,Source ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{      }\KeywordTok{pivot\_wider}\NormalTok{(}
      \DataTypeTok{names\_from=}\StringTok{\textquotesingle{}type\textquotesingle{}}\NormalTok{,}
      \DataTypeTok{names\_glue=}\StringTok{"RAW.D4.2.4.LBR.\{type\}"}\NormalTok{,}
      \DataTypeTok{values\_from=}\StringTok{\textquotesingle{}Source\textquotesingle{}}\NormalTok{,}
      \DataTypeTok{values\_fill=}\OtherTok{NULL}
\NormalTok{    ) }


\CommentTok{\#apply carryforward to fill in missing values}
\NormalTok{ilo\_df \textless{}{-}}\StringTok{ }\NormalTok{ilo\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{right\_join}\NormalTok{(spi\_df\_empty) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(iso3c, date) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(iso3c) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\KeywordTok{across}\NormalTok{(}\KeywordTok{starts\_with}\NormalTok{(}\StringTok{\textquotesingle{}RAW.D4.2.4.LBR\textquotesingle{}}\NormalTok{),}
                \OperatorTok{\textasciitilde{}}\KeywordTok{if\_else}\NormalTok{(.}\OperatorTok{!=}\StringTok{\textquotesingle{}NULL\textquotesingle{}}\NormalTok{,}\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{),}
                \DataTypeTok{.names=}\StringTok{"\{col\}\_available"}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{ILO.Source.type.filled=}\NormalTok{(RAW.D4.}\DecValTok{2}\NormalTok{.}\FloatTok{4.}\NormalTok{LBR.OTHER\_available }\OperatorTok{+}
\StringTok{                                }\NormalTok{RAW.D4.}\DecValTok{2}\NormalTok{.}\FloatTok{4.}\NormalTok{LBR.INSUR\_available }\OperatorTok{+}
\StringTok{                                }\NormalTok{RAW.D4.}\DecValTok{2}\NormalTok{.}\FloatTok{4.}\NormalTok{LBR.EMPOFF\_available}\OperatorTok{+}
\StringTok{                                }\NormalTok{RAW.D4.}\DecValTok{2}\NormalTok{.}\FloatTok{4.}\NormalTok{LBR.WRKORG\_available}\OperatorTok{+}
\StringTok{                                }\NormalTok{RAW.D4.}\DecValTok{2}\NormalTok{.}\FloatTok{4.}\NormalTok{LBR.INSP\_available  }\OperatorTok{+}
\StringTok{                                }\NormalTok{RAW.D4.}\DecValTok{2}\NormalTok{.}\FloatTok{4.}\NormalTok{LBR.EMPORG\_available)}\OperatorTok{/}\DecValTok{6}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(iso3c) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(}\OperatorTok{{-}}\NormalTok{date, iso3c) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\KeywordTok{across}\NormalTok{(}\KeywordTok{starts\_with}\NormalTok{(}\StringTok{\textquotesingle{}ILO.Source.type.filled\textquotesingle{}}\NormalTok{),}\OperatorTok{\textasciitilde{}}\NormalTok{zoo}\OperatorTok{::}\KeywordTok{rollmean}\NormalTok{(.,}\DataTypeTok{k=}\DecValTok{5}\NormalTok{,}\DataTypeTok{fill=}\OtherTok{NA}\NormalTok{,}\DataTypeTok{align=}\StringTok{\textquotesingle{}left\textquotesingle{}}\NormalTok{),}\DataTypeTok{.names=}\StringTok{"\{col\}.MA5"}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}\StringTok{ }\CommentTok{\#five year rolling average}
\StringTok{  }\KeywordTok{ungroup}\NormalTok{() }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D4.2.4.LBR=}\KeywordTok{if\_else}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(ILO.Source.type.filled.MA5),}\DecValTok{0}\NormalTok{, ILO.Source.type.filled.MA5)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}iso3c\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}country\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}date\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.2.4.LBR\textquotesingle{}}\NormalTok{), }\KeywordTok{starts\_with}\NormalTok{(}\StringTok{\textquotesingle{}RAW.D4.2.4.LBR\textquotesingle{}}\NormalTok{)  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{{-}}\KeywordTok{ends\_with}\NormalTok{(}\StringTok{\textquotesingle{}available\textquotesingle{}}\NormalTok{))}

\CommentTok{\#add to spi databases}
\NormalTok{spi\_df \textless{}{-}}\StringTok{ }\NormalTok{spi\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(ilo\_df)  }


\NormalTok{ilo\_map \textless{}{-}}\StringTok{ }\NormalTok{ilo\_df }

\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}ilo\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D4.2.4.LBR\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Labor Administrative Data Available According to ILO\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/ilo-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/ilo-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/ilo-3.pdf}
\includegraphics{01_data_prep_files/figure-latex/ilo-4.pdf}

\hypertarget{indicator-4.3-geospatial-data}{%
\subsection{Indicator 4.3: geospatial
data}\label{indicator-4.3-geospatial-data}}

New indicator based on references to geospatial data in metadata
relating to content on NSO website

\hypertarget{source-1}{%
\subsubsection{Source}\label{source-1}}

Our source for this indicator is Open Data Watch. From Open Data watch:

\begin{quote}
The Open Data Inventory (ODIN) assesses the coverage and openness of
official statistics to help identify gaps, promote open data policies,
improve access, and encourage dialogue between national statistical
offices (NSOs) and data users. ODIN 2018/19 includes 178 countries,
including most all OECD countries. Two-year comparisons are for all
countries with two years of data between 2015-2017. Scores can be
compared across topics and countries.
\end{quote}

We use their indicator on whether indicators are available at the first
or second administrative level. To identify the first administrative
levels, ODIN largely draws on the ISO 3166-2 standard. In many
countries, first administrative levels refer to governorates, regions,
or province. No official list exists for the second administrative level
classifications. If geographical disaggregation exists that does not
qualify as first administrative level, assume that the data are
disaggregated to the second administrative level as long as the
classification appears to be a further divisions of the first
administrative level.

Scoring for the ODIN indicators for geospatial information is below:

\begin{itemize}
\tightlist
\item
  1 point if all published data in a data category are available at
  first/second administrative level.\\
\item
  0.5 points if some published data in a data category are available at
  first/second administrative level.\\
\item
  0 points if no data are available at this level
\end{itemize}

There are 21 data categories.

Social Statistics\\
1. Population and Vital Statistics\\
2. Education Facilities\\
3. Education Outcomes\\
4. Health Facilities\\
5. Health Outcomes\\
6. Reproductive Health\\
7. Gender Statistics\\
8. Crime and Justice Statistics\\
9. Poverty Statistics

Economic Statistics\\
10. National Accounts\\
11. Labor Statistics\\
12. Price Indexes\\
13. Government Finance\\
14. Money and Banking\\
15. International Trade\\
16. Balance of Payments

Environmental Statistics\\
17. Land Use\\
18. Resource Use\\
19. Energy Use\\
20. Pollution\\
21. Built Environment

For the first administrative unit: Money \& Banking, International
Trade, and Balance of Payments are not scored for this element. For
various indicators, lenient interpretations are used for first
administrative divisions.

For the second administrative unit: Money \& Banking, International
Trade, Balance of Payments, National Accounts, Government Finance
,Pollution, Energy Use, Price Indexes, and Resource Use are not scored
for this element. For various indicators within categories, second
administrative level data is not required as well.

In the scores we present below, we show a score between 0 and 1 with a
maximum score of 1, which would mean the country has geo data in full
for 100\% of elements. A score of 0 indicates no data at all for any
elements.

More details on the geographic disaggregation considerations can be
found in their technical manual:

\url{https://docs.google.com/document/d/1ubPL1l_3im9bjlCVZ6W2ICAy6UAiXl1hGeA1aXImkxI/edit}

\begin{Shaded}
\begin{Highlighting}[]
  \CommentTok{\#read in ODIN data}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2015}\OperatorTok{:}\DecValTok{2018}\NormalTok{) \{}
\NormalTok{   temp \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{\textquotesingle{}/2.2\_DSOA/\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}ODIN\_\textquotesingle{}}\NormalTok{,i,}\StringTok{\textquotesingle{}.csv\textquotesingle{}}\NormalTok{, }\DataTypeTok{sep=}\StringTok{""}\NormalTok{))  }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{as\_tibble}\NormalTok{(}\DataTypeTok{.name\_repair =} \StringTok{\textquotesingle{}universal\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date=}\NormalTok{i) }\OperatorTok{\%\textgreater{}\%}
\StringTok{        }\KeywordTok{filter}\NormalTok{(Data.categories}\OperatorTok{==}\StringTok{\textquotesingle{}All Categories\textquotesingle{}}\NormalTok{)}

    \KeywordTok{assign}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}geo\_df\textquotesingle{}}\NormalTok{,i,}\DataTypeTok{sep=}\StringTok{"\_"}\NormalTok{), temp)}
\NormalTok{  \}}

\CommentTok{\#bind different years together}
\NormalTok{geo\_df \textless{}{-}}\StringTok{ }\KeywordTok{bind\_rows}\NormalTok{(geo\_df\_}\DecValTok{2015}\NormalTok{, geo\_df\_}\DecValTok{2016}\NormalTok{, geo\_df\_}\DecValTok{2017}\NormalTok{, geo\_df\_}\DecValTok{2018}\NormalTok{)}


\CommentTok{\#create geo scores}
\NormalTok{geo\_df \textless{}{-}}\StringTok{ }\NormalTok{geo\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{select}\NormalTok{(Country.Code, date, First.administrative.level, Second.administrative.level) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{iso3c=}\NormalTok{Country.Code) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{group\_by}\NormalTok{( iso3c) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{right\_join}\NormalTok{(country\_metadata) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{D4.3.GEO.first.admin.level=}\KeywordTok{if\_else}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(First.administrative.level), }\DecValTok{0}\NormalTok{, First.administrative.level),}
           \DataTypeTok{D4.3.GEO.second.admin.level=}\KeywordTok{if\_else}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(Second.administrative.level), }\DecValTok{0}\NormalTok{, Second.administrative.level))    }
  

\CommentTok{\#do some quick renaming and formatting}
\NormalTok{geo\_df\_temp1 \textless{}{-}}\StringTok{ }\NormalTok{geo\_df }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{rename\_with}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}RAW\textquotesingle{}}\NormalTok{,., }\DataTypeTok{sep=}\StringTok{"."}\NormalTok{), }\DataTypeTok{.cols=}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}D4.3.GEO.first.admin.level\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}D4.3.GEO.second.admin.level\textquotesingle{}}\NormalTok{) ) }


\NormalTok{geo\_df\_temp2 \textless{}{-}}\StringTok{ }\NormalTok{geo\_df }\OperatorTok{\%\textgreater{}\%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\KeywordTok{across}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}D4.3.GEO.first.admin.level\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}D4.3.GEO.second.admin.level\textquotesingle{}}\NormalTok{), }\OperatorTok{\textasciitilde{}}\NormalTok{.}\OperatorTok{/}\DecValTok{100}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename\_with}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{paste}\NormalTok{(}\StringTok{\textquotesingle{}SPI\textquotesingle{}}\NormalTok{,., }\DataTypeTok{sep=}\StringTok{"."}\NormalTok{), }\DataTypeTok{.cols=}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}D4.3.GEO.first.admin.level\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}D4.3.GEO.second.admin.level\textquotesingle{}}\NormalTok{) ) }

\NormalTok{geo\_df \textless{}{-}}\StringTok{ }\NormalTok{geo\_df\_temp1 }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(geo\_df\_temp2)}

\CommentTok{\#add to spi df}
\NormalTok{spi\_df \textless{}{-}}\StringTok{ }\NormalTok{spi\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(geo\_df)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/geo_plots-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/geo_plots-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/geo_plots-3.pdf}
\includegraphics{01_data_prep_files/figure-latex/geo_plots-4.pdf}
\includegraphics{01_data_prep_files/figure-latex/geo_plots-5.pdf}
\includegraphics{01_data_prep_files/figure-latex/geo_plots-6.pdf}

\hypertarget{indicator-4.4-privatecitizen-generated-data}{%
\subsection{Indicator 4.4: private/citizen generated
data}\label{indicator-4.4-privatecitizen-generated-data}}

New indicator based on references to private/citizen generated data in
metadata relating to content on NSO website.

\hypertarget{covid-mobility-data-availability}{%
\subsubsection{Covid Mobility Data
Availability}\label{covid-mobility-data-availability}}

We have seen an increased use of private/citizen generated data during
the COVID-19 pandemic. One way in which it has been used is for tracking
mobility of citizens to understand the social distancing measures
citizens are taking. As a measure of private/citizen generated data we
make use of Apple and Google Mobility tracking data made publicly
available during the pandemic.

Source:

Google LLC ``Google COVID-19 Community Mobility Reports''.
\url{https://www.google.com/covid19/mobility/} Accessed: 2020-07-23.

Apple ``Mobility Trends Reports''.
\url{https://www.apple.com/covid19/mobility/} Accessed: 2020-07-23.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\#\#\#}
\CommentTok{\# Google}
\CommentTok{\#\#\#\#\#}
\CommentTok{\#google mobility}
\NormalTok{google\_df\_raw \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{\textquotesingle{}4.4\_SOPC\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Global\_Mobility\_Report.csv\textquotesingle{}}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{))}


\CommentTok{\#match to world bank country database}
\NormalTok{google\_df \textless{}{-}}\StringTok{ }\NormalTok{google\_df\_raw }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(country\_region\_code) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{freq=}\KeywordTok{n}\NormalTok{()) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(country\_metadata, }\DataTypeTok{by=}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}country\_region\_code\textquotesingle{}}\NormalTok{=}\StringTok{\textquotesingle{}iso2c\textquotesingle{}}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date=}\DecValTok{2020}\NormalTok{,}
         \DataTypeTok{value=}\DecValTok{1}\NormalTok{)}


\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}google\_df\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}value\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Google Global Mobility Report Data\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/4.4_SOPC-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/4.4_SOPC-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/4.4_SOPC-3.pdf}
\includegraphics{01_data_prep_files/figure-latex/4.4_SOPC-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\#\#\#}
\CommentTok{\# Apple}
\CommentTok{\#\#\#\#\#}

\NormalTok{apple\_df\_raw \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{\textquotesingle{}4.4\_SOPC\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}applemobilitytrends{-}2020{-}07{-}26.csv\textquotesingle{}}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{)) }

\CommentTok{\#match to world bank country database}
\NormalTok{apple\_df \textless{}{-}}\StringTok{ }\NormalTok{apple\_df\_raw }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{{-}}\KeywordTok{c}\NormalTok{(}\StringTok{\textquotesingle{}country\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}alternative\_name\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}sub{-}region\textquotesingle{}}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(geo\_type}\OperatorTok{==}\StringTok{"country/region"}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{country=}\NormalTok{region) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{pivot\_longer}\NormalTok{(}\DataTypeTok{cols=}\KeywordTok{starts\_with}\NormalTok{(}\StringTok{"2020"}\NormalTok{),}
               \DataTypeTok{names\_to=}\StringTok{\textquotesingle{}date\textquotesingle{}}\NormalTok{,}
               \DataTypeTok{values\_to=}\StringTok{\textquotesingle{}value\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(country) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\KeywordTok{across}\NormalTok{(}\KeywordTok{everything}\NormalTok{(), last)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{country=}\KeywordTok{case\_when}\NormalTok{(}
\NormalTok{    country}\OperatorTok{==}\StringTok{"Egypt"} \OperatorTok{\textasciitilde{}}\StringTok{ "Egypt, Arab Rep."}\NormalTok{,}
\NormalTok{    country}\OperatorTok{==}\StringTok{"Republic of Korea"} \OperatorTok{\textasciitilde{}}\StringTok{ "Korea, Rep."}\NormalTok{,}
\NormalTok{    country}\OperatorTok{==}\StringTok{"Macao"} \OperatorTok{\textasciitilde{}}\StringTok{ "Macao SAR, China"}\NormalTok{,}
\NormalTok{    country}\OperatorTok{==}\StringTok{"Slovakia"} \OperatorTok{\textasciitilde{}}\StringTok{ "Slovak Republic"}\NormalTok{,}
\NormalTok{    country}\OperatorTok{==}\StringTok{"Taiwan"} \OperatorTok{\textasciitilde{}}\StringTok{ "Taiwan, China"}\NormalTok{,}
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{country}
\NormalTok{  )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{group\_by}\NormalTok{(country) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{freq=}\KeywordTok{n}\NormalTok{()) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(country\_metadata) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date=}\DecValTok{2020}\NormalTok{,}
         \DataTypeTok{value=}\DecValTok{1}\NormalTok{)}



\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}apple\_df\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}value\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Apple Mobility Report Data\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/4.4_SOPC-5.pdf}
\includegraphics{01_data_prep_files/figure-latex/4.4_SOPC-6.pdf}
\includegraphics{01_data_prep_files/figure-latex/4.4_SOPC-7.pdf}
\includegraphics{01_data_prep_files/figure-latex/4.4_SOPC-8.pdf}

\hypertarget{data-infrastructure}{%
\section{Data Infrastructure}\label{data-infrastructure}}

Data Infrastructure (5 Indicators):\\
- 5.1\_DILG - Indicator 5.1: legislation and governance\\
- 5.2\_DISM - Indicator 5.2: standards\\
- 5.3\_DISK - Indicator 5.3: skills\\
- 5.4\_DIPN - Indicator 5.4: partnerships\\
- 5.5\_DIFI - Indicator 5.5: finance

\hypertarget{indicator-5.1-legislation-and-governance}{%
\subsection{Indicator 5.1: legislation and
governance}\label{indicator-5.1-legislation-and-governance}}

The legislation and governance indicator will be drawn from SDG
indicator 17.18.2 (national statistical legislation compliance with UN
Fundamental Principles of Official Statistics), existence of National
Statistical Council, national statistical strategy generation, national
statistical plan. Also include some other legislative aspects that
foster good use of statistics eg freedom of information,
privacy/transparency, good governance (eg free and fair elections).

This indicator measures whether the national statistical legislation
complies with United Nations Fundamental Principles of Statistics (SDG
17.18.2)

Scores is 1 if the country has a national statistical legislation
compliant with United Nations Fundamental Principles of Statistics.
Scores of 0 or scores with missing values are treated the same (both
given a score of zero).

The source is Paris 21 and UNSD. Data accessed using UNSD SDG API on
2020-09-04

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{D5}\FloatTok{.1}\NormalTok{\_DILG \textless{}{-}}\StringTok{ }\KeywordTok{un\_pull}\NormalTok{(}\StringTok{\textquotesingle{}SG\_STT\_FPOS\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2004\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2019\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, date,value) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{right\_join}\NormalTok{(spi\_df\_empty) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{RAW.5.1.DILG=}\KeywordTok{if\_else}\NormalTok{((}\KeywordTok{is.na}\NormalTok{(value) }\OperatorTok{|}\StringTok{ }\NormalTok{value}\OperatorTok{==}\StringTok{"NaN"}\NormalTok{),}\KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{), }\KeywordTok{as.numeric}\NormalTok{(value)),}
         \DataTypeTok{SPI.5.1.DILG=}\KeywordTok{if\_else}\NormalTok{((}\KeywordTok{is.na}\NormalTok{(value) }\OperatorTok{|}\StringTok{ }\NormalTok{value}\OperatorTok{==}\StringTok{"NaN"}\NormalTok{),}\DecValTok{0}\NormalTok{, }\KeywordTok{as.numeric}\NormalTok{(value))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{{-}}\NormalTok{value)}
\CommentTok{\# }
\CommentTok{\# \#read in csv file.}
\CommentTok{\# D5.1\_DILG2 \textless{}{-} read\_csv(file = paste(raw\_dir, "5.1\_DILG","5.1\_DILG.csv", sep="/" )) \%\textgreater{}\%}
\CommentTok{\#   as\_tibble(.name\_repair = \textquotesingle{}universal\textquotesingle{}) \%\textgreater{}\%}
\CommentTok{\#   transmute(}
\CommentTok{\#     country=Country,}
\CommentTok{\#     date=Year,}
\CommentTok{\#     SPI.5.1.DILG=Data.Value}
\CommentTok{\#   ) \%\textgreater{}\%}
\CommentTok{\#     mutate(country=case\_when(}
\CommentTok{\#     country=="Bahamas" \textasciitilde{} "Bahamas, The",                  }
\CommentTok{\#     country=="Bolivia (Plurinational State of)"   \textasciitilde{}  "Bolivia"   ,                  }
\CommentTok{\#     country=="Côte d\textquotesingle{}Ivoire"  \textasciitilde{}  "Cote d\textquotesingle{}Ivoire"                ,}
\CommentTok{\#     country=="Democratic Republic of the Congo"  \textasciitilde{} "Congo, Dem. Rep."  ,           }
\CommentTok{\#     country=="Congo"  \textasciitilde{} "Congo, Rep."        ,           }
\CommentTok{\#     country=="Curacao"  \textasciitilde{}  "Curacao"       ,                }
\CommentTok{\#     country=="Czechia"   \textasciitilde{}  "Czech Republic"     ,        }
\CommentTok{\#     country=="Egypt"  \textasciitilde{} "Egypt, Arab Rep."        ,      }
\CommentTok{\#     country=="Micronesia (Federated States of)"  \textasciitilde{} "Micronesia, Fed. Sts."  ,       }
\CommentTok{\#     country=="United Kingdom"   \textasciitilde{}  "United Kingdom"    ,         }
\CommentTok{\#     country=="Gambia"    \textasciitilde{}  "Gambia, The"     ,           }
\CommentTok{\#     country=="Iran (Islamic Republic of)"  \textasciitilde{} "Iran, Islamic Rep." ,           }
\CommentTok{\#     country=="Kyrgyzstan"   \textasciitilde{}  "Kyrgyz Republic"   ,          }
\CommentTok{\#     country=="Republic of Korea"   \textasciitilde{} "Korea, Rep."   ,               }
\CommentTok{\#     country=="Lao People\textquotesingle{}s Democratic Republic"    \textasciitilde{}  "Lao PDR" ,                    }
\CommentTok{\#     country=="Saint Kitts and Nevis   "   \textasciitilde{} "St. Kitts and Nevis",}
\CommentTok{\#     country=="Saint Lucia"   \textasciitilde{} "St. Lucia",}
\CommentTok{\#     country=="Republic of Moldova"   \textasciitilde{}  "Moldova"   ,                  }
\CommentTok{\#     country=="Democratic People\textquotesingle{}s Republic of Korea"  \textasciitilde{}  "Korea, Dem. People’s Rep." ,  }
\CommentTok{\#     country=="Slovakia"   \textasciitilde{}  "Slovak Republic"             ,}
\CommentTok{\#     country=="United Republic of Tanzania"   \textasciitilde{}  "Tanzania" ,                    }
\CommentTok{\#     country=="United States of America"  \textasciitilde{} "United States"  ,                }
\CommentTok{\#     country=="Saint Vincent and the Grenadines" \textasciitilde{} "St. Vincent and the Grenadines" ,}
\CommentTok{\#     country=="Venezuela (Bolivarian Republic of)"  \textasciitilde{}  "Venezuela, RB"   ,              }
\CommentTok{\#     country=="British Virgin Islands"  \textasciitilde{}  "British Virgin Islands" ,       }
\CommentTok{\#     country=="Viet Nam"  \textasciitilde{} "Vietnam"        ,              }
\CommentTok{\#     country=="Yemen"  \textasciitilde{} "Yemen, Rep.",}
\CommentTok{\#     country=="United Kingdom of Great Britain and Northern Ireland" \textasciitilde{} "United Kingdom",}
\CommentTok{\#     TRUE \textasciitilde{} country}
\CommentTok{\#   )) \%\textgreater{}\%}
\CommentTok{\#   mutate(RAW.5.1.DILG=if\_else(SPI.5.1.DILG==\textquotesingle{}no data\textquotesingle{},as.character(NA), SPI.5.1.DILG),}
\CommentTok{\#          SPI.5.1.DILG=if\_else(SPI.5.1.DILG==\textquotesingle{}no data\textquotesingle{},as.numeric(NA), as.numeric(SPI.5.1.DILG))) \%\textgreater{}\%}
\CommentTok{\#   right\_join(spi\_df\_empty)}

\CommentTok{\#add to spi databases}
\NormalTok{spi\_df \textless{}{-}}\StringTok{ }\NormalTok{spi\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D5}\FloatTok{.1}\NormalTok{\_DILG)}


\NormalTok{D5}\FloatTok{.1}\NormalTok{\_DILG\_map \textless{}{-}}\StringTok{ }\NormalTok{D5}\FloatTok{.1}\NormalTok{\_DILG }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(RAW.}\DecValTok{5}\NormalTok{.}\FloatTok{1.}\NormalTok{DILG))}

\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}D5.1\_DILG\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.5.1.DILG\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}National statistical legislation complies with United Nations Fundamental Principles of Statistics. Source: Paris21\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/legislation_governance-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/legislation_governance-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/legislation_governance-3.pdf}
\includegraphics{01_data_prep_files/figure-latex/legislation_governance-4.pdf}
\#\# Indicator 5.2: standards

\hypertarget{system-of-national-accounts-in-use}{%
\subsubsection{5.2.1 System of National Accounts in
use}\label{system-of-national-accounts-in-use}}

The national accounts data are compiled using the concepts, definitions,
framework, and methodology of the System of National Account 2008
(SNA2008) or European System of National and Regional Accounts (ESA
2010). The manual has evolved to meet the changing economic structure,
to follow systematic accounting and ensure international compatibility.

Scoring: 1 point for using SNA2008 or ESA 2010, 0.5 points for using SNA
1993 or ESA 1995, 0 points otherwise

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#read in csv file.}
\NormalTok{D5.}\DecValTok{2}\NormalTok{.}\FloatTok{1.}\NormalTok{SNAU \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{"5.2\_DISM"}\NormalTok{,}\StringTok{"D5.2.1.SNAU.csv"}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{ )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D5.2.1.SNAU=}\KeywordTok{case\_when}\NormalTok{(}
\NormalTok{    SNAU}\OperatorTok{==}\StringTok{"SNA 2008"} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }
\NormalTok{    SNAU}\OperatorTok{==}\StringTok{"SNA 1993"} \OperatorTok{\textasciitilde{}}\StringTok{ }\FloatTok{0.5}\NormalTok{,}
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0} 
\NormalTok{  ),}
      \DataTypeTok{RAW.D5.2.1.SNAU=}\NormalTok{SNAU) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(date, country) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, country, date,RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{1.}\NormalTok{SNAU, SPI.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{1.}\NormalTok{SNAU  ) }
\end{Highlighting}
\end{Shaded}

\hypertarget{national-accounts-base-year}{%
\subsubsection{5.2.2 National Accounts base
year}\label{national-accounts-base-year}}

National accounts base year is the year used as the base period for
constant price calculations in the country's national accounts. It is
recommended that the base year of constant price estimates be changed
periodically to reflect changes in economic structure and relative
prices.

1 point for chained price, 0.5 for reference period within past 10
years, 0 points otherwise.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#read in csv file.}
\NormalTok{D5.}\DecValTok{2}\NormalTok{.}\FloatTok{2.}\NormalTok{NABY \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{"5.2\_DISM"}\NormalTok{,}\StringTok{"D5.2.2.NABY.csv"}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{ )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D5.2.2.NABY=}\KeywordTok{case\_when}\NormalTok{(}
\NormalTok{    NABY}\OperatorTok{==}\StringTok{"Original chained constant price data are rescaled."} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }
\NormalTok{    (date}\OperatorTok{{-}}\KeywordTok{as.numeric}\NormalTok{(NABY))}\OperatorTok{\textless{}=}\DecValTok{10} \OperatorTok{\textasciitilde{}}\StringTok{ }\FloatTok{0.5}\NormalTok{, }\CommentTok{\#within 10 years of reference period}
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0} 
\NormalTok{  ),}
  \DataTypeTok{RAW.D5.2.2.NABY=}\NormalTok{NABY)  }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, country, date, RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{2.}\NormalTok{NABY, SPI.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{2.}\NormalTok{NABY  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(date, country)}
\end{Highlighting}
\end{Shaded}

\hypertarget{classification-of-national-industry}{%
\subsubsection{5.2.3 Classification of national
industry}\label{classification-of-national-industry}}

The industrial production data are compiled using the International
Standard Industrial Classification of All Economic Activities (ISIC)
Rev.4 and Statistical Classification of Economic Activities in the
European Community (NACE) Rev.2. ISIC Rev.4 is a standard classification
of economic activities arranged so that entities can be classified per
the activity they carry out using criteria such as input, output and use
of the products produced, more emphasis has been given to the character
of the production process in defining and delineating ISIC classes for
international comparability. The manual and classification have changed
to cover the complete scope of industrial production, employment, and
GDP and other statistical areas.

1 Point. Latest version is adopted (ISIC Rev 4, NACE Rev 2 or a
compatible classification)

0.5 Points. Previous version is used (ISIC Rev 3, NACE Rev 1 or a
compatible classification)

0 Points. Otherwise

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#read in csv file.}
\NormalTok{D5.}\DecValTok{2}\NormalTok{.}\FloatTok{3.}\NormalTok{CNIN \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{"5.2\_DISM"}\NormalTok{,}\StringTok{"D5.2.3.CNIN.csv"}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{ )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D5.2.3.CNIN=}\KeywordTok{case\_when}\NormalTok{(}
    \KeywordTok{str\_to\_lower}\NormalTok{(CNIN)}\OperatorTok{==}\StringTok{"nace rev2"} \OperatorTok{|}\StringTok{ }\KeywordTok{str\_to\_lower}\NormalTok{(CNIN)}\OperatorTok{==}\StringTok{"rev4"} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }
    \KeywordTok{str\_to\_lower}\NormalTok{(CNIN)}\OperatorTok{==}\StringTok{"nace rev1"} \OperatorTok{|}\StringTok{ }\KeywordTok{str\_to\_lower}\NormalTok{(CNIN)}\OperatorTok{==}\StringTok{"rev3"} \OperatorTok{\textasciitilde{}}\StringTok{ }\FloatTok{0.5}\NormalTok{, }
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0} 
\NormalTok{  ),}
  \DataTypeTok{RAW.D5.2.3.CNIN=}\NormalTok{CNIN)  }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, country, date, RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{3.}\NormalTok{CNIN, SPI.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{3.}\NormalTok{CNIN  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(date, country)}
\end{Highlighting}
\end{Shaded}

\hypertarget{cpi-base-year}{%
\subsubsection{5.2.4 CPI base year}\label{cpi-base-year}}

Consumer Price Index serves as indicators of inflation and reflects
changes in the cost of acquiring a fixed basket of goods and services by
the average consumer.\\
Weights are usually derived from consumer expenditure surveys and the
CPI base year refers to the year the weights were derived. It is
recommended that the base year be changed periodically to reflect
changes in expenditure structure.

1 Point. Annual chain linking. 0.5 Points. Base year in last 10 years. 0
points. Otherwise

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#read in csv file.}
\NormalTok{D5.}\DecValTok{2}\NormalTok{.}\FloatTok{4.}\NormalTok{CPIBY \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{"5.2\_DISM"}\NormalTok{,}\StringTok{"D5.2.4.CPIBY.csv"}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{ )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D5.2.4.CPIBY=}\KeywordTok{case\_when}\NormalTok{(}
\NormalTok{    CPIBY}\OperatorTok{==}\StringTok{"annual chained"} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }
\NormalTok{    (date}\OperatorTok{{-}}\KeywordTok{as.numeric}\NormalTok{(CPIBY))}\OperatorTok{\textless{}=}\DecValTok{10} \OperatorTok{\textasciitilde{}}\StringTok{ }\FloatTok{0.5}\NormalTok{, }\CommentTok{\#within 10 years of reference period}
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0} 
\NormalTok{  ),}
  \DataTypeTok{RAW.D5.2.4.CPIBY=}\NormalTok{CPIBY)  }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, country, date, RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{4.}\NormalTok{CPIBY, SPI.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{4.}\NormalTok{CPIBY  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(date, country)}
\end{Highlighting}
\end{Shaded}

\hypertarget{classification-of-household-consumption}{%
\subsubsection{5.2.5 Classification of household
consumption}\label{classification-of-household-consumption}}

Classification of Individual Consumption According to Purpose (COICOP)
is used in household budget surveys, consumer price indices and
international comparisons of gross domestic product (GDP) and its
component expenditures.\\
Although COICOP is not strictly linked to any particular model of
consumer behavior, the classification is designed to broadly reflect
differences in income elasticities. It is an integral part of the
SNA1993 and more detailed subdivision of the classes provide
comparability between countries and between statistics in these
different areas.

1 Point. Follow Classification of Individual Consumption by Purpose
(COICOP) 0 Points. Otherwise

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#read in csv file.}
\NormalTok{D5.}\DecValTok{2}\NormalTok{.}\FloatTok{5.}\NormalTok{HOUS \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{"5.2\_DISM"}\NormalTok{,}\StringTok{"D5.2.5.HOUS.csv"}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{ )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D5.2.5.HOUS=}\KeywordTok{case\_when}\NormalTok{(}
\NormalTok{    HOUS}\OperatorTok{==}\StringTok{"COICOP"} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0} 
\NormalTok{  ),}
  \DataTypeTok{RAW.D5.2.5.HOUS=}\NormalTok{HOUS)  }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, country, date, RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{5.}\NormalTok{HOUS, SPI.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{5.}\NormalTok{HOUS  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(date, country)}
\end{Highlighting}
\end{Shaded}

\hypertarget{classification-of-status-of-employment}{%
\subsubsection{5.2.6 Classification of status of
employment}\label{classification-of-status-of-employment}}

Classification of status of employment refers to employment data that
are compiled using the current international standard International
Classification of Status in Employment (ISCE-93). It classifies jobs
with respect to the type of explicit or implicit contract of employment
between the job holder and the economic unit in which he or she is
employed. Therefore, it aims to provide the basis for production of
internationally comparable statistics on the employment relationship,
including the distinction between salaried employment and
self-employment.

1 Point. Follow International Labour Organization, International
Classification of Status in Employment (ICSE-93) or 2012 North American
Industry Classification System (NAICS). 0 Points Otherwise.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#read in csv file.}
\NormalTok{D5.}\DecValTok{2}\NormalTok{.}\FloatTok{6.}\NormalTok{EMPL \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{"5.2\_DISM"}\NormalTok{,}\StringTok{"D5.2.6.EMPL.csv"}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{ )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D5.2.6.EMPL=}\KeywordTok{case\_when}\NormalTok{(}
\NormalTok{    EMPL}\OperatorTok{==}\StringTok{"ICSE{-}93"} \OperatorTok{|}\StringTok{ }\NormalTok{EMPL}\OperatorTok{==}\StringTok{"NAICS"} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0} 
\NormalTok{  ),}
  \DataTypeTok{RAW.D5.2.6.EMPL=}\NormalTok{EMPL)  }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, country, date, RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{6.}\NormalTok{EMPL, SPI.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{6.}\NormalTok{EMPL  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(date, country)}
\end{Highlighting}
\end{Shaded}

\hypertarget{central-government-accounting-status}{%
\subsubsection{5.2.7 Central government accounting
status}\label{central-government-accounting-status}}

Government finance accounting status refers to the accounting basis for
reporting central government financial data. For many countries'
government finance data, have been consolidated into one set of accounts
capturing all the central government's fiscal activities and following
noncash recording basis.\\
Budgetary central government accounts do not necessarily include all
central government units, the picture they provide of central government
activities is usually incomplete.

1 Point. Consolidated central government accounting follows noncash
recording basis\\
0.5 Points. Consolidated central government accounting follows cash
recording basis\\
0 Points. Otherwise

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#read in csv file.}
\NormalTok{D5.}\DecValTok{2}\NormalTok{.}\FloatTok{7.}\NormalTok{CGOV \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{"5.2\_DISM"}\NormalTok{,}\StringTok{"D5.2.7.CGOV.csv"}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{ )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D5.2.7.CGOV=}\KeywordTok{case\_when}\NormalTok{(}
\NormalTok{    CGOV}\OperatorTok{==}\StringTok{"AC"} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }
\NormalTok{    CGOV}\OperatorTok{==}\StringTok{"CA"} \OperatorTok{\textasciitilde{}}\StringTok{ }\FloatTok{0.5}\NormalTok{,}
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0} 
\NormalTok{  ),}
  \DataTypeTok{RAW.D5.2.7.CGOV=}\NormalTok{CGOV)  }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, country, date, RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{7.}\NormalTok{CGOV, SPI.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{7.}\NormalTok{CGOV  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(date, country)}
\end{Highlighting}
\end{Shaded}

\hypertarget{compilation-of-government-finance-statistics}{%
\subsubsection{5.2.8 Compilation of government finance
statistics}\label{compilation-of-government-finance-statistics}}

(GFSM) in use for compiling the data. It provides guidelines on the
institutional structure of governments and the presentation of fiscal
data in a format similar to business accounting with a balance sheet and
income statement plus guidelines on the treatment of exchange rate and
other valuation adjustments. The latest manual GFSM2014 is harmonized
with the SNA2008.

1 Point. Follow the latest Government Finance Statistical Manual (2014)/
ESA2010\\
0.5 Points. Previous version is used (GFSM 2001)\\
0 Points. Otherwise

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#read in csv file.}
\NormalTok{D5.}\DecValTok{2}\NormalTok{.}\FloatTok{8.}\NormalTok{FINA \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{"5.2\_DISM"}\NormalTok{,}\StringTok{"D5.2.8.FINA.csv"}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{ )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D5.2.8.FINA=}\KeywordTok{case\_when}\NormalTok{(}
\NormalTok{    FINA}\OperatorTok{==}\StringTok{"2014"} \OperatorTok{|}\StringTok{ }\NormalTok{FINA}\OperatorTok{==}\StringTok{"ESA 2010"}\OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }
\NormalTok{    FINA}\OperatorTok{==}\StringTok{"2001"} \OperatorTok{\textasciitilde{}}\StringTok{ }\FloatTok{0.5}\NormalTok{,}
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0} 
\NormalTok{  ),}
  \DataTypeTok{RAW.D5.2.8.FINA=}\NormalTok{FINA)  }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, country, date, RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{8.}\NormalTok{FINA, SPI.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{8.}\NormalTok{FINA  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(date, country)}
\end{Highlighting}
\end{Shaded}

\hypertarget{compilation-of-monetary-and-financial-statistics}{%
\subsubsection{5.2.9 Compilation of monetary and financial
statistics}\label{compilation-of-monetary-and-financial-statistics}}

Compilation of monetary and financial statistics refers to the Monetary
and Financial Statistics Manual (MFSM) in use. It covers concepts,
definitions, classifications of financial instruments and sectors, and
accounting rules, and provides a comprehensive analytic framework for
monetary and financial planning and policy determination. The Monetary
and Finance Statistics: Compilation Guide (2008) provides detailed
guidelines for the compilation of monetary and financial statistics in
addition to MFSM.

1 Point. Follow the latest Monetary and Finance Statistics Manual (2000)
or Monetary and Finance Statistics: Compilation Guide (2008/2016) 0
Points. Otherwise

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#read in csv file.}
\NormalTok{D5.}\DecValTok{2}\NormalTok{.}\FloatTok{9.}\NormalTok{MONY \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{"5.2\_DISM"}\NormalTok{,}\StringTok{"D5.2.9.MONY.csv"}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{ )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D5.2.9.MONY=}\KeywordTok{case\_when}\NormalTok{(}
\NormalTok{    MONY}\OperatorTok{==}\StringTok{"MFSM 2000"} \OperatorTok{|}\StringTok{ }\NormalTok{MONY}\OperatorTok{==}\StringTok{"MFSMCG 2016"}\OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0} 
\NormalTok{  ),}
  \DataTypeTok{RAW.D5.2.9.MONY=}\NormalTok{MONY)  }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, country, date, RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{9.}\NormalTok{MONY, SPI.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{9.}\NormalTok{MONY  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(date, country)}
\end{Highlighting}
\end{Shaded}

\hypertarget{business-process}{%
\subsubsection{5.2.10 Business process}\label{business-process}}

The Generic Statistical Business Process Model (GSBPM) aims to describe
statistics production in a general and process-oriented way. It is used
both within and between statistical offices as a common basis for work
with statistics production in different ways, such as quality,
efficiency, standardization, and process-orientation. It is used for all
types of surveys, and ``business'' is not related to ``business
statistics'' but refers to the statistical office, simply expressed.

1 Point. GSBPM is in use 0 Points. Otherwise

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#read in csv file.}
\NormalTok{D5.}\DecValTok{2}\NormalTok{.}\FloatTok{10.}\NormalTok{GSBP \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{"5.2\_DISM"}\NormalTok{,}\StringTok{"D5.2.10.GSBP.csv"}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{ )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D5.2.10.GSBP=}\KeywordTok{case\_when}\NormalTok{(}
    \KeywordTok{str\_to\_lower}\NormalTok{(GSBP)}\OperatorTok{==}\StringTok{"yes"} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{1}\NormalTok{, }
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\DecValTok{0} 
\NormalTok{  ),}
  \DataTypeTok{RAW.D5.2.10.GSBP=}\NormalTok{GSBP)  }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, country, date, RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{10.}\NormalTok{GSBP, SPI.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{10.}\NormalTok{GSBP  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(date, country)}
\end{Highlighting}
\end{Shaded}

\hypertarget{create-overall-indicator}{%
\subsubsection{Create Overall
Indicator}\label{create-overall-indicator}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# join datasets together based on country and date}
\NormalTok{D5.}\FloatTok{2.}\NormalTok{MSC \textless{}{-}}\StringTok{ }\NormalTok{D5.}\DecValTok{2}\NormalTok{.}\FloatTok{1.}\NormalTok{SNAU }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D5.}\DecValTok{2}\NormalTok{.}\FloatTok{2.}\NormalTok{NABY) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D5.}\DecValTok{2}\NormalTok{.}\FloatTok{3.}\NormalTok{CNIN) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D5.}\DecValTok{2}\NormalTok{.}\FloatTok{4.}\NormalTok{CPIBY) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D5.}\DecValTok{2}\NormalTok{.}\FloatTok{5.}\NormalTok{HOUS) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D5.}\DecValTok{2}\NormalTok{.}\FloatTok{6.}\NormalTok{EMPL) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D5.}\DecValTok{2}\NormalTok{.}\FloatTok{7.}\NormalTok{CGOV) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D5.}\DecValTok{2}\NormalTok{.}\FloatTok{8.}\NormalTok{FINA) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D5.}\DecValTok{2}\NormalTok{.}\FloatTok{9.}\NormalTok{MONY) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D5.}\DecValTok{2}\NormalTok{.}\FloatTok{10.}\NormalTok{GSBP) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, country, date, }\KeywordTok{everything}\NormalTok{()) }
\CommentTok{\#Now calculate MSC score which is the average across the 12 indicators}
\NormalTok{D5.}\FloatTok{2.}\NormalTok{MSC \textless{}{-}}\StringTok{ }\NormalTok{D5.}\FloatTok{2.}\NormalTok{MSC }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{SPI.D5.2.MSC=}\DecValTok{100}\OperatorTok{*}\KeywordTok{rowMeans}\NormalTok{(.[}\KeywordTok{grep}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{colnames}\NormalTok{(D5.}\FloatTok{2.}\NormalTok{MSC), }
                                              \DataTypeTok{pattern=}\StringTok{"SPI.D5.2"}\NormalTok{)], }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(date, iso3c) }


\CommentTok{\#add to spi databases}
\NormalTok{spi\_df \textless{}{-}}\StringTok{ }\NormalTok{spi\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D5.}\FloatTok{2.}\NormalTok{MSC)}

\CommentTok{\#now do the figures }
\NormalTok{msc\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{D5.}\FloatTok{2.}\NormalTok{MSC }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{1.}\NormalTok{SNAU))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}msc\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D5.2.1.SNAU\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}System of National Accounts in use in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/msc-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-3.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{msc\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{D5.}\FloatTok{2.}\NormalTok{MSC }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{2.}\NormalTok{NABY))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}msc\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D5.2.2.NABY\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}National Accounts base year in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/msc-5.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-6.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-7.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-8.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{msc\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{D5.}\FloatTok{2.}\NormalTok{MSC }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{3.}\NormalTok{CNIN))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}msc\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D5.2.3.CNIN\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Classification of national industry in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/msc-9.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-10.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-11.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-12.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{msc\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{D5.}\FloatTok{2.}\NormalTok{MSC }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{4.}\NormalTok{CPIBY))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}msc\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D5.2.4.CPIBY\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}CPI base year in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/msc-13.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-14.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-15.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-16.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{msc\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{D5.}\FloatTok{2.}\NormalTok{MSC }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{5.}\NormalTok{HOUS))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}msc\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D5.2.5.HOUS\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Classification of household consumption in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/msc-17.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-18.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-19.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-20.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{msc\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{D5.}\FloatTok{2.}\NormalTok{MSC }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{6.}\NormalTok{EMPL))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}msc\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D5.2.6.EMPL\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Classification of status of employment in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/msc-21.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-22.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-23.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-24.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{msc\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{D5.}\FloatTok{2.}\NormalTok{MSC }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{7.}\NormalTok{CGOV))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}msc\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D5.2.7.CGOV\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Central government accounting status in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/msc-25.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-26.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-27.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-28.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{msc\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{D5.}\FloatTok{2.}\NormalTok{MSC }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{8.}\NormalTok{FINA))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}msc\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D5.2.8.FINA\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Compilation of government finance statistics in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/msc-29.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-30.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-31.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-32.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{msc\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{D5.}\FloatTok{2.}\NormalTok{MSC }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{9.}\NormalTok{MONY))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}msc\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D5.2.9.MONY\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Compilation of monetary and financial statistics in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/msc-33.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-34.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-35.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-36.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{msc\_df\_map \textless{}{-}}\StringTok{ }\NormalTok{D5.}\FloatTok{2.}\NormalTok{MSC }\OperatorTok{\%\textgreater{}\%}\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(RAW.D5.}\DecValTok{2}\NormalTok{.}\FloatTok{10.}\NormalTok{GSBP))}
\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}msc\_df\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.D5.2.10.GSBP\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Business process in 2019\textquotesingle{}}\NormalTok{ )}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/msc-37.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-38.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-39.pdf}
\includegraphics{01_data_prep_files/figure-latex/msc-40.pdf}

\hypertarget{indicator-5.3-skills}{%
\subsection{Indicator 5.3: skills}\label{indicator-5.3-skills}}

This indicator assesses the systematic use of statistical knowledge with
statistical terms and indicators in national policy documents. It is a
composite indicator consisting of 4 sub-indices that aim to reflect the
relevance of statistical evidence. It comprises four main dimensions: i)
Basic consideration; ii) Diagnosis and quantification; iii) Statistical
Analysis; iv) Disaggregation.

Score ranges from 0 to 100. The score is the weighted sum of each of the
four components' scores, whose relative weight is reported in brackets:
i) Basic Consideration (25\%); ii) Diagnosis and quantification (24\%);
iii) Statistical Analysis (22\%); iv) Disaggregation (29\%).

The source is Paris 21. Data accessed on August 6, 2020 from
\url{https://statisticalcapacitymonitor.org/indicator/127}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#read in csv file.}
\NormalTok{D5}\FloatTok{.3}\NormalTok{\_DISK \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\DataTypeTok{file =} \KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{"5.3\_DISK"}\NormalTok{,}\StringTok{"5.3\_DISK.csv"}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{ )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{as\_tibble}\NormalTok{(}\DataTypeTok{.name\_repair =} \StringTok{\textquotesingle{}universal\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{transmute}\NormalTok{(}
    \DataTypeTok{country=}\NormalTok{Country,}
    \DataTypeTok{date=}\NormalTok{Year,}
    \DataTypeTok{SPI.5.3.DISK=}\NormalTok{Data.Value}
\NormalTok{  ) }\OperatorTok{\%\textgreater{}\%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{country=}\KeywordTok{case\_when}\NormalTok{(}
\NormalTok{    country}\OperatorTok{==}\StringTok{"Bahamas"} \OperatorTok{\textasciitilde{}}\StringTok{ "Bahamas, The"}\NormalTok{,                  }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Bolivia (Plurinational State of)"}   \OperatorTok{\textasciitilde{}}\StringTok{  "Bolivia"}\NormalTok{   ,                  }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Côte d\textquotesingle{}Ivoire"}  \OperatorTok{\textasciitilde{}}\StringTok{  "Cote d\textquotesingle{}Ivoire"}\NormalTok{                ,}
\NormalTok{    country}\OperatorTok{==}\StringTok{"Democratic Republic of the Congo"}  \OperatorTok{\textasciitilde{}}\StringTok{ "Congo, Dem. Rep."}\NormalTok{  ,           }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Congo"}  \OperatorTok{\textasciitilde{}}\StringTok{ "Congo, Rep."}\NormalTok{        ,           }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Curacao"}  \OperatorTok{\textasciitilde{}}\StringTok{  "Curacao"}\NormalTok{       ,                }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Czechia"}   \OperatorTok{\textasciitilde{}}\StringTok{  "Czech Republic"}\NormalTok{     ,        }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Egypt"}  \OperatorTok{\textasciitilde{}}\StringTok{ "Egypt, Arab Rep."}\NormalTok{        ,      }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Micronesia (Federated States of)"}  \OperatorTok{\textasciitilde{}}\StringTok{ "Micronesia, Fed. Sts."}\NormalTok{  ,       }
\NormalTok{    country}\OperatorTok{==}\StringTok{"United Kingdom"}   \OperatorTok{\textasciitilde{}}\StringTok{  "United Kingdom"}\NormalTok{    ,         }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Gambia"}    \OperatorTok{\textasciitilde{}}\StringTok{  "Gambia, The"}\NormalTok{     ,           }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Iran (Islamic Republic of)"}  \OperatorTok{\textasciitilde{}}\StringTok{ "Iran, Islamic Rep."}\NormalTok{ ,           }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Kyrgyzstan"}   \OperatorTok{\textasciitilde{}}\StringTok{  "Kyrgyz Republic"}\NormalTok{   ,          }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Republic of Korea"}   \OperatorTok{\textasciitilde{}}\StringTok{ "Korea, Rep."}\NormalTok{   ,               }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Lao People\textquotesingle{}s Democratic Republic"}    \OperatorTok{\textasciitilde{}}\StringTok{  "Lao PDR"}\NormalTok{ ,                    }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Saint Kitts and Nevis "}   \OperatorTok{\textasciitilde{}}\StringTok{ "St. Kitts and Nevis"}\NormalTok{,}
\NormalTok{    country}\OperatorTok{==}\StringTok{"Saint Lucia"}   \OperatorTok{\textasciitilde{}}\StringTok{ "St. Lucia"}\NormalTok{,}
\NormalTok{    country}\OperatorTok{==}\StringTok{"Republic of Moldova"}   \OperatorTok{\textasciitilde{}}\StringTok{  "Moldova"}\NormalTok{   ,                  }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Democratic People\textquotesingle{}s Republic of Korea"}  \OperatorTok{\textasciitilde{}}\StringTok{  "Korea, Dem. People’s Rep."}\NormalTok{ ,  }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Slovakia"}   \OperatorTok{\textasciitilde{}}\StringTok{  "Slovak Republic"}\NormalTok{             ,}
\NormalTok{    country}\OperatorTok{==}\StringTok{"United Republic of Tanzania"}   \OperatorTok{\textasciitilde{}}\StringTok{  "Tanzania"}\NormalTok{ ,                    }
\NormalTok{    country}\OperatorTok{==}\StringTok{"United States of America"}  \OperatorTok{\textasciitilde{}}\StringTok{ "United States"}\NormalTok{  ,                }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Saint Vincent and the Grenadines"} \OperatorTok{\textasciitilde{}}\StringTok{ "St. Vincent and the Grenadines"}\NormalTok{ ,}
\NormalTok{    country}\OperatorTok{==}\StringTok{"Venezuela (Bolivarian Republic of)"}  \OperatorTok{\textasciitilde{}}\StringTok{  "Venezuela, RB"}\NormalTok{   ,              }
\NormalTok{    country}\OperatorTok{==}\StringTok{"British Virgin Islands"}  \OperatorTok{\textasciitilde{}}\StringTok{  "British Virgin Islands"}\NormalTok{ ,       }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Viet Nam"}  \OperatorTok{\textasciitilde{}}\StringTok{ "Vietnam"}\NormalTok{        ,              }
\NormalTok{    country}\OperatorTok{==}\StringTok{"Yemen"}  \OperatorTok{\textasciitilde{}}\StringTok{ "Yemen, Rep."}\NormalTok{,}
\NormalTok{    country}\OperatorTok{==}\StringTok{"United Kingdom of Great Britain and Northern Ireland"} \OperatorTok{\textasciitilde{}}\StringTok{ "United Kingdom"}\NormalTok{,}
    \OtherTok{TRUE} \OperatorTok{\textasciitilde{}}\StringTok{ }\NormalTok{country}
\NormalTok{  )) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{RAW.5.3.DISK=}\KeywordTok{if\_else}\NormalTok{(SPI.}\DecValTok{5}\NormalTok{.}\FloatTok{3.}\NormalTok{DISK}\OperatorTok{==}\StringTok{\textquotesingle{}no data\textquotesingle{}}\NormalTok{,}\KeywordTok{as.character}\NormalTok{(}\OtherTok{NA}\NormalTok{), SPI.}\DecValTok{5}\NormalTok{.}\FloatTok{3.}\NormalTok{DISK),}
         \DataTypeTok{SPI.5.3.DISK=}\KeywordTok{if\_else}\NormalTok{(SPI.}\DecValTok{5}\NormalTok{.}\FloatTok{3.}\NormalTok{DISK}\OperatorTok{==}\StringTok{\textquotesingle{}no data\textquotesingle{}}\NormalTok{,}\KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{), }\KeywordTok{as.numeric}\NormalTok{(SPI.}\DecValTok{5}\NormalTok{.}\FloatTok{3.}\NormalTok{DISK))}\OperatorTok{/}\DecValTok{100}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{right\_join}\NormalTok{(spi\_df\_empty)}

\CommentTok{\#add to spi databases}
\NormalTok{spi\_df \textless{}{-}}\StringTok{ }\NormalTok{spi\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D5}\FloatTok{.3}\NormalTok{\_DISK)}


\NormalTok{D5}\FloatTok{.3}\NormalTok{\_DISK\_map \textless{}{-}}\StringTok{ }\NormalTok{D5}\FloatTok{.3}\NormalTok{\_DISK }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(SPI.}\DecValTok{5}\NormalTok{.}\FloatTok{3.}\NormalTok{DISK))}

\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}D5.3\_DISK\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.5.3.DISK\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Systematic use of statistical knowledge with statistical terms and indicators in national policy documents. Source: Paris21\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/skill-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/skill-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/skill-3.pdf}
\includegraphics{01_data_prep_files/figure-latex/skill-4.pdf}

\hypertarget{indicator-5.4-partnerships}{%
\subsection{Indicator 5.4:
partnerships}\label{indicator-5.4-partnerships}}

No data is available for this indicator at this point.

\hypertarget{indicator-5.5-finance}{%
\subsection{Indicator 5.5: finance}\label{indicator-5.5-finance}}

Indicator based on SDG indicators (SDG 17.18.3 (national statistical
plan that is fully funded and under implementation). This indicator
measures whether the national statistical plan under implementation is
fully funded. It relates to SDG 17.18.3 and is based on the annual
Status Report on National Strategies for the Development of Statistics
(NSDS).

Scores is 1 if the country has a national statistical plan that is fully
funded and under implementation. Scores of 0 or scores with missing
values are treated the same (both given a score of zero).

The source is Paris 21 and UNSD. Data accessed using UNSD SDG API on
2020-09-04

Source of this data is UNSD and Paris21. Downloaded on August 6,2020
from \url{https://statisticalcapacitymonitor.org/indicator/138/}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#pull from unsd api}
\NormalTok{D5}\FloatTok{.5}\NormalTok{\_DIFI \textless{}{-}}\StringTok{ }\KeywordTok{un\_pull}\NormalTok{(}\StringTok{\textquotesingle{}SG\_STT\_NSDSFND\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2004\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2019\textquotesingle{}}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(iso3c, date,value) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{right\_join}\NormalTok{(spi\_df\_empty) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{RAW.5.5.DIFI=}\KeywordTok{if\_else}\NormalTok{((}\KeywordTok{is.na}\NormalTok{(value) }\OperatorTok{|}\StringTok{ }\NormalTok{value}\OperatorTok{==}\StringTok{"NaN"}\NormalTok{),}\KeywordTok{as.numeric}\NormalTok{(}\OtherTok{NA}\NormalTok{), }\KeywordTok{as.numeric}\NormalTok{(value)),}
         \DataTypeTok{SPI.5.5.DIFI=}\KeywordTok{if\_else}\NormalTok{((}\KeywordTok{is.na}\NormalTok{(value) }\OperatorTok{|}\StringTok{ }\NormalTok{value}\OperatorTok{==}\StringTok{"NaN"}\NormalTok{),}\DecValTok{0}\NormalTok{, }\KeywordTok{as.numeric}\NormalTok{(value))) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{{-}}\NormalTok{value)}

\CommentTok{\# \#read in csv file.}
\CommentTok{\# D5.5\_DIFI \textless{}{-} read\_csv(file = paste(raw\_dir, "5.5\_DIFI","D5.5\_DIFI.csv", sep="/" )) \%\textgreater{}\%}
\CommentTok{\#   as\_tibble(.name\_repair = \textquotesingle{}universal\textquotesingle{}) \%\textgreater{}\%}
\CommentTok{\#   transmute(}
\CommentTok{\#     country=Country,}
\CommentTok{\#     date=Year,}
\CommentTok{\#     SPI.5.5.DIFI=Data.Value}
\CommentTok{\#   ) \%\textgreater{}\%}
\CommentTok{\#     mutate(country=case\_when(}
\CommentTok{\#     country=="Bahamas" \textasciitilde{} "Bahamas, The",                  }
\CommentTok{\#     country=="Bolivia (Plurinational State of)"   \textasciitilde{}  "Bolivia"   ,                  }
\CommentTok{\#     country=="Côte d\textquotesingle{}Ivoire"  \textasciitilde{}  "Cote d\textquotesingle{}Ivoire"                ,}
\CommentTok{\#     country=="Democratic Republic of the Congo"  \textasciitilde{} "Congo, Dem. Rep."  ,           }
\CommentTok{\#     country=="Congo"  \textasciitilde{} "Congo, Rep."        ,           }
\CommentTok{\#     country=="Curacao"  \textasciitilde{}  "Curacao"       ,                }
\CommentTok{\#     country=="Czechia"   \textasciitilde{}  "Czech Republic"     ,        }
\CommentTok{\#     country=="Egypt"  \textasciitilde{} "Egypt, Arab Rep."        ,      }
\CommentTok{\#     country=="Micronesia (Federated States of)"  \textasciitilde{} "Micronesia, Fed. Sts."  ,       }
\CommentTok{\#     country=="United Kingdom"   \textasciitilde{}  "United Kingdom"    ,         }
\CommentTok{\#     country=="Gambia"    \textasciitilde{}  "Gambia, The"     ,           }
\CommentTok{\#     country=="Iran (Islamic Republic of)"  \textasciitilde{} "Iran, Islamic Rep." ,           }
\CommentTok{\#     country=="Kyrgyzstan"   \textasciitilde{}  "Kyrgyz Republic"   ,          }
\CommentTok{\#     country=="Republic of Korea"   \textasciitilde{} "Korea, Rep."   ,               }
\CommentTok{\#     country=="Lao People\textquotesingle{}s Democratic Republic"    \textasciitilde{}  "Lao PDR" ,                    }
\CommentTok{\#     country=="Saint Kitts and Nevis   "   \textasciitilde{} "St. Kitts and Nevis",}
\CommentTok{\#     country=="Saint Lucia"   \textasciitilde{} "St. Lucia",}
\CommentTok{\#     country=="Republic of Moldova"   \textasciitilde{}  "Moldova"   ,                  }
\CommentTok{\#     country=="Democratic People\textquotesingle{}s Republic of Korea"  \textasciitilde{}  "Korea, Dem. People’s Rep." ,  }
\CommentTok{\#     country=="Slovakia"   \textasciitilde{}  "Slovak Republic"             ,}
\CommentTok{\#     country=="United Republic of Tanzania"   \textasciitilde{}  "Tanzania" ,                    }
\CommentTok{\#     country=="United States of America"  \textasciitilde{} "United States"  ,                }
\CommentTok{\#     country=="Saint Vincent and the Grenadines" \textasciitilde{} "St. Vincent and the Grenadines" ,}
\CommentTok{\#     country=="Venezuela (Bolivarian Republic of)"  \textasciitilde{}  "Venezuela, RB"   ,              }
\CommentTok{\#     country=="British Virgin Islands"  \textasciitilde{}  "British Virgin Islands" ,       }
\CommentTok{\#     country=="Viet Nam"  \textasciitilde{} "Vietnam"        ,              }
\CommentTok{\#     country=="Yemen"  \textasciitilde{} "Yemen, Rep.",}
\CommentTok{\#     country=="United Kingdom of Great Britain and Northern Ireland" \textasciitilde{} "United Kingdom",}
\CommentTok{\#     TRUE \textasciitilde{} country}
\CommentTok{\#   )) \%\textgreater{}\%}
\CommentTok{\#   mutate(RAW.5.5.DIFI=if\_else(SPI.5.5.DIFI==\textquotesingle{}no data\textquotesingle{},as.character(NA), SPI.5.5.DIFI),}
\CommentTok{\#          SPI.5.5.DIFI=if\_else(SPI.5.5.DIFI==\textquotesingle{}no data\textquotesingle{},as.numeric(NA), as.numeric(SPI.5.5.DIFI))) \%\textgreater{}\%}
\CommentTok{\#   right\_join(spi\_df\_empty)}

\CommentTok{\#add to spi databases}
\NormalTok{spi\_df \textless{}{-}}\StringTok{ }\NormalTok{spi\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(D5}\FloatTok{.5}\NormalTok{\_DIFI)}





\NormalTok{D5}\FloatTok{.5}\NormalTok{\_DIFI\_map \textless{}{-}}\StringTok{ }\NormalTok{D5}\FloatTok{.5}\NormalTok{\_DIFI }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(RAW.}\DecValTok{5}\NormalTok{.}\FloatTok{5.}\NormalTok{DIFI))}

\KeywordTok{spi\_mapper}\NormalTok{(}\StringTok{\textquotesingle{}D5.5\_DIFI\_map\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}SPI.5.5.DIFI\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Statistical plan fully funded. Source: Paris21\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_data_prep_files/figure-latex/finance-1.pdf}
\includegraphics{01_data_prep_files/figure-latex/finance-2.pdf}
\includegraphics{01_data_prep_files/figure-latex/finance-3.pdf}
\includegraphics{01_data_prep_files/figure-latex/finance-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#add in population}
\NormalTok{pop\_df \textless{}{-}}\StringTok{ }\NormalTok{wbstats}\OperatorTok{::}\KeywordTok{wb}\NormalTok{(}\DataTypeTok{country=}\StringTok{"all"}\NormalTok{,}
             \DataTypeTok{indicator=}\StringTok{\textquotesingle{}SP.POP.TOTL\textquotesingle{}}\NormalTok{,}
             \DataTypeTok{startdate=}\DecValTok{2004}\NormalTok{,}
             \DataTypeTok{enddate=}\DecValTok{2019}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{date=}\KeywordTok{as.numeric}\NormalTok{(date)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{population=}\NormalTok{value) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(country, date, population)}

\CommentTok{\# save final dataset}
\NormalTok{spi\_df\_final \textless{}{-}}\StringTok{ }\NormalTok{spi\_df }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(country, iso3c, date, }\KeywordTok{starts\_with}\NormalTok{(}\StringTok{"SPI"}\NormalTok{), }\KeywordTok{starts\_with}\NormalTok{(}\StringTok{"RAW"}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{right\_join}\NormalTok{(spi\_df\_empty) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{left\_join}\NormalTok{(pop\_df) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(}\OperatorTok{{-}}\NormalTok{date,country)}

\CommentTok{\#write to csv}
\NormalTok{spi\_df\_final }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\KeywordTok{across}\NormalTok{(is.list, as.character)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{write\_excel\_csv}\NormalTok{( }\DataTypeTok{path =} \KeywordTok{paste}\NormalTok{(output\_dir, }\StringTok{\textquotesingle{}SPI\_data.csv\textquotesingle{}}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{))}

\CommentTok{\#label data}
\CommentTok{\#read in metadata}
\NormalTok{names\_df \textless{}{-}}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\StringTok{\textquotesingle{}source\_id\textquotesingle{}}\NormalTok{=}\KeywordTok{colnames}\NormalTok{(spi\_df\_final))}

\NormalTok{spi\_meta \textless{}{-}}\StringTok{ }\KeywordTok{read\_csv}\NormalTok{(}\KeywordTok{paste}\NormalTok{(raw\_dir, }\StringTok{\textquotesingle{}/metadata/SPI\_dimensions\_sources.csv\textquotesingle{}}\NormalTok{, }\DataTypeTok{sep=}\StringTok{""}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{right\_join}\NormalTok{(names\_df) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{source\_name=}\KeywordTok{if\_else}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(source\_name), }\KeywordTok{paste}\NormalTok{(source\_id), source\_name)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{factor}\NormalTok{(source\_id, }\DataTypeTok{levels=}\KeywordTok{colnames}\NormalTok{(spi\_df\_final)))}

\CommentTok{\#label data}

\KeywordTok{label}\NormalTok{(spi\_df\_final) =}\StringTok{ }\KeywordTok{as.list}\NormalTok{(spi\_meta}\OperatorTok{$}\NormalTok{source\_name)}


\CommentTok{\#write to stata}
\NormalTok{spi\_df\_final }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\KeywordTok{across}\NormalTok{(is.list, as.character)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{rename\_with}\NormalTok{(}\OperatorTok{\textasciitilde{}}\KeywordTok{gsub}\NormalTok{(}\StringTok{"."}\NormalTok{,}\StringTok{"\_"}\NormalTok{,.x, }\DataTypeTok{fixed=}\OtherTok{TRUE}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{{-}}\NormalTok{lat,}\OperatorTok{{-}}\NormalTok{long) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{write\_dta}\NormalTok{( }\DataTypeTok{path =} \KeywordTok{paste}\NormalTok{(output\_dir, }\StringTok{\textquotesingle{}SPI\_data.dta\textquotesingle{}}\NormalTok{, }\DataTypeTok{sep=}\StringTok{"/"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#basic analysis}

\KeywordTok{library}\NormalTok{(corrr)}

\NormalTok{spi\_df\_final\_cor \textless{}{-}}\StringTok{ }\NormalTok{spi\_df\_final }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(date}\OperatorTok{==}\DecValTok{2018}\NormalTok{) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\KeywordTok{contains}\NormalTok{(}\StringTok{"SPI."}\NormalTok{)) }\OperatorTok{\%\textgreater{}\%}
\StringTok{  }\KeywordTok{correlate}\NormalTok{()}
\end{Highlighting}
\end{Shaded}


\end{document}
